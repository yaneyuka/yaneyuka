<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>yaneyuka - userpage</title>
  <link rel="icon" type="image/png" href="image/yaneyukaãƒ•ã‚¡ãƒ“ã‚³ãƒ³.png">
  <script src="https://cdn.tailwindcss.com/"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
  <script>
    // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«èªè¨¼çŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆFirebaseå¯¾å¿œç‰ˆï¼‰
    document.addEventListener('DOMContentLoaded', async function() {
      try {
        // ã¾ãšlocalStorageã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆFirebaseç’°å¢ƒå¯¾å¿œï¼‰
        const currentUser = localStorage.getItem('currentUser');
        
        if (!currentUser) {
          // ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ãªã„å ´åˆã¯ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
          window.location.href = '/login.html?redirect=userpage.html';
          return;
        }
        
        // ã‚µãƒ¼ãƒãƒ¼ãŒåˆ©ç”¨å¯èƒ½ãªå ´åˆã®ã¿ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒç”¨ï¼‰
        try {
          const response = await fetch('/api/auth-status');
          const data = await response.json();
          
          if (!data.isLoggedIn) {
            localStorage.removeItem('currentUser');
            window.location.href = '/login.html?redirect=userpage.html';
            return;
          }
          
          console.log('ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ: ã‚µãƒ¼ãƒãƒ¼ã‚»ãƒƒã‚·ãƒ§ãƒ³èªè¨¼æ¸ˆã¿:', data.username);
        } catch (error) {
          // Firebaseç’°å¢ƒã§ã¯fetchãŒå¤±æ•—ã™ã‚‹ã®ã§ã€localStorageã®ã¿ã§åˆ¤å®š
          console.log('Firebaseç’°å¢ƒ: localStorageãƒ™ãƒ¼ã‚¹èªè¨¼ã‚’ä½¿ç”¨:', currentUser);
        }
        
        // ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã®å ´åˆã¯é€šå¸¸ã®å‡¦ç†ã‚’ç¶šè¡Œ
        console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼æ¸ˆã¿:', currentUser);
        
      } catch (error) {
        console.error('èªè¨¼çŠ¶æ…‹ã®ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
        window.location.href = '/login.html?redirect=userpage.html';
      }
    });
  </script>
  <style>
    @font-face {
      font-family: 'Hiragino Kaku Gothic ProN';
      src: url('fonts/LogotypeGothicCondensed.otf') format('opentype');
      font-weight: normal;
      font-style: normal;
    }
    /* Google Custom Searchã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .gsc-control-searchbox-only {
      width: 100% !important;
      margin: 0 !important;
      padding: 0 !important;
      display: flex !important;
      flex-direction: row !important;
      background-color: rgb(243 244 246) !important;
    }
    .gsc-search-box { /* å…¥åŠ›æ¬„ã¨ãƒœã‚¿ãƒ³ã®ã‚³ãƒ³ãƒ†ãƒŠ */
      width: 100% !important;
      margin: 0 !important;
      padding: 0 !important;
      background-color: #3b3b3b !important; /* Set container background to the desired blue */
    }
    .gsc-input-box { /* å…¥åŠ›æ¬„ã‚³ãƒ³ãƒ†ãƒŠ */
      width: 100% !important;
      margin: 0 !important;
      padding: 0 !important;
      background-color: #FFFFFF !important; /* Override input box background to white */
      border: none !important; /* Remove potential borders */
      box-shadow: none !important; /* Remove potential shadows */
    }
    .gsc-input-box .gsc-input { /* ã‚»ãƒ¬ã‚¯ã‚¿å¤‰æ›´ã€é«˜ã•èª¿æ•´ */
      width: 100% !important;
      margin: 0 !important;
      padding: 0 8px !important; /* paddingè¿½åŠ  */
      background-color: #FFFFFF !important; /* Override input background to white */
      color: #000000 !important; /* Ensure text is visible on white */
      height: 28px !important; /* é«˜ã•ã‚’28pxã«å¤‰æ›´ */
      box-sizing: border-box !important; /* box-sizingè¿½åŠ  */
    }
    /* æ¤œç´¢ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    button.gsc-search-button,
    button.gsc-search-button-v2 {
      display: block !important;
      background-color: #6B7280 !important; /* Changed background color to gray-500 */
      border: none !important;
      padding: 0 !important;
      height: 31px !important; /* Match index.html */
      width: 31px !important; /* Match index.html */
      min-width: 31px !important; /* Match index.html */
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      border-radius: 50% !important;
      margin-right: 8px !important;
      margin-left: 4px !important; /* Add left margin like index.html */
      box-shadow: none !important;
      position: relative !important;
      overflow: hidden !important;
    }

    /* æ¤œç´¢ãƒœã‚¿ãƒ³å†…ã®ç”»åƒã®ã‚¹ã‚¿ã‚¤ãƒ« */
    button.gsc-search-button-v2 svg {
      width: 13px !important;
      height: 13px !important;
      margin: 0 !important;
      position: absolute !important;
      top: 50% !important;
      left: 50% !important;
      transform: translate(-50%, -50%) !important;
    }

    .gsc-search-button-v2:hover {
      background-color: #4B5563 !important; /* Changed hover background color to gray-600 */
      border-color: #3B8AC4 !important; /* Changed hover border color to match index */
    }
    .gsc-results-wrapper {
      width: 100% !important;
    }
    .gsc-results-wrapper-overlay {
      width: 100% !important;
      left: 0 !important;
      right: 0 !important;
      padding: 30px !important;
      box-sizing: border-box !important;
      top: 180px !important;
      height: calc(100% - 180px) !important;
    }
    /* è¿½åŠ ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .gsc-control-cse {
      padding: 0 !important;
      margin: 0 !important;
      border: none !important;
      background-color: transparent !important;
    }
    .gsc-control-cse-ja {
      padding: 0 !important;
      margin: 0 !important;
    }
    .gsc-control-wrapper {
      padding: 0 !important;
      margin: 0 !important;
    }
    .gsc-control-cse-ja .gsc-table-result {
      padding: 0 !important;
      margin: 0 !important;
    }
    .gsc-control-cse-ja .gsc-table-result th {
      padding: 0 !important;
      margin: 0 !important;
    }
    .gsc-control-cse-ja .gsc-table-result td {
      padding: 0 !important;
      margin: 0 !important;
    }
    .gsc-modal-background-image {
      background-color: rgba(0, 0, 0, 0.5) !important;
      top: 180px !important;
      height: calc(100% - 180px) !important;
    }
    .gsc-results-close-btn {
      top: 190px !important;
      right: 10px !important;
    }

    /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .nav-bar {
      background-color: #00B8A9; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®èƒŒæ™¯è‰² */
    }
    .nav-bar a:hover {
      background-color: #7ab5fc; /* ãƒ›ãƒãƒ¼æ™‚ã®èƒŒæ™¯è‰² */
    }

    /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆç”¨ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    section {
      transition: opacity 500ms cubic-bezier(0.4, 0, 0.2, 1);
      opacity: 0;
      position: absolute;
      width: 100%;
      display: none;
    }

    section:not(.hidden) {
      opacity: 1;
      position: relative;
      display: block;
    }

    /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .fade-enter {
      opacity: 0;
    }

    .fade-enter-active {
      opacity: 1;
      transition: opacity 500ms ease-in-out;
    }

    .fade-exit {
      opacity: 1;
    }

    .fade-exit-active {
      opacity: 0;
      transition: opacity 500ms ease-in-out;
    }

    /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }

    ::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }

    /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã«ã‚ˆã‚‹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚·ãƒ•ãƒˆã‚’é˜²ã */
    html {
      overflow-y: scroll;
      scrollbar-gutter: stable;
    }

    /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¨­å®š */
    main {
      overflow-y: auto;
      scrollbar-gutter: stable;
      scrollbar-width: none; /* Firefoxç”¨ */
    }

    /* Webkitãƒ–ãƒ©ã‚¦ã‚¶ç”¨ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼éè¡¨ç¤º */
    main::-webkit-scrollbar {
      display: none;
    }

    /* ã‚³ãƒ³ã‚¿ã‚¯ãƒˆãƒªã‚¹ãƒˆã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¨­å®š */
    #contact-list {
      overflow-y: auto;
      scrollbar-gutter: stable;
    }

    /* åºƒå‘Šã‚¨ãƒªã‚¢ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«è¨­å®š */
    aside {
      overflow-y: auto;
      scrollbar-gutter: stable;
    }

    /* æ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .accordion-content {
      display: none;
      transition: all 0.3s ease;
    }
    
    .accordion-content.active {
      display: block;
    }

    /* ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    @media (max-width: 768px) {
      header {
        margin-bottom: 8px !important;
        padding-bottom: 8px !important;
      }
      nav.nav-bar {
        margin-top: 4px !important; /* ãƒœã‚¿ãƒ³ä¸‹ã®ä½™ç™½ã‚’ç‹­ã‚ã‚‹ */
        margin-bottom: 8px !important; /* ä¸‹ã®ãƒãƒ¼ã‚¸ãƒ³ã‚‚å¿µã®ãŸã‚æŒ‡å®š */
      }
      body {
        margin: 0;
        padding: 0;
        font-size: 12px;
      }

      /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ã¨ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å›²ã‚€ã‚³ãƒ³ãƒ†ãƒŠã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ç¢ºå®Ÿã«é©ç”¨ */
      /* userpage.html ã®æ§‹é€ ã«åˆã‚ã›ã¦ã‚»ãƒ¬ã‚¯ã‚¿ã‚’ç‰¹å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ */
      /* ä¾‹: body > div.flex.gap-4 ã‚„ #main-container ãªã© */
      #main-layout-container { /* IDã‚»ãƒ¬ã‚¯ã‚¿ã«å¤‰æ›´ */
        display: flex !important; 
        flex-direction: row !important;
        gap: 4px;
        /* é«˜ã•ã‚’å†è¨ˆç®— (ãƒ˜ãƒƒãƒ€ãƒ¼ç´„100px + navç´„60px + adç´„60px ã‚’ä»®å®š) */
        /* height: calc(100vh - 100px - 60px - 60px); */
        min-height: calc(100vh - 100px - 60px - 60px); /* min-height ã«å¤‰æ›´ã—ã¦è©¦ã™ */
        overflow: hidden;
        position: relative;
        align-items: flex-start; /* ä¸Šæƒãˆã« */
      }

      #main-layout-container > aside.w-\[150px\] { /* å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
        width: 80px !important;
        min-width: 80px !important;
        flex-shrink: 0 !important;
        height: 100%; /* ã‚³ãƒ³ãƒ†ãƒŠã®é«˜ã•ã«åˆã‚ã›ã‚‹ */
        overflow-y: auto;
        padding: 4px;
        background: #f8f9fa;
        border-right: 1px solid #e9ecef;
      }

      #main-layout-container > main.flex-grow { /* ä¸­å¤®ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
        width: calc(100% - 80px - 4px) !important;
        margin-right: 0 !important;
        flex-grow: 1 !important;
        height: 100%; /* ã‚³ãƒ³ãƒ†ãƒŠã®é«˜ã•ã«åˆã‚ã›ã‚‹ */
        overflow-y: auto;
        padding: 4px;
        margin-top: 0 !important; /* ä¸Šã®ç©ºé–“ã‚’å‰Šé™¤ */
      }

      aside.w-\[225px\] { /* å³åºƒå‘Šã‚µã‚¤ãƒ‰ãƒãƒ¼ã¯éè¡¨ç¤º */
        display: none;
      }

      /* åºƒå‘Šã‚¨ãƒªã‚¢ã®èª¿æ•´ (ä¸‹éƒ¨å›ºå®š) */
      .ad-container {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        width: 100%;
        padding: 4px;
        background: #f8f9fa;
        border-top: 1px solid #e9ecef;
        z-index: 10;
        height: 60px; /* åºƒå‘Šã‚¨ãƒªã‚¢ã®é«˜ã•ã‚’æŒ‡å®š */
      }

      /* å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒœã‚¿ãƒ³èª¿æ•´ */
      .accordion-toggle {
        font-size: 10px; /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’å°‘ã—æˆ»ã™ */
        padding: 8px 4px; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’èª¿æ•´ */
        white-space: normal;
        text-align: center; /* ä¸­å¤®æƒãˆã«å¤‰æ›´ */
        width: 100%;
      }

      /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®èª¿æ•´ */
      section {
        padding: 8px 4px; /* ä¸Šä¸‹ã®ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’å°‘ã—å¢—ã‚„ã™ */
        width: 100%;
      }

      section h2, section h3 { /* è¦‹å‡ºã—è¦ç´  */
        font-size: 14px; /* è¦‹å‡ºã—ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º */
        margin-bottom: 8px !important; /* è¦‹å‡ºã—ä¸‹ã®ãƒãƒ¼ã‚¸ãƒ³ã‚’ç¸®å° */
        margin-top: 0 !important; /* è¦‹å‡ºã—ä¸Šã®ãƒãƒ¼ã‚¸ãƒ³ã‚’å‰Šé™¤ */
      }

      /* "+æ³•è¦è¿½åŠ " ã®ã‚ˆã†ãªãƒœã‚¿ãƒ³ */
      #my-houki .bg-blue-500, 
      #my-tasks .bg-blue-500, 
      #team-tasks .bg-blue-500, 
      #contact-list-section .bg-blue-500 { /* ä»–ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒœã‚¿ãƒ³ã‚‚è€ƒæ…® */
        margin-top: 8px !important; /* è¦‹å‡ºã—ã¨ã®é–“éš”ã‚’èª¿æ•´ */
      }

      /* å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ãƒœã‚¿ãƒ³ã®èª¿æ•´ */
      input, select, textarea {
        font-size: 11px;
        padding: 4px;
      }

      button {
        font-size: 11px;
        padding: 4px 8px;
      }
    }

    /* ã‚¿ãƒƒãƒãƒ‡ãƒã‚¤ã‚¹ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    @media (hover: none) {
      .accordion-toggle,
      .nav-bar a,
      .tool-buttons button {
        padding: 10px 15px;
      }

      .tool-content input[type="number"],
      .tool-content select,
      .tool-content button {
        padding: 10px;
      }

      .user-info input[type="text"],
      .user-info input[type="email"],
      .user-info input[type="password"] {
        padding: 10px;
      }

      .user-info button {
        padding: 10px 20px;
      }
    }

    .opacity-0 {
      opacity: 0;
    }
    .translate-y-4 {
      transform: translateY(1rem);
    }
    .transition-all {
      transition-property: all;
    }
    .duration-500 {
      transition-duration: 500ms;
    }

    .calculator-btn {
      @apply p-2 text-center rounded text-sm font-mono hover:bg-gray-100 transition-colors;
    }

    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
    @media (max-width: 768px) {
      .gsc-control-searchbox-only {
        flex-direction: column !important;
      }
      .gsc-search-button,
      .gsc-search-button-v2 {
        width: 100% !important;
        margin: 8px 0 !important;
      }
    }

    /* ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³è¡¨ç¤ºã§ã®ãƒ˜ãƒƒãƒ€ãƒ¼èª¿æ•´ */
    @media (max-width: 768px) {
      header .flex.flex-col.items-center.mt-4.relative { /* æ¤œç´¢ãƒãƒ¼ã¨ãƒœã‚¿ãƒ³ã®ã‚³ãƒ³ãƒ†ãƒŠ */
        flex-direction: column;
        align-items: stretch; 
        position: static; 
        margin-top: 16px; 
      }

      header .w-full.max-w-2xl { /* æ¤œç´¢ãƒãƒ¼ãƒ©ãƒƒãƒ‘ãƒ¼ */
        max-width: 100%; 
      }

      header .absolute.right-0.flex.gap-2 { /* ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ */
        position: static; 
        margin-top: 8px; 
        justify-content: flex-end; 
      }

      /* ãƒ˜ãƒƒãƒ€ãƒ¼ä¸Šéƒ¨ã®ãƒªãƒ³ã‚¯ã‚³ãƒ³ãƒ†ãƒŠã®èª¿æ•´ */
      header .flex.flex-col.items-start { /* ãƒªãƒ³ã‚¯ã®è¦ªã‚³ãƒ³ãƒ†ãƒŠ */
        width: 100%; /* è¦ªã‚³ãƒ³ãƒ†ãƒŠã‚’å¹…ã„ã£ã±ã„ã« */
        align-items: flex-start; /* align-items: flex-end; ã‚’å‰Šé™¤ã¾ãŸã¯å¤‰æ›´ */
      }

      header .flex.flex-col.items-start .flex.gap-4 { /* ãƒªãƒ³ã‚¯è‡ªä½“ã®ã‚³ãƒ³ãƒ†ãƒŠ */
         width: 100%; /* ã‚³ãƒ³ãƒ†ãƒŠå¹…ã‚’100%ã« */
         margin-top: 4px; 
         justify-content: flex-end; /* ã“ã®è¦ç´ å†…ã®ãƒªãƒ³ã‚¯ã‚’å³å¯„ã› */
      }
    }

    /* ãƒ˜ãƒƒãƒ€ãƒ¼å†…ã®ãƒªãƒ³ã‚¯ã‚’å³å¯„ã› (å‰Šé™¤) */
    /* header .flex.flex-col.items-start .flex.gap-4 {
      justify-content: flex-end; 
      width: 100%; 
    } */

    /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
    .main-layout {
        display: flex;
        margin: 0 auto;
        gap: 15px;
        align-items: stretch;
    }
    
    .today-view {
        flex: 0 0 200px; /* å¹…ã‚’300pxã‹ã‚‰200pxã«å¤‰æ›´ */
        display: flex;
        flex-direction: column;
    }
    
    .today-category-wrapper {
        background-color: #f3f4f6; /* èƒŒæ™¯è‰²ã‚’ã‚°ãƒ¬ãƒ¼ã«å¤‰æ›´ (Tailwind gray-100) */
        border-radius: 8px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        padding: 15px;
        box-sizing: border-box;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        border: 1px solid #d1d5db; /* æ ç·šã‚’è¿½åŠ  (Tailwind gray-300) */
    }
    
    .today-view h2 {
        margin-top: 0;
        font-size: 0.9rem; /* 1.0remã‹ã‚‰ç¸®å° */
        color: #4a6fa5;
        border-bottom: 1px solid #eee;
        padding-bottom: 6px; /* å°‘ã—ç¸®å° */
        margin-bottom: 8px; /* å°‘ã—ç¸®å° */
    }
    
    .today-view-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }
    
    .today-nav-button {
        background: none;
        border: none;
        color: #4a6fa5;
        font-size: 1rem;
        cursor: pointer;
        padding: 0;
        border-radius: 50%;
        transition: background-color 0.3s;
        width: 26px;
        height: 26px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .today-nav-button:hover {
        background-color: #e6f2ff;
    }
    
    .today-date {
        font-size: 0.75rem; /* 0.9remã‹ã‚‰ã•ã‚‰ã«ç¸®å° */
        font-weight: bold;
        color: #555;
        margin: 0 3px; /* å·¦å³ãƒãƒ¼ã‚¸ãƒ³ã‚‚å°‘ã—ç¸®å° */
        white-space: nowrap; /* å¼·åˆ¶çš„ã«ä¸€è¡Œã«ã™ã‚‹ */
        overflow: hidden; /* ã¯ã¿å‡ºã—ãŸå ´åˆã«éš ã™ */
        text-overflow: ellipsis; /* ã¯ã¿å‡ºã—ãŸå ´åˆã«çœç•¥è¨˜å· */
    }
    
    #today-events {
        list-style: none;
        padding: 0;
        margin: 0;
        max-height: 350px;
        overflow-y: auto;
    }
    
    #today-events li {
        background-color: #f8f9fa;
        border-radius: 4px;
        padding: 6px; /* å°‘ã—ç¸®å° */
        margin-bottom: 5px; /* å°‘ã—ç¸®å° */
        font-size: 0.75rem; /* 0.85remã‹ã‚‰ç¸®å° */
        cursor: pointer;
        transition: background-color 0.2s;
    }
    
    #today-events li:hover {
        background-color: #e9ecef;
    }
    
    #today-events .event-time {
        font-weight: bold;
        margin-right: 4px;
        color: #4a6fa5;
        /* font-size ã¯è¦ª li ã‹ã‚‰ç¶™æ‰¿ */
    }
    
    #today-events .event-title {
        display: inline;
        /* font-size ã¯è¦ª li ã‹ã‚‰ç¶™æ‰¿ */
    }
    
    #today-events .event-category {
        display: block;
        font-size: 0.7rem; /* 0.75remã‹ã‚‰ç¸®å° */
        color: #777;
        margin-top: 2px; /* å°‘ã—ç¸®å° */
    }
    
    #today-events .no-events {
        color: #888;
        font-style: italic;
        text-align: center;
        padding: 10px 0;
        background-color: transparent;
        cursor: default;
    }
    #today-events .no-events:hover {
         background-color: transparent;
    }
    
    .calendar-container {
        flex: 1 1 auto;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        background-color: white;
        border-radius: 8px;
        border: 1px solid #d0d7de;
    }
    
    .calendar-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 15px;
        background-color: white;
        color: black;
        border-radius: 0;
    }
    
    .nav-button {
        background: none;
        border: none;
        color: black;
        font-size: 1rem;
        cursor: pointer;
        padding: 5px 8px;
        border-radius: 5px;
        transition: background-color 0.3s;
    }
    
    .nav-button:hover {
        background-color: rgba(0, 0, 0, 0.1);
    }
    
    .calendar-grid {
        display: grid;
        grid-template-columns: 3fr 3fr 3fr 3fr 3fr 2fr 2fr; /* Mon-Fri: 3fr, Sat-Sun: 2fr */
        padding: 5px;
        border-top: 1px solid #eee;
    }
    
    .day-header {
        text-align: left;
        font-weight: bold;
        padding: 8px 5px;
        border-bottom: 1px solid #eee;
        background-color: #f8f9fa;
        font-size: 0.8rem;
    }
    
    .saturday-header {
        color: #1976D2; /* Desaturated blue */
    }
    
    .sunday-header {
        color: #D32F2F; /* Desaturated red */
    }
    
    .day-cell {
        min-height: 110px;
        padding: 5px;
        border: 1px solid #eee;
        cursor: pointer;
        transition: background-color 0.2s;
        font-size: 0.8rem;
        position: relative;
        box-sizing: border-box;
        overflow: hidden;
    }
    
    .day-cell:hover {
        background-color: #f0f4f8;
    }
    
    .day-number {
        font-weight: bold;
        margin-bottom: 3px;
        display: block;
        text-align: left;
    }
    
    .day-number.sunday {
        color: #D32F2F; /* Desaturated red */
    }
    
    .day-number.saturday {
        color: #1976D2; /* Desaturated blue */
    }
    
    .today {
        background-color: #e6f2ff;
        font-weight: bold;
        border: 2px solid #003366;
    }
    
    .other-month {
        color: #aaa;
        background-color: #f9f9f9;
    }
    
    .past-day:not(.other-month):not(.today) {
        background-color: #f0f0f0;
        color: #999;
        cursor: default;
    }
    .past-day:not(.other-month):not(.today):hover { 
        background-color: #e5e5e5; 
    }
   
    .event-list {
        margin-top: 4px;
        font-size: 0.75rem;
        max-height: 80px;
        overflow: hidden;
    }
    
    .event-item {
        padding: 1px 4px;
        margin-bottom: 2px;
        background-color: #e9ecef;
        border-radius: 3px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .event-count {
         position: absolute;
         bottom: 3px;
         right: 3px;
         font-size: 0.7rem;
         color: #888;
         background: rgba(255, 255, 255, 0.7);
         padding: 0 3px;
         border-radius: 2px;
    }
    
    .event-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
        font-size: 14px;
    }
    
    .event-modal-content {
        background-color: white;
        padding: 15px;
        border-radius: 8px;
        width: 90%;
        max-width: 450px;
    }

    .event-modal-content h2 {
        font-size: 1.3rem;
        margin-top: 0;
        margin-bottom: 15px;
        color: #4a6fa5;
    }
    
    .event-form {
        display: flex;
        flex-direction: column;
    }
    
    .form-group {
        margin-bottom: 10px;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 4px;
        font-weight: bold;
        font-size: 0.9rem;
    }
    
    .form-group input, .form-group textarea, .form-group select {
        width: 100%;
        padding: 6px 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
        font-size: 0.9rem;
        resize: none; /* Disable resizing for textarea */
    }
    
    .modal-buttons {
        display: flex;
        justify-content: space-between;
        margin-top: 15px;
    }
    
    .btn {
        padding: 6px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
        font-size: 0.9rem;
    }
    
    .btn-primary {
        background-color: #4a6fa5;
        color: white;
    }
    
    .btn-delete {
        background-color: #ff6b6b;
        color: white;
    }
    
    .btn-cancel {
        background-color: #ddd;
        color: #333;
    }
    
    .today-btn {
        margin-left: 10px;
        background-color: rgba(255, 255, 255, 0.2);
    }

    .month-year-selector { 
        display: flex;
        align-items: center;
    }
    
    .calendar-header select {
        margin: 0 5px;
        padding: 4px 6px;
        border-radius: 4px;
        border: 1px solid #ddd;
        background-color: white;
        color: black;
        font-size: 1rem;
    }
    
    .calendar-header select option {
         color: #333;
         background-color: white;
    }
    
    .todo-list-container {
        flex: 0 0 225px;
        padding: 15px;
        background-color: #f3f4f6; /* èƒŒæ™¯è‰²ã‚’ã‚°ãƒ¬ãƒ¼ã«å¤‰æ›´ (Tailwind gray-100) */
        border-radius: 8px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        border: 1px solid #d1d5db; /* æ ç·šã‚’è¿½åŠ  (Tailwind gray-300) */
    }

    .todo-list-container h3 {
        margin-top: 0;
        color: #4a6fa5;
        border-bottom: 1px solid #eee;
        padding-bottom: 6px; /* å°‘ã—ç¸®å° */
        margin-bottom: 8px; /* å°‘ã—ç¸®å° */
        font-size: 0.9rem; /* 1.0remã‹ã‚‰ç¸®å° */
    }

    .todo-input-group {
        display: flex;
        margin-bottom: 10px;
    }

    #todo-input {
        flex-grow: 1;
        padding: 4px 6px;
        border: 1px solid #ddd;
        border-radius: 4px 0 0 4px;
        margin-right: -1px;
        font-size: 0.75rem; /* 0.8remã‹ã‚‰ç¸®å° */
        box-sizing: border-box; 
    }

    #add-todo-btn {
        padding: 4px 8px;
        background-color: #4a6fa5;
        color: white;
        border: none;
        border-radius: 0 4px 4px 0;
        cursor: pointer;
        font-weight: bold;
        font-size: 0.75rem; /* 0.8remã‹ã‚‰ç¸®å° */
        transition: background-color 0.3s;
        box-sizing: border-box; 
    }
    #add-todo-btn:hover {
        background-color: #3b5998;
    }

    #todo-list {
        list-style: none;
        padding: 0;
        margin: 0;
        max-height: 400px;
        overflow-y: auto;
    }

    #todo-list li {
        display: flex;
        align-items: center;
        padding: 6px 0; /* å°‘ã—ç¸®å° */
        border-bottom: 1px solid #eee;
        font-size: 0.8rem; /* 0.9remã‹ã‚‰ç¸®å° */
    }
    #todo-list li:last-child {
        border-bottom: none;
    }

    #todo-list .todo-text {
        flex-grow: 1;
        margin: 0 8px;
        cursor: pointer;
        font-size: 0.75rem; /* 0.8remã‹ã‚‰ç¸®å° */
    }

    #todo-list .todo-text.completed {
        text-decoration: line-through;
        color: #888;
    }

    #todo-list .todo-actions button {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 0.8rem; /* 0.9remã‹ã‚‰ç¸®å° */
        padding: 4px; /* å°‘ã—ç¸®å° */
        margin-left: 4px; /* å°‘ã—ç¸®å° */
        color: #aaa;
        transition: color 0.2s;
        line-height: 1;
    }
    #todo-list .todo-actions .toggle-btn {
        color: #6fbf73; 
    }
    #todo-list .todo-actions .toggle-btn.completed {
         color: #ffb347; 
    }
    #todo-list .todo-actions .delete-btn {
        color: #ff6b6b; 
    }

    #todo-list .todo-actions button:hover {
        color: #555;
    }
    #todo-list .no-events {
         justify-content: center;
         color: #888;
         font-style: italic;
         padding: 10px 0;
         cursor: default;
    }
      
    .category-1 { background-color: #fffae6; border-left: 3px solid #ffcc00; }
    .category-2 { background-color: #e6f7ff; border-left: 3px solid #1890ff; } 
    .category-3 { background-color: #f6ffed; border-left: 3px solid #52c41a; } 
    .category-4 { background-color: #fff0f6; border-left: 3px solid #eb2f96; } 

    #today-events .category-1 { background-color: #fffae6; border-left: 3px solid #ffcc00; }
    #today-events .category-2 { background-color: #e6f7ff; border-left: 3px solid #1890ff; } 
    #today-events .category-3 { background-color: #f6ffed; border-left: 3px solid #52c41a; } 
    #today-events .category-4 { background-color: #fff0f6; border-left: 3px solid #eb2f96; }
    
    .time-group {
         display: flex;
         gap: 15px;
    }
    .time-group > div {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .time-selects {
        display: flex;
        gap: 5px;
    }

    .time-selects select {
        flex: 1;
    }
    
    @media (max-width: 1200px) {
        .main-layout {
            flex-direction: column;
        }
        .today-view,
        .calendar-container,
        .todo-list-container {
            width: 100%;
            max-width: none;
            margin: 0 auto 15px auto;
        }
        .todo-list-container {
            margin-bottom: 0;
        }
    }
    
    @media (max-width: 768px) {
        .calendar-container {
            max-width: 100%;
            border-radius: 0;
        }
        
        .day-cell {
            min-height: 60px;
            padding: 4px; 
            font-size: 0.75rem;
        }
        .day-header {
             font-size: 0.7rem;
             padding: 6px 3px;
        }
        .event-list {
             max-height: 30px;
        }
    }

    /* --- â–¼â–¼â–¼ ã‚«ãƒ†ã‚´ãƒªç®¡ç†ã‚¹ã‚¿ã‚¤ãƒ« â–¼â–¼â–¼ --- */
#category-manager {
    margin-top: 20px;
    padding-top: 15px;
    border-top: 1px solid #eee;
}

.category-manager-header {
     display: flex;
     justify-content: flex-start; /* Align items to the left */
     align-items: center;
     cursor: pointer; /* Make header clickable */
     margin-bottom: 10px;
}

#category-manager h3 {
    font-size: 0.9rem;
    color: #4a6fa5;
    margin: 0; /* Removed margins */
}

.toggle-button {
     background: none;
     border: none;
     font-size: 0.8rem; /* Make icon smaller */
     cursor: pointer;
     color: #666;
     padding: 0 5px 0 0; /* Reduced right padding */
     line-height: 1;
     display: inline-flex; /* Align icon better */
     align-items: center;
}
.toggle-button::before {
     content: '\25B6'; /* Right-pointing triangle */
     display: inline-block;
     transition: transform 0.2s ease-in-out;
     transform: rotate(0deg);
 }
 #category-manager.open .toggle-button::before {
     transform: rotate(90deg); /* Down-pointing triangle */
 }

.collapsible-content { /* Initially hidden content */
     display: none;
     padding-top: 10px; /* Add some space when open */
}

#category-manager.open .collapsible-content { /* Show content when open */
     display: block;
}

#category-form {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 10px;
}

#category-name-input {
    padding: 6px 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 0.9rem;
}

#color-palette {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    margin-bottom: 10px;
}

.color-swatch {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid transparent;
    transition: border-color 0.2s;
}

.color-swatch.selected {
    border-color: #4a6fa5; /* Highlight selected color */
    box-shadow: 0 0 0 2px white, 0 0 0 4px #4a6fa5;
}

#add-category-btn {
    padding: 6px 10px;
    font-size: 0.85rem;
    background-color: #6fbf73; /* Green color for add */
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    align-self: flex-start; /* Align button left */
    transition: background-color 0.3s;
}
#add-category-btn:hover {
    background-color: #5aae61;
}

#category-list {
    list-style: none;
    padding: 0;
    margin: 10px 0 0 0;
    max-height: 150px;
    overflow-y: auto;
}

#category-list li {
    display: flex;
    align-items: center;
    font-size: 0.85rem;
    padding: 5px 0;
    border-bottom: 1px solid #f0f0f0;
    justify-content: space-between;
}
 #category-list li:last-child {
     border-bottom: none;
 }

.category-list-color {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    margin-right: 8px;
    flex-shrink: 0;
}

.category-list-name {
    flex-grow: 1;
    margin: 0 8px;
}

.category-list-actions {
    display: flex;
    align-items: center;
    gap: 5px;
    flex-shrink: 0;
}

.edit-category-btn,
.delete-category-btn {
     background: none;
     border: none;
     color: #ff6b6b; /* Default delete color */
     cursor: pointer;
     font-size: 0.9rem;
     padding: 2px 4px;
     line-height: 1;
     transition: color 0.2s;
}
/* Use a different color for edit */
 .edit-category-btn {
      color: #4a6fa5; /* Example edit color */
 }

.edit-category-btn:hover,
.delete-category-btn:hover {
     color: #555;
}
/* --- â–²â–²â–² ã‚«ãƒ†ã‚´ãƒªç®¡ç†ã‚¹ã‚¿ã‚¤ãƒ« â–²â–²â–² --- */
  </style>

  <!-- Add CSS to hide number input spinners -->
  <style>
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        appearance: none;
        margin: 0;
    }
    input[type="number"] {
        -moz-appearance: textfield; /* Firefox */
        appearance: textfield;
    }
  </style>
</head>
<body class="bg-white text-gray-600 text-sm" style="font-family: 'Logotype Gothic Condensed', sans-serif;">
  <header class="relative border-gray-300 mb-2"> <!-- mb-2 ã¯å¾Œã§ nav ã« mb-4 ã‚’ã¤ã‘ã‚‹ãŸã‚ç¶­æŒ -->
    <div class="relative bg-[#3b3b3b] pt-4 pb-4 px-4"> <!-- èƒŒæ™¯è‰²ã¨ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°å¤‰æ›´ -->
      <!-- Links Div (Absolute Positioned) -->
      <div class="absolute top-2 right-4"> <!-- çµ¶å¯¾é…ç½®ã«å¤‰æ›´ -->
        <div class="flex gap-4 text-[11px] text-white"> <!-- æ–‡å­—è‰²ç™½ã«å¤‰æ›´ -->
          <!-- USER PAGE ãƒªãƒ³ã‚¯ã¯ index.html ã‹ã‚‰ã®é·ç§»ãªã®ã§ã“ã“ã§ã¯å‰Šé™¤ã‚‚æ¤œè¨ -->
          <!-- <a href="userpage.html" class="hover:underline">userpage</a> -->
          <a href="#" onclick="showRegister()" class="hover:underline">æ–°è¦ä¼šå“¡ç™»éŒ²</a>
          <a href="#" onclick="showPublishForm(event)" class="hover:underline">æ²è¼‰å¸Œæœ›ã¯ã‚³ãƒãƒ©</a>
          <a href="#" onclick="showFeedbackForm(event)" class="hover:underline">ã”æ„è¦‹ãƒ»ã”è¦æœ›</a>
          <a href="#" id="authButton" onclick="showLogin()" class="hover:underline">login</a> <!-- loginãƒœã‚¿ãƒ³ã‚’ã“ã“ã«çµ±åˆ -->
        </div>
      </div>

      <!-- Logo/Desc Div -->
      <div class="flex flex-col items-start gap-2"> <!-- items-start ã«å¤‰æ›´ -->
        <div class="flex items-end gap-2">
          <a href="index.html">
            <img src="image/yaneyukaãƒ­ã‚´3.png" alt="yaneyuka" class="h-12"> <!-- ãƒ­ã‚´å¤‰æ›´ã€ã‚µã‚¤ã‚ºèª¿æ•´ -->
          </a>
          <p class="text-[9pt] text-white">ï½å»ºç¯‰åœŸæœ¨ã®ç·åˆæƒ…å ±ã‚µã‚¤ãƒˆï½</p> <!-- æ–‡å­—è‰²ç™½ã«å¤‰æ›´ -->
        </div>
      </div>

      <!-- Search Div -->
      <div class="flex flex-col items-center mt-4 relative"> <!-- mt-4 ã¯ç¶­æŒ -->
        <div class="w-full max-w-2xl">
          <script async src="https://cse.google.com/cse.js?cx=926ccd1b95a9649b8"></script>
          <div class="gcse-search" data-linktarget="_blank"></div>
        </div>
        <!-- çµ¶å¯¾é…ç½®ã®ãƒœã‚¿ãƒ³ã¯å‰Šé™¤ -->
      </div>
    </div>
    
    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ«å¤‰æ›´ -->
    <nav class="flex flex-wrap md:flex-nowrap overflow-x-auto whitespace-nowrap text-gray-100 text-sm mb-4" style="background-color: #1dad95;">
      <a href="index.html?page=topix" class="nav-item px-4 py-2 hover:bg-gray-200 transition cursor-pointer md:ml-[110pt]">Toppage</a>
      <a href="index.html?page=event" class="nav-item px-4 py-2 hover:bg-gray-200 transition cursor-pointer">ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±</a>
      <a href="index.html?page=new" class="nav-item px-4 py-2 hover:bg-gray-200 transition cursor-pointer">æ–°å•†å“</a>
      <a href="index.html?page=book" class="nav-item px-4 py-2 hover:bg-gray-200 transition cursor-pointer">æ›¸ç±ãƒ»ã‚½ãƒ•ãƒˆ</a>
      <a href="index.html?page=houki" class="nav-item px-4 py-2 hover:bg-gray-200 transition cursor-pointer">æ³•è¦</a>
      <a href="index.html?page=cad" class="nav-item px-4 py-2 hover:bg-gray-200 transition cursor-pointer">æ·»æ™¯ãƒ»CAD</a>
      <a href="index.html?page=project" class="nav-item px-4 py-2 hover:bg-gray-200 transition cursor-pointer">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</a>
      <a href="index.html?page=company" class="nav-item px-4 py-2 hover:bg-gray-200 transition cursor-pointer">æ–½å·¥ä¼šç¤¾</a>
      <a href="index.html?page=office" class="nav-item px-4 py-2 hover:bg-gray-200 transition cursor-pointer">è¨­è¨ˆäº‹å‹™æ‰€</a>
      <a href="index.html?page=job" class="nav-item px-4 py-2 hover:bg-gray-200 transition cursor-pointer">æ±‚äººæƒ…å ±</a>
    </nav>
  </header>

  <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ä¿®æ­£ -->
  <div id="main-layout-container" class="flex p-4">
    <!-- å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼šUsertools -->
    <aside class="w-[150px] shrink-0 text-[14px] mr-4">
      <button class="text-lg font-semibold mb-2 cursor-pointer" onclick="showTodo()">Usertools</button> <!-- onclick ã‚’ showTodo() ã«å¤‰æ›´ -->
      <div class="space-y-0">
        <div>
          <button class="w-full text-left px-4 py-2 cursor-pointer accordion-toggle text-[13px] text-gray-600" onclick="showMyCalendar()">Myã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</button>
        </div>
        <div>
          <button class="w-full text-left px-4 py-2 cursor-pointer accordion-toggle text-[13px] text-gray-600" onclick="showMyHouki()">Myæ³•è¦</button>
        </div>
        <div>
          <button class="w-full text-left px-4 py-2 cursor-pointer accordion-toggle text-[13px] text-gray-600" onclick="showTodo()">Myã‚¿ã‚¹ã‚¯</button>
        </div>
        <div>
          <button class="w-full text-left px-4 py-2 cursor-pointer accordion-toggle text-[13px] text-gray-600" onclick="showTeamTodo()">Teamã‚¿ã‚¹ã‚¯</button>
        </div>
        <!-- ã€Œãƒ„ãƒ¼ãƒ«ã€ã‚’ã€Œä¸€èˆ¬ãƒ„ãƒ¼ãƒ«ã€ã¨ã€Œè¨­è¨ˆãƒ„ãƒ¼ãƒ«ã€ã«åˆ†å‰² -->
        <div>
          <button class="w-full text-left px-4 py-2 cursor-pointer accordion-toggle text-[13px] text-gray-600" onclick="showGeneralTools()">ä¸€èˆ¬ãƒ„ãƒ¼ãƒ«</button>
        </div>
        <div>
          <button class="w-full text-left px-4 py-2 cursor-pointer accordion-toggle text-[13px] text-gray-600" onclick="showDesignTools()">è¨­è¨ˆãƒ„ãƒ¼ãƒ«</button>
        </div>
        <div>
          <button class="w-full text-left px-4 py-2 cursor-pointer accordion-toggle text-[13px] text-gray-600" onclick="toggleSection('contact-area')">æ‹…å½“é€£çµ¡å…ˆ</button>
        </div>
        <div>
          <button class="w-full text-left px-4 py-2 cursor-pointer accordion-toggle text-[13px] text-gray-600" onclick="showSettings()">è¨­å®š</button>
        </div>
      </div>
    </aside>

    <!-- ä¸­å¤®ã‚«ãƒ©ãƒ ï¼šãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <main class="flex-grow mr-4">
      <div id="content-area" class="transition-opacity duration-500 opacity-100">
        <!-- è¨­å®šãƒ‘ãƒãƒ« -->
        <section id="settings-area" class="hidden">
          <div class="flex items-center gap-4 mb-4">
            <h2 class="text-base font-semibold">è¨­å®š</h2>
          </div>
          <div class="bg-white p-6 rounded-lg max-w-md">
            <!-- ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="bg-white p-6 rounded-lg max-w-md mt-4">
              <h3 class="text-sm font-semibold mb-3">ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h3>
              
              <!-- ä¿å­˜çŠ¶æ³è¡¨ç¤º -->
              <div class="bg-gray-50 p-3 rounded mb-4">
                <div class="flex justify-between items-center mb-2">
                  <span class="text-xs text-gray-600">æœ€çµ‚ä¿å­˜:</span>
                  <span id="last-saved-time" class="text-xs text-gray-500">-</span>
                </div>
                <div class="save-status text-[10px] text-gray-500" id="main-save-status">æº–å‚™å®Œäº†</div>
              </div>
              
              <!-- æ‰‹å‹•ä¿å­˜ -->
              <button onclick="manualSave()" class="w-full bg-blue-500 text-white px-4 py-2 rounded text-sm hover:bg-blue-600 transition mb-3">
                ğŸ“ ä»Šã™ãä¿å­˜
              </button>
              
              <!-- è‡ªå‹•ä¿å­˜è¨­å®š -->
              <div class="flex items-center justify-between mb-4">
                <label class="text-sm text-gray-600">è‡ªå‹•ä¿å­˜:</label>
                <div class="flex items-center gap-2">
                  <select id="auto-save-interval" onchange="updateAutoSaveInterval()" class="text-xs border rounded px-2 py-1">
                    <option value="0">ç„¡åŠ¹</option>
                    <option value="1">1åˆ†</option>
                    <option value="5" selected>5åˆ†</option>
                    <option value="10">10åˆ†</option>
                    <option value="30">30åˆ†</option>
                  </select>
                </div>
              </div>
              
              <!-- ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ»ã‚¤ãƒ³ãƒãƒ¼ãƒˆ -->
              <div class="flex gap-2">
                <button onclick="exportData()" class="flex-1 bg-green-500 text-white px-3 py-2 rounded text-xs hover:bg-green-600 transition">
                  ğŸ“¤ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                </button>
                <label class="flex-1 bg-purple-500 text-white px-3 py-2 rounded text-xs hover:bg-purple-600 transition cursor-pointer text-center">
                  ğŸ“¥ ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                  <input type="file" accept=".json" onchange="importData(event)" class="hidden">
                </label>
              </div>
              
              <!-- ä½¿ç”¨æ–¹æ³•èª¬æ˜ -->
              <div class="mt-4 p-3 bg-blue-50 rounded">
                <h4 class="text-xs font-medium text-blue-800 mb-1">ä½¿ç”¨æ–¹æ³•</h4>
                <ul class="text-[10px] text-blue-700 space-y-1">
                  <li>â€¢ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ: ãƒ‡ãƒ¼ã‚¿ã‚’JSONãƒ•ã‚¡ã‚¤ãƒ«ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</li>
                  <li>â€¢ ã‚¤ãƒ³ãƒãƒ¼ãƒˆ: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ</li>
                  <li>â€¢ è‡ªå‹•ä¿å­˜: è¨­å®šã—ãŸé–“éš”ã§è‡ªå‹•çš„ã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜</li>
                </ul>
              </div>
            </div>
            <!-- â˜…â˜…â˜… ã“ã“ã¾ã§è¿½åŠ  â˜…â˜…â˜… -->

          </div>
        </section>
      </div>
      <!-- æ‹…å½“é€£çµ¡å…ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <section id="contact-area" class="hidden">
        <div class="flex items-center gap-4">
          <h2 class="text-base font-semibold">æ‹…å½“é€£çµ¡å…ˆ</h2>
          <div class="flex gap-2 items-center">
            <input type="text" 
              placeholder="ä¼šç¤¾åã‚„æ°åã§æ¤œç´¢..." 
              oninput="searchContacts(this.value)" 
              class="border rounded px-2 py-1 text-xs w-[200px]" />
            <button onclick="clearSearch()" 
              class="text-xs bg-gray-500 text-white px-2 py-1 rounded">
              æ¤œç´¢ã‚¯ãƒªã‚¢
            </button>
          </div>
          </div>
        <div class="mt-2">
          <button onclick="addContact()" 
            class="text-xs bg-blue-500 text-white px-2 py-1 rounded w-fit">
            +é€£çµ¡å…ˆè¿½åŠ 
          </button>
          <div id="contact-list" class="flex flex-wrap gap-2 mt-2"></div>
        </div>
      </section>

      <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼åå…¥åŠ›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <!-- <section id="user-input-section">
        <label for="username" class="block mb-1 font-semibold">ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ã—ã¦é–‹å§‹ï¼š</label>
        <input id="username" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å" class="p-2 border w-full max-w-md mb-2" />
        <button onclick="enterUser()" class="bg-blue-500 text-white px-4 py-2 rounded">é–‹å§‹</button>
      </section> -->

      <!-- TODOãƒªã‚¹ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <section id="user-area" class="hidden">
        <div class="flex items-center gap-4">
          <h2 class="text-base font-semibold">Myã‚¿ã‚¹ã‚¯</h2>
        </div>
        <div class="mt-2">
          <div class="flex gap-2 mb-2">
            <button onclick="showProjectForm()" class="text-xs bg-green-500 text-white px-2 py-1 rounded w-fit">+ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç™»éŒ²</button>
            <button onclick="toggleTodoForm()" class="text-xs bg-blue-500 text-white px-2 py-1 rounded w-fit">+ã‚¿ã‚¹ã‚¯è¿½åŠ </button>
          </div>
          
          <!-- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§éè¡¨ç¤ºï¼‰ -->
          <form id="projectForm" onsubmit="addProject(event)" class="hidden mb-4">
            <div class="flex items-center gap-2 bg-white p-3 rounded-lg">
              <input id="newProjectName" required placeholder="æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå" class="border rounded px-2 py-1 text-xs" />
              <button type="submit" class="text-xs bg-green-500 text-white px-3 py-1 rounded">ç™»éŒ²</button>
              <button type="button" onclick="toggleProjectForm()" class="text-xs bg-gray-500 text-white px-3 py-1 rounded">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
          </form>

          <!-- ã‚¿ã‚¹ã‚¯å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§éè¡¨ç¤ºï¼‰ -->
          <form id="todoForm" onsubmit="addTodo(event)" class="hidden mb-4">
            <div class="flex items-center gap-2 bg-white p-3 rounded-lg max-w-[800px]">
              <div class="w-[20%]">
                <select id="todoProject" required class="w-full border rounded px-2 py-1 text-xs">
                  <option value="">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠ</option>
                </select>
              </div>
              <div class="w-[18%]">
                <input type="date" id="dueDate" required class="w-full border rounded px-2 py-1 text-xs" />
              </div>
              <div class="w-[15%]">
                <select id="todoPriority" required class="w-full border rounded px-2 py-1 text-xs">
                  <option value="">é‡è¦åº¦</option>
                  <option value="high">é«˜</option>
                  <option value="medium">ä¸­</option>
                  <option value="low">ä½</option>
                </select>
              </div>
              <div class="flex-grow">
                <input id="todoText" required placeholder="ã‚¿ã‚¹ã‚¯ã®å†…å®¹" class="w-full border rounded px-2 py-1 text-xs" />
              </div>
              <div class="flex gap-1 h-[28px]">
                <button type="button" onclick="toggleTodoForm()" class="text-xs bg-gray-500 text-white px-3 py-1 rounded h-full">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button type="submit" class="text-xs bg-blue-500 text-white px-3 py-1 rounded h-full">ä¿å­˜</button>
              </div>
            </div>
          </form>

          <!-- ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ -->
          <div id="projectTodoLists" class="grid grid-cols-4 gap-3"></div>
        </div>
      </section>

      <!-- ãƒãƒ¼ãƒ ã‚¿ã‚¹ã‚¯ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <section id="team-area" class="hidden">
        <div class="flex items-center gap-4">
          <h2 class="text-base font-semibold">Teamã‚¿ã‚¹ã‚¯</h2>
        </div>
        <div class="mt-2">
          <div class="flex gap-2 mb-2">
            <button onclick="showTeamProjectForm()" class="text-xs bg-green-500 text-white px-2 py-1 rounded w-fit">+ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç™»éŒ²</button>
            <button onclick="toggleTeamTodoForm()" class="text-xs bg-blue-500 text-white px-2 py-1 rounded w-fit">+ã‚¿ã‚¹ã‚¯è¿½åŠ </button>
            <button onclick="showShareProjectForm()" class="text-xs bg-purple-500 text-white px-2 py-1 rounded w-fit">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…±æœ‰è¨­å®š</button>
          </div>
          
          <!-- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…±æœ‰è¨­å®šãƒ•ã‚©ãƒ¼ãƒ ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§éè¡¨ç¤ºï¼‰ -->
          <form id="shareProjectForm" class="hidden mb-4">
            <div class="bg-white p-3 rounded-lg">
              <h3 class="text-sm font-semibold mb-2">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…±æœ‰è¨­å®š</h3>
              <div class="space-y-3">
                <div>
                  <label class="block text-xs text-gray-600 mb-1">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠ</label>
                  <select id="shareProjectSelect" class="w-full border rounded px-2 py-1 text-xs">
                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                  </select>
                </div>
                <div>
                  <label class="block text-xs text-gray-600 mb-1">å…±æœ‰ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼</label>
                  <div class="flex gap-2">
                    <input type="text" id="shareUserInput" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å" class="flex-grow border rounded px-2 py-1 text-xs" />
                    <button type="button" onclick="addShareUser()" class="text-xs bg-blue-500 text-white px-3 py-1 rounded">è¿½åŠ </button>
                  </div>
                </div>
                <div id="sharedUsersList" class="space-y-1">
                  <!-- å…±æœ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                </div>
                <div class="flex justify-end gap-2 mt-3">
                  <button type="button" onclick="toggleShareProjectForm()" class="text-xs bg-gray-500 text-white px-3 py-1 rounded">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                  <button type="button" onclick="saveShareSettings()" class="text-xs bg-blue-500 text-white px-3 py-1 rounded">ä¿å­˜</button>
                </div>
              </div>
            </div>
          </form>

          <!-- ãƒãƒ¼ãƒ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§éè¡¨ç¤ºï¼‰ -->
          <form id="teamProjectForm" onsubmit="addTeamProject(event)" class="hidden mb-4">
            <div class="flex items-center gap-2 bg-white p-3 rounded-lg">
              <input id="newTeamProjectName" required placeholder="æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå" class="border rounded px-2 py-1 text-xs" />
              <button type="submit" class="text-xs bg-green-500 text-white px-3 py-1 rounded">ç™»éŒ²</button>
              <button type="button" onclick="toggleTeamProjectForm()" class="text-xs bg-gray-500 text-white px-3 py-1 rounded">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
          </form>

          <!-- ãƒãƒ¼ãƒ ã‚¿ã‚¹ã‚¯å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§éè¡¨ç¤ºï¼‰ -->
          <form id="teamTodoForm" onsubmit="addTeamTodo(event)" class="hidden mb-4">
            <div class="flex items-center gap-2 bg-white p-3 rounded-lg max-w-[800px]">
              <div class="w-[20%]">
                <select id="teamTodoProject" required class="w-full border rounded px-2 py-1 text-xs">
                  <option value="">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠ</option>
                </select>
              </div>
              <div class="w-[18%]">
                <input type="date" id="teamDueDate" required class="w-full border rounded px-2 py-1 text-xs" />
              </div>
              <div class="w-[15%]">
                <select id="teamTodoPriority" required class="w-full border rounded px-2 py-1 text-xs">
                  <option value="">é‡è¦åº¦</option>
                  <option value="high">é«˜</option>
                  <option value="medium">ä¸­</option>
                  <option value="low">ä½</option>
                </select>
              </div>
              <div class="flex-grow">
                <input id="teamTodoText" required placeholder="ã‚¿ã‚¹ã‚¯ã®å†…å®¹" class="w-full border rounded px-2 py-1 text-xs" />
              </div>
              <div class="flex gap-1 h-[28px]">
                <button type="button" onclick="toggleTeamTodoForm()" class="text-xs bg-gray-500 text-white px-3 py-1 rounded h-full">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button type="submit" class="text-xs bg-blue-500 text-white px-3 py-1 rounded h-full">ä¿å­˜</button>
              </div>
            </div>
          </form>

          <!-- ãƒãƒ¼ãƒ ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ -->
          <div id="teamProjectTodoLists" class="grid grid-cols-4 gap-3"></div>
        </div>
      </section>

      <!-- Myã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <section id="calendar-area" class="hidden">
        <div class="flex items-center gap-4">
          <h2 class="text-base font-semibold"></h2>
        </div>
        <div class="mt-4 bg-white rounded-lg shadow-sm">
          <div class="main-layout">
            <div class="today-view" id="today-view">
              <div class="today-category-wrapper">
                <h2>æœ¬æ—¥ã®äºˆå®š</h2>
                <div class="today-view-header">
                  <button id="prev-day-view" class="today-nav-button">&#10094;</button>
                  <div class="today-date" id="today-date"></div>
                  <button id="next-day-view" class="today-nav-button">&#10095;</button>
                </div>
                <ul id="today-events">
                  <!-- Today's events will be loaded here by JavaScript -->
                </ul>
        
        <!-- --- â–¼â–¼â–¼ ã‚«ãƒ†ã‚´ãƒªç®¡ç†HTML â–¼â–¼â–¼ --- -->
<div id="category-manager">
  <div class="category-manager-header" id="category-manager-header">
    <button id="toggle-category-manager" class="toggle-button" title="é–‹é–‰"></button>
    <h3>ã‚«ãƒ†ã‚´ãƒªãƒ¼ç®¡ç†</h3>
  </div>
  <div id="category-manager-content" class="collapsible-content overflow-hidden">
    <div id="category-form" class="space-y-2">
      <input type="text" id="category-name-input" placeholder="æ–°ã—ã„ã‚«ãƒ†ã‚´ãƒªå" class="w-full border rounded px-2 py-1 text-xs focus:outline-none focus:border-gray-400">
      <div id="color-palette" class="flex flex-wrap gap-1 py-1 px-2">
        <!-- Color swatches will be added by JS -->
      </div>
      <button id="add-category-btn" class="w-full text-xs bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded transition">ã‚«ãƒ†ã‚´ãƒªè¿½åŠ </button>
    </div>
    <ul id="category-list" class="mt-3 max-h-40 overflow-y-auto space-y-1 pr-1">
      <!-- Category list will be added by JS -->
    </ul>
  </div>
</div>
<!-- --- â–²â–²â–² ã‚«ãƒ†ã‚´ãƒªç®¡ç†HTML â–²â–²â–² --- -->
              </div>
            </div>

               

            <div class="calendar-container">
              <div class="calendar-header">
                <button id="prev-month" class="nav-button">&#10094;</button>
                <div class="month-year-selector">
                  <div id="current-month-year" class="text-base font-medium"></div>
                  <button id="today-btn" class="nav-button today-btn">ä»Šæ—¥</button>
                </div>
                <button id="next-month" class="nav-button">&#10095;</button>
              </div>
              <div class="calendar-grid" id="calendar-grid"></div>
            </div>

            <!-- Todoãƒªã‚¹ãƒˆã¯å³ã‚«ãƒ©ãƒ ã«ç§»å‹• -->

          </div>
        </div>

        <!-- ã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ /ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div class="event-modal" id="event-modal">
          <div class="event-modal-content">
            <h2 id="modal-title">ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ </h2>
            <form id="event-form" class="event-form">
              <input type="hidden" id="event-id">
              <input type="hidden" id="event-date">
              
              <div class="form-group">
                <label for="event-title">äºˆå®š</label>
                <input type="text" id="event-title" required>
              </div>
              
              <div class="form-group time-group">
                <div>
                  <label>é–‹å§‹æ™‚é–“</label>
                  <div class="time-selects">
                    <select id="event-start-hour" class="hour-select"></select>
                    <select id="event-start-minute" class="minute-select"></select>
                  </div>
                </div>
                <div>
                  <label>çµ‚äº†æ™‚é–“</label>
                  <div class="time-selects">
                    <select id="event-end-hour" class="hour-select"></select>
                    <select id="event-end-minute" class="minute-select"></select>
                  </div>
                </div>
              </div>
              
              <div class="form-group">
                <label for="event-category">ã‚«ãƒ†ã‚´ãƒªãƒ¼</label>
                <select id="event-category">
                </select>
              </div>
              
              <div class="form-group">
                <label for="event-description">è©³ç´°</label>
                <textarea id="event-description" rows="3"></textarea>
              </div>
              
              <div class="modal-buttons">
                <div>
                  <button type="button" id="delete-event" class="btn btn-delete" style="display: none;">å‰Šé™¤</button>
                </div>
                <div>
                  <button type="button" id="cancel-event" class="btn btn-cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                  <button type="submit" class="btn btn-primary">ä¿å­˜</button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </section>

      <!-- Myæ³•è¦ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <section id="houki-area" class="hidden">
        <div class="flex items-center gap-4">
          <h2 class="text-base font-semibold">Myæ³•è¦</h2>
        </div>
        <div class="mt-2">
          <button onclick="addHouki()" class="text-xs bg-blue-500 text-white px-2 py-1 rounded w-fit">+æ³•è¦è¿½åŠ </button>
          <div id="houki-list" class="space-y-2 mt-2"></div>
        </div>
      </section>

      <!-- ä¸€èˆ¬ãƒ„ãƒ¼ãƒ«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <section id="general-tools-area" class="hidden">
        <div class="flex items-center gap-4">
          <h2 class="text-base font-semibold">ä¸€èˆ¬ãƒ„ãƒ¼ãƒ«</h2>
        </div>
        <div class="mt-2">
          <div class="flex gap-4 flex-wrap mb-2 tool-buttons">
            <button onclick="toggleToolDisplay('general-tools-area', 'memo-tool-content')" class="tool-button text-xs bg-gray-300 text-black px-2 py-1 rounded w-24 hover:bg-gray-700 hover:text-white transition" data-tool-category="general">ãƒ¡ãƒ¢</button>
            <button onclick="toggleToolDisplay('general-tools-area', 'function-calculator-content')" class="tool-button text-xs bg-gray-300 text-black px-2 py-1 rounded w-24 hover:bg-gray-700 hover:text-white transition" data-tool-category="general">é–¢æ•°é›»å“</button>
            <button onclick="toggleToolDisplay('general-tools-area', 'resize-tool-content')" class="tool-button text-xs bg-gray-300 text-black px-2 py-1 rounded w-24 hover:bg-gray-700 hover:text-white transition" data-tool-category="general">ç”»åƒãƒªã‚µã‚¤ã‚º</button>      
            <button onclick="window.location.href='pdf.html'" class="tool-button text-xs bg-gray-300 text-black px-2 py-1 rounded w-24 hover:bg-gray-700 hover:text-white transition" data-tool-category="general">PDFåœ§ç¸®</button>
          </div>

          <!-- ç”»åƒãƒªã‚µã‚¤ã‚ºãƒ„ãƒ¼ãƒ« -->
          <div id="resize-tool-content" class="tool-content" style="display: none;">
            <div class="max-w-md bg-white rounded-lg shadow-sm border border-gray-100">
              <div class="p-4 border-b border-gray-100">
                <h3 class="text-[13px] font-medium text-gray-800">ç”»åƒãƒªã‚µã‚¤ã‚º</h3>
                <p class="text-[11px] text-gray-500 mt-0.5">è¤‡æ•°ã®ç”»åƒã‚’ä¸€æ‹¬ã§ãƒªã‚µã‚¤ã‚º</p>
              </div>
              <div class="p-4">
                <div id="drop-area" class="border border-dashed border-gray-200 rounded-lg p-4 text-center mb-4 hover:border-gray-300 transition-colors cursor-pointer" onclick="document.getElementById('upload').click()">
                  <input type="file" id="upload" multiple accept="image/*" class="hidden">
                  <div class="flex flex-col items-center justify-center gap-2">
                    <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    <p class="text-[11px] text-gray-600">ç”»åƒã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—</p>
                    <p class="text-[11px] text-gray-400">ã¾ãŸã¯</p>
                    <button class="bg-gray-200 text-gray-700 px-4 py-1.5 rounded text-[11px] hover:bg-gray-300 transition-colors">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</button>
                  </div>
                  <p id="file-name" class="text-[10px] text-gray-400 mt-3"></p>
                </div>
                <div class="space-y-2">
                  <div class="flex items-center justify-between">
                    <label class="text-[11px] text-gray-600">ãƒªã‚µã‚¤ã‚ºå¾Œã®ã‚µã‚¤ã‚ºï¼ˆpxï¼‰</label>
                    <select id="size" class="border border-gray-200 rounded px-2 py-1 text-[11px] focus:outline-none focus:border-gray-300 w-24">
                      <option value="1280">1280px</option>
                      <option value="1024">1024px</option>
                      <option value="800">800px</option>
                      <option value="640">640px</option>
                      <option value="400">400px</option>
                      <option value="320">320px</option>
                      <option value="160">160px</option>
                    </select>
                  </div>
                  <div class="flex justify-end mt-4">
                    <button id="convert-button" onclick="resizeImages()" class="bg-gray-800 text-white px-4 py-1.5 rounded text-[11px] hover:bg-gray-700 transition-colors hidden">ãƒªã‚µã‚¤ã‚ºé–‹å§‹</button>
                  </div>
                </div>
                <canvas id="canvas" class="hidden"></canvas>
              </div>
            </div>
          </div>

          <!-- é–¢æ•°é›»å“ãƒ„ãƒ¼ãƒ« -->
          <div id="function-calculator-content" class="tool-content" style="display: none;">
            <div class="flex gap-4">
              <!-- é–¢æ•°é›»å“æœ¬ä½“ -->
              <div class="w-64 bg-gray-800 rounded-lg shadow-sm border border-gray-700 flex-shrink-0 h-[400px]">
                <div class="p-3 border-b border-gray-700">
                  <h3 class="text-[13px] font-medium text-gray-200">é–¢æ•°é›»å“</h3>
                </div>
                <div class="p-3">
                  <div class="space-y-4">
                    <div class="bg-gray-900 p-4 rounded h-24 flex flex-col justify-between">
                      <input type="text" id="calculator-expression" class="w-full bg-transparent text-right text-sm text-gray-400 focus:outline-none h-1/3" readonly>
                      <input type="text" id="calculator-display" class="w-full bg-transparent text-right text-2xl font-mono focus:outline-none text-gray-100 h-2/3" readonly>
                    </div>
                    <div class="grid grid-cols-5 gap-1">
                      <!-- Row 1 -->
                      <button onclick="calculatorInput('SHIFT')" class="calculator-btn text-xs bg-gray-700 hover:bg-gray-600 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all" id="shift-button">SHIFT</button>
                      <button onclick="calculatorInput('ALPHA')" class="calculator-btn text-xs bg-gray-700 hover:bg-gray-600 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">ALPHA</button>
                      <button onclick="calculatorInput('MODE')" class="calculator-btn text-xs bg-gray-700 hover:bg-gray-600 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">MODE</button>
                      <button onclick="calculatorInput('DEL')" class="calculator-btn text-xs bg-gray-700 hover:bg-gray-600 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">DEL</button>
                      <button onclick="calculatorInput('AC')" class="calculator-btn text-xs bg-gray-600 hover:bg-gray-500 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">AC</button>

                      <!-- Row 2 -->
                      <button onclick="calculatorInput('xÂ²')" class="calculator-btn text-xs bg-gray-700 hover:bg-gray-600 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">xÂ²</button>
                      <button onclick="calculatorInput('x^')" class="calculator-btn text-xs bg-gray-700 hover:bg-gray-600 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">x^</button>
                      <button onclick="calculatorInput('âˆš')" class="calculator-btn text-xs bg-gray-700 hover:bg-gray-600 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">âˆš</button>
                      <button onclick="calculatorInput('log')" class="calculator-btn text-xs bg-gray-700 hover:bg-gray-600 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">log</button>
                      <button onclick="calculatorInput('ln')" class="calculator-btn text-xs bg-gray-700 hover:bg-gray-600 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">ln</button>

                      <!-- Row 3 -->
                      <button onclick="calculatorInput('sin')" class="calculator-btn text-xs bg-gray-700 hover:bg-gray-600 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">sin</button>
                      <button onclick="calculatorInput('cos')" class="calculator-btn text-xs bg-gray-700 hover:bg-gray-600 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">cos</button>
                      <button onclick="calculatorInput('tan')" class="calculator-btn text-xs bg-gray-700 hover:bg-gray-600 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">tan</button>
                      <button onclick="calculatorInput('nCr')" class="calculator-btn text-xs bg-gray-700 hover:bg-gray-600 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">nCr</button>
                      <button onclick="calculatorInput('EXP')" class="calculator-btn text-xs bg-gray-700 hover:bg-gray-600 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">EXP</button>

                      <!-- Row 4 -->
                      <button onclick="calculatorInput('7')" class="py-[0.55rem] px-2 text-center rounded text-sm font-mono hover:bg-gray-100 transition-colors bg-gray-900 hover:bg-gray-800 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">7</button>
                      <button onclick="calculatorInput('8')" class="py-[0.55rem] px-2 text-center rounded text-sm font-mono hover:bg-gray-100 transition-colors bg-gray-900 hover:bg-gray-800 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">8</button>
                      <button onclick="calculatorInput('9')" class="py-[0.55rem] px-2 text-center rounded text-sm font-mono hover:bg-gray-100 transition-colors bg-gray-900 hover:bg-gray-800 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">9</button>
                      <button onclick="calculatorInput('(')" class="py-[0.55rem] px-2 text-center rounded text-sm font-mono hover:bg-gray-100 transition-colors text-xs bg-gray-700 hover:bg-gray-600 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">(</button>
                      <button onclick="calculatorInput(')')" class="py-[0.55rem] px-2 text-center rounded text-sm font-mono hover:bg-gray-100 transition-colors text-xs bg-gray-700 hover:bg-gray-600 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">)</button>

                      <!-- Row 5 -->
                      <button onclick="calculatorInput('4')" class="py-[0.55rem] px-2 text-center rounded text-sm font-mono hover:bg-gray-100 transition-colors bg-gray-900 hover:bg-gray-800 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">4</button>
                      <button onclick="calculatorInput('5')" class="py-[0.55rem] px-2 text-center rounded text-sm font-mono hover:bg-gray-100 transition-colors bg-gray-900 hover:bg-gray-800 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">5</button>
                      <button onclick="calculatorInput('6')" class="py-[0.55rem] px-2 text-center rounded text-sm font-mono hover:bg-gray-100 transition-colors bg-gray-900 hover:bg-gray-800 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">6</button>
                      <button onclick="calculatorInput('Ã—')" class="py-[0.55rem] px-2 text-center rounded text-sm font-mono hover:bg-gray-100 transition-colors bg-gray-700 hover:bg-gray-600 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">Ã—</button>
                      <button onclick="calculatorInput('Ã·')" class="py-[0.55rem] px-2 text-center rounded text-sm font-mono hover:bg-gray-100 transition-colors bg-gray-700 hover:bg-gray-600 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">Ã·</button>

                      <!-- Row 6 -->
                      <button onclick="calculatorInput('1')" class="py-[0.55rem] px-2 text-center rounded text-sm font-mono hover:bg-gray-100 transition-colors bg-gray-900 hover:bg-gray-800 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">1</button>
                      <button onclick="calculatorInput('2')" class="py-[0.55rem] px-2 text-center rounded text-sm font-mono hover:bg-gray-100 transition-colors bg-gray-900 hover:bg-gray-800 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">2</button>
                      <button onclick="calculatorInput('3')" class="py-[0.55rem] px-2 text-center rounded text-sm font-mono hover:bg-gray-100 transition-colors bg-gray-900 hover:bg-gray-800 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">3</button>
                      <button onclick="calculatorInput('+')" class="py-[0.55rem] px-2 text-center rounded text-sm font-mono hover:bg-gray-100 transition-colors bg-gray-700 hover:bg-gray-600 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">+</button>
                      <button onclick="calculatorInput('-')" class="py-[0.55rem] px-2 text-center rounded text-sm font-mono hover:bg-gray-100 transition-colors bg-gray-700 hover:bg-gray-600 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">-</button>

                      <!-- Row 7 -->
                      <button onclick="calculatorInput('0')" class="py-[0.55rem] px-2 text-center rounded text-sm font-mono hover:bg-gray-100 transition-colors bg-gray-900 hover:bg-gray-800 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">0</button>
                      <button onclick="calculatorInput('.')" class="py-[0.55rem] px-2 text-center rounded text-sm font-mono hover:bg-gray-100 transition-colors bg-gray-900 hover:bg-gray-800 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">.</button>
                      <button onclick="calculatorInput('(-)')" class="py-[0.55rem] px-2 text-center rounded text-sm font-mono hover:bg-gray-100 transition-colors text-xs bg-gray-700 hover:bg-gray-600 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">(-)</button>
                      <button onclick="calculatorInput('Ans')" class="py-[0.55rem] px-2 text-center rounded text-sm font-mono hover:bg-gray-100 transition-colors text-xs bg-gray-700 hover:bg-gray-600 text-gray-200 shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">Ans</button>
                      <button onclick="calculatorInput('=')" class="py-[0.55rem] px-2 text-center rounded text-sm font-mono hover:bg-gray-100 transition-colors bg-orange-500 hover:bg-orange-600 text-white shadow-sm active:shadow-inner active:translate-y-[0.5px] transition-all">=</button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- è¨ˆç®—å±¥æ­´ -->
              <div class="flex-1 bg-white rounded-lg shadow-sm border border-gray-100 min-h-0 h-[400px]">
                <div class="p-3 border-b border-gray-100">
                  <h3 class="text-[13px] font-medium text-gray-800">è¨ˆç®—å±¥æ­´</h3>
                </div>
                <div class="p-3 h-[calc(400px-80px)] overflow-y-auto">
                  <div id="calculator-history" class="space-y-2">
                    <!-- è¨ˆç®—å±¥æ­´ãŒã“ã“ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
         <!-- ãƒ¡ãƒ¢ãƒ„ãƒ¼ãƒ« -->
         <div id="memo-tool-content" class="tool-content" style="display: none;">
          <div class="max-w-4xl bg-white rounded-lg shadow-sm border border-gray-100">
            <div class="p-4 border-b border-gray-100">
              <div class="flex justify-between items-center">
                <div>
                  <h3 class="text-[13px] font-medium text-gray-800">ãƒ¡ãƒ¢</h3>
                  <p class="text-[11px] text-gray-500 mt-0.5">ãƒ•ã‚©ãƒ³ãƒˆã‚„è‰²ã‚’å¤‰æ›´ã§ãã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ¡ãƒ¢æ©Ÿèƒ½ã§ã™ã€‚è¨ˆç®—å¼ã‚’å…¥ã‚Œã‚‹ã¨è¨ˆç®—ã‚‚å‡ºæ¥ã¾ã™ã€‚</p>
                </div>
                <button onclick="createNewMemo()" class="flex items-center gap-1 text-[11px] bg-blue-500 text-white px-3 py-1.5 rounded hover:bg-blue-600 transition">
                  <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                  </svg>
                  æ–°è¦ãƒ¡ãƒ¢
                </button>
              </div>
            </div>
            <div class="p-4">
              <div class="flex gap-6">
                <!-- å·¦ã‚µã‚¤ãƒ‰ï¼šãƒ¡ãƒ¢ä¸€è¦§ -->
                <div class="w-1/3">
                  <div class="mb-3">
                    <div class="relative">
                      <input type="text" id="memo-search" placeholder="ãƒ¡ãƒ¢ã‚’æ¤œç´¢..." class="w-full pl-8 pr-2 py-1.5 text-[11px] border border-gray-200 rounded focus:outline-none focus:border-gray-400">
                      <svg class="w-4 h-4 text-gray-400 absolute left-2 top-1/2 transform -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                      </svg>
                    </div>
                  </div>
                  <div class="flex gap-2 mb-3">
                    <select id="memo-category-filter" class="flex-1 text-[11px] border border-gray-200 rounded px-2 py-1.5 focus:outline-none focus:border-gray-400">
                      <option value="">ã‚«ãƒ†ã‚´ãƒª</option>
                    </select>
                    <select id="memo-tag-filter" class="flex-1 text-[11px] border border-gray-200 rounded px-2 py-1.5 focus:outline-none focus:border-gray-400">
                      <option value="">ã‚¿ã‚°</option>
                    </select>
                  </div>
                  <div id="memo-list" class="space-y-2 max-h-[500px] overflow-y-auto pr-2">
                    <!-- ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆã¯JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                  </div>
                </div>

                <!-- å³ã‚µã‚¤ãƒ‰ï¼šã‚¨ãƒ‡ã‚£ã‚¿ -->
                <div class="w-2/3 relative">
                  <div class="space-y-3">
                    <!-- ãƒ¡ãƒ¢è¨­å®š (ã‚«ãƒ†ã‚´ãƒªãƒ»ã‚¿ã‚°) ã‚’å…ˆã«è¡¨ç¤º -->
                    <div class="flex gap-2">
                       <div class="relative flex-1">
                        <input type="text" id="memo-category" placeholder="ã‚«ãƒ†ã‚´ãƒªã‚’å…¥åŠ›..." class="w-full pl-7 pr-2 py-1.5 text-[11px] border border-gray-200 rounded focus:outline-none focus:border-gray-400">
                        <svg class="w-4 h-4 text-gray-400 absolute left-2 top-1/2 transform -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                       </div>
                     </div>
                     <!-- â˜… è¿½åŠ : ã‚¿ã‚°å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ -->
                     <div class="relative">
                       <input type="text" id="memo-tags" placeholder="ã‚¿ã‚°ã‚’ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§å…¥åŠ›... (ä¾‹: é‡è¦,ã‚¢ã‚¤ãƒ‡ã‚¢)" class="w-full pl-7 pr-2 py-1.5 text-[11px] border border-gray-200 rounded focus:outline-none focus:border-gray-400">
                       <svg class="w-4 h-4 text-gray-400 absolute left-2 top-1/2 transform -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.53 0 1.04.21 1.41.59L15 5h3a2 2 0 012 2v10a2 2 0 01-2 2H7a2 2 0 01-2-2V5a2 2 0 012-2zm0 5h10"></path> <!-- ã‚¿ã‚°ã‚¢ã‚¤ã‚³ãƒ³ -->
                       </svg>
                     </div>
                     <!-- â˜… è¿½åŠ ã“ã“ã¾ã§ -->
                    <!-- ãƒ¡ãƒ¢ãƒ˜ãƒƒãƒ€ãƒ¼ (ã‚¿ã‚¤ãƒˆãƒ«) ã‚’æ¬¡ã«è¡¨ç¤º -->
                    <div class="flex items-center gap-2">
                      <input type="text" id="memo-title" placeholder="ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›..." class="flex-1 text-[13px] font-medium border-b border-gray-200 px-2 py-1.5 focus:outline-none focus:border-gray-400">
                    </div>

                    <!-- ã‚¨ãƒ‡ã‚£ã‚¿ã¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ -->
                    <div class="border border-gray-200 rounded">
                      <!-- ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ -->
                      <div class="flex items-center gap-2 p-2 border-b border-gray-200 bg-gray-50">
                        <button onclick="formatDoc('bold')" class="p-1 hover:bg-gray-200 rounded" title="å¤ªå­—">
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
                        </button>
                        <button onclick="formatDoc('italic')" class="p-1 hover:bg-gray-200 rounded" title="æ–œä½“">
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 14M5 5l7 14"></path></svg>
                        </button>
                        <button onclick="formatDoc('underline')" class="p-1 hover:bg-gray-200 rounded" title="ä¸‹ç·š">
                          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 11h14M6 15h12"></path></svg>
                        </button>
                        <input type="color" oninput="formatDoc('foreColor', this.value)" class="h-5 w-5 border-none p-0 cursor-pointer" title="æ–‡å­—è‰²">
                      </div>
                      <!-- ã‚¨ãƒ‡ã‚£ã‚¿æœ¬ä½“ (textareaã‹ã‚‰divã«å¤‰æ›´) -->
                      <div id="memo-content"
                           contenteditable="true"
                           class="w-full h-[400px] p-3 text-[11px] focus:outline-none font-mono overflow-y-auto"
                           ></div>
                      <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ -->
                      <div class="flex justify-between items-center p-1.5 border-t border-gray-200 bg-gray-50">
                          <span id="memo-char-count" class="text-[10px] text-gray-500">0 æ–‡å­—</span>
                          <span id="memo-save-status" class="text-[10px] text-gray-500"></span>
                      </div>
                    </div>

                    <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
                    <div class="flex justify-between items-center">
                      <button onclick="deleteMemo()" class="text-[11px] text-red-500 px-3 py-1.5 rounded hover:bg-red-50 transition hidden" id="delete-button">
                        <span class="flex items-center gap-1">
                          <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m-6 0V5a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                          </svg>
                          å‰Šé™¤
                        </span>
                      </button>
                      <button id="manual-save-button" class="save-memo-btn text-[11px] bg-blue-500 text-white px-4 py-1.5 rounded hover:bg-blue-600 transition flex items-center gap-1 ml-auto">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
                        </svg>
                        ä¿å­˜
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div> 
</section>


      <!-- è¨­è¨ˆæ”¯æ´ãƒ„ãƒ¼ãƒ«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <section id="design-tools-area" class="hidden">
        <div class="flex items-center gap-4">
          <h2 class="text-base font-semibold">è¨­è¨ˆæ”¯æ´ãƒ„ãƒ¼ãƒ«</h2>
        </div>
        <div class="mt-2">
          <div class="flex gap-4 flex-wrap mb-2 tool-buttons">
            <button onclick="toggleToolDisplay('design-tools-area', 'glass-thickness-tool-content')" class="tool-button text-xs bg-gray-300 text-black px-2 py-1 rounded w-24 hover:bg-gray-700 hover:text-white transition" data-tool-category="design">ã‚¬ãƒ©ã‚¹åšè¨ˆç®—</button>
            <button onclick="toggleToolDisplay('design-tools-area', 'rainwater-tool-content')" class="tool-button text-xs bg-gray-300 text-black px-2 py-1 rounded w-24 hover:bg-gray-700 hover:text-white transition" data-tool-category="design">é›¨æ°´è¨ˆç®—</button>
            <a href="test_shoubousetsubi.html" class="tool-button text-xs bg-gray-300 text-black px-2 py-1 rounded w-24 hover:bg-gray-700 hover:text-white transition text-center" data-tool-category="design">æ¶ˆé˜²è¨­å‚™</a>
            <a href="test_koutei.html" class="tool-button text-xs bg-gray-300 text-black px-2 py-1 rounded w-24 hover:bg-gray-700 hover:text-white transition text-center" data-tool-category="design">å·¥ç¨‹è¡¨</a> <!-- Corrected path -->
            <button onclick="toggleToolDisplay('design-tools-area', 'color-checker-content')" class="tool-button text-xs bg-gray-300 text-black px-2 py-1 rounded w-24 hover:bg-gray-700 hover:text-white transition" data-tool-category="design">è‰²å½©ææ¡ˆ</button>
            <button onclick="toggleToolDisplay('design-tools-area', 'unit-volume-tool-content')" class="tool-button text-xs bg-gray-300 text-black px-2 py-1 rounded w-24 hover:bg-gray-700 hover:text-white transition" data-tool-category="design">å˜ä½ä½“ç©è¡¨</button>
          </div>

          <!-- ã‚¬ãƒ©ã‚¹åšã•è¨ˆç®—ãƒ„ãƒ¼ãƒ« -->
          <div id="glass-thickness-tool-content" class="tool-content" style="display: none;">
            <div class="flex flex-col md:flex-row gap-4">
              <!-- ã‚¬ãƒ©ã‚¹åšè¨ˆç®—ãƒ•ã‚©ãƒ¼ãƒ  -->
              <div class="max-w-md w-full md:w-1/2 bg-white rounded-lg shadow-sm border border-gray-100">
              <div class="p-4 border-b border-gray-100">
                <h3 class="text-[13px] font-medium text-gray-800">ã‚¬ãƒ©ã‚¹åšã•è¨ˆç®—</h3>
                <p class="text-[11px] text-gray-500 mt-0.5">é¢¨åœ§åŠ›ã«åŸºã¥ãã‚¬ãƒ©ã‚¹åšã•ã®è¨ˆç®—</p>
              </div>
              <div class="p-4">
                <div class="space-y-4">
                  <div>
                    <label class="block text-[11px] text-gray-600 mb-1">çŸ­è¾ºï¼ˆmmï¼‰</label>
                    <input type="number" id="glass-short-side" class="w-full border border-gray-200 rounded px-2 py-1 text-[11px] focus:outline-none focus:border-gray-300">
                  </div>
                  <div>
                    <label class="block text-[11px] text-gray-600 mb-1">é•·è¾ºï¼ˆmmï¼‰</label>
                    <input type="number" id="glass-long-side" class="w-full border border-gray-200 rounded px-2 py-1 text-[11px] focus:outline-none focus:border-gray-300">
                  </div>
                  <div>
                      <label class="block text-[11px] text-gray-600 mb-1">è¨­è¨ˆé¢¨åœ§åŠ›ï¼ˆN/mÂ²ï¼‰</label>
                      <input type="number" id="wind-pressure" class="w-full border border-gray-200 rounded px-2 py-1 text-[11px] focus:outline-none focus:border-gray-300" placeholder="é¢¨åœ§åŠ›è¨ˆç®—çµæœãŒåæ˜ ã•ã‚Œã¾ã™">
                  </div>
                  <div>
                    <label class="block text-[11px] text-gray-600 mb-1">ã‚¬ãƒ©ã‚¹ç¨®é¡</label>
                    <select id="glass-type" class="w-full border border-gray-200 rounded px-2 py-1 text-[11px] focus:outline-none focus:border-gray-300">
                      <option value="float">ãƒ•ãƒ­ãƒ¼ãƒˆã‚¬ãƒ©ã‚¹</option>
                      <option value="tempered">å¼·åŒ–ã‚¬ãƒ©ã‚¹</option>
                      <option value="laminated">åˆã‚ã›ã‚¬ãƒ©ã‚¹</option>
                    </select>
                  </div>
                    <button onclick="calculateGlassThickness()" class="w-full bg-gray-800 text-white px-4 py-1.5 rounded text-[11px] hover:bg-gray-700 transition-colors">ã‚¬ãƒ©ã‚¹åšè¨ˆç®—</button>
                </div>
                <div id="glass-result" class="mt-4 hidden">
                  <div id="glass-result-content"></div>
                  </div>
                </div>
              </div>

              <!-- é¢¨åœ§åŠ›è¨ˆç®—ãƒ•ã‚©ãƒ¼ãƒ  -->
              <div class="max-w-md w-full md:w-1/2 bg-gray-50 rounded-lg shadow-sm border border-gray-100">
                <div class="p-4 border-b border-gray-100">
                     <h4 class="text-[13px] font-medium text-gray-800">é¢¨åœ§åŠ›è¨ˆç®—</h4>
                     <p class="text-[11px] text-gray-500 mt-0.5">åŸºæº–é¢¨é€Ÿãªã©ã‹ã‚‰è¨­è¨ˆé¢¨åœ§åŠ›ã‚’è¨ˆç®—</p>
                </div>
                <div class="p-4">
                  <div class="space-y-4">
                    <div>
                      <label class="block text-[11px] text-gray-600 mb-1">åœ°åŸŸåŒºåˆ†</label>
                      <select id="region-type" class="w-full border border-gray-200 rounded px-2 py-1 text-[11px] focus:outline-none focus:border-gray-300">
                        <option value="1">â… åœ°åŸŸï¼ˆæµ·å²¸éƒ¨ï¼‰</option>
                        <option value="2" selected>â…¡åœ°åŸŸï¼ˆå¹³åœ°éƒ¨ï¼‰</option>
                        <option value="3">â…¢åœ°åŸŸï¼ˆä¸˜é™µéƒ¨ï¼‰</option>
                        <option value="4">â…£åœ°åŸŸï¼ˆå±±å²³éƒ¨ï¼‰</option>
                      </select>
                    </div>
                    <div>
                      <label class="block text-[11px] text-gray-600 mb-1">å»ºç‰©é«˜ã•ï¼ˆmï¼‰</label>
                      <input type="number" id="building-height" class="w-full border border-gray-200 rounded px-2 py-1 text-[11px] focus:outline-none focus:border-gray-300">
                    </div>
                    <div>
                      <label class="block text-[11px] text-gray-600 mb-1">åŸºæº–é¢¨é€Ÿ Voï¼ˆm/sï¼‰</label>
                      <select id="basic-wind-speed" class="w-full border border-gray-200 rounded px-2 py-1 text-[11px] focus:outline-none focus:border-gray-300">
                        <option value="30">30</option>
                        <option value="32">32</option>
                        <option value="34" selected>34</option> <!-- Default value -->
                        <option value="36">36</option>
                        <option value="38">38</option>
                        <option value="40">40</option>
                        <option value="42">42</option>
                        <option value="44">44</option>
                        <option value="46">46</option>
                      </select>
                    </div>
                    <button onclick="calculateWindPressure()" class="w-full bg-gray-700 text-white px-4 py-1.5 rounded text-[11px] hover:bg-gray-600 transition-colors">é¢¨åœ§åŠ›è¨ˆç®—</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- é›¨æ°´è¨ˆç®—ãƒ„ãƒ¼ãƒ« -->
          <div id="rainwater-tool-content" class="tool-content" style="display: none;">
            <div class="bg-white rounded-lg shadow-sm border border-gray-100">
              <div class="p-4 border-b border-gray-100">
                <h3 class="text-[13px] font-medium text-gray-800">é›¨æ°´è¨ˆç®—</h3>
                <p class="text-[11px] text-gray-500 mt-0.5">è»’æ¨‹ãƒ»ç«ªæ¨‹ã®ç°¡æ˜“è¨ˆç®—</p>
              </div>
              <div class="p-4">
                <div class="flex flex-col md:flex-row gap-4"> 
                  <!-- è»’æ¨‹è¨ˆç®—ãƒ•ã‚©ãƒ¼ãƒ  (å·¦) -->
                  <div class="w-full md:w-1/2 space-y-4 border-r md:border-r-gray-200 pr-0 md:pr-4">
                    <h4 class="text-[12px] font-medium text-gray-800 mb-2">è»’æ¨‹è¨ˆç®—</h4>
                    <div class="space-y-2">
                      <div>
                        <label class="block text-[11px] text-gray-600 mb-1">å¯¾è±¡å±‹æ ¹é¢ç© (æ°´å¹³æŠ•å½±) [m2]</label>
                        <input type="number" id="eaves-roof-area" class="w-full border border-gray-200 rounded px-2 py-1 text-[11px] focus:outline-none focus:border-gray-300">
                      </div>
                      <div>
                        <label class="block text-[11px] text-gray-600 mb-1">åœ°åŸŸåˆ¥é™é›¨å¼·åº¦ [mm/h]</label>
                        <select id="rainfall-intensity" class="w-full border border-gray-200 rounded px-2 py-1 text-[11px] focus:outline-none focus:border-gray-300">
                          <option value="120">120 (æ¨™æº–åœ°åŸŸ)</option>
                          <option value="150">150</option>
                          <option value="180">180</option>
                          <option value="200">200</option>
                        </select>
                      </div>
                      <button onclick="calculateEavesTrough()" class="w-full bg-gray-800 text-white px-4 py-1.5 rounded text-[11px] hover:bg-gray-700 transition-colors">è»’æ¨‹è¨ˆç®—</button>
                    </div>
                  </div>
                  <!-- ç«ªæ¨‹è¨ˆç®—ãƒ•ã‚©ãƒ¼ãƒ  (å³) -->
                  <div class="w-full md:w-1/2 space-y-4 pt-4 md:pt-0">
                    <h4 class="text-[12px] font-medium text-gray-800 mb-2">ç«ªæ¨‹è¨ˆç®—</h4>
                    <div class="space-y-2">
                      <div>
                        <label class="block text-[11px] text-gray-600 mb-1">å—ã‘æŒã¡å±‹æ ¹é¢ç© [m2]</label>
                        <input type="number" id="downpipe-roof-area" class="w-full border border-gray-200 rounded px-2 py-1 text-[11px] focus:outline-none focus:border-gray-300">
                      </div>
                      <div>
                        <label class="block text-[11px] text-gray-600 mb-1">å—ã‘æŒã¡å£é¢ç© [m2]</label>
                        <input type="number" id="downpipe-wall-area" class="w-full border border-gray-200 rounded px-2 py-1 text-[11px] focus:outline-none focus:border-gray-300" value="0">
                      </div>
                      <button onclick="calculateDownpipe()" class="w-full bg-gray-800 text-white px-4 py-1.5 rounded text-[11px] hover:bg-gray-700 transition-colors">ç«ªæ¨‹è¨ˆç®—</button>
                    </div>
                  </div>
                </div>
                <div id="rainwater-result" class="mt-4 hidden">
                  <div id="rainwater-result-content"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- â˜…â˜…â˜… è‰²å½©ãƒã‚§ãƒƒã‚«ãƒ¼ãƒ„ãƒ¼ãƒ« â˜…â˜…â˜… -->
          <div id="color-checker-content" class="tool-content" style="display: none;">
            <div class="max-w-5xl bg-white rounded-lg shadow-sm border border-gray-100"> <!-- max-w-2xl ã‹ã‚‰ max-w-5xl ã«å¤‰æ›´ -->
              <div class="p-4 border-b border-gray-100">
                <h3 class="text-[13px] font-medium text-gray-800">è‰²å½©ãƒã‚§ãƒƒã‚«ãƒ¼</h3>
                <p class="text-[11px] text-gray-500 mt-0.5">åŸºæº–è‰²ã‚’é¸æŠã™ã‚‹ã¨ã€èª¿å’Œã™ã‚‹è‰²ã®çµ„ã¿åˆã‚ã›ã‚’ææ¡ˆã—ã¾ã™ã€‚</p>
        </div>
              <div class="p-4">
                <div class="flex items-center gap-4 mb-6">
                  <label for="base-color-picker" class="text-[11px] text-gray-600">åŸºæº–è‰²:</label>
                  <input type="color" id="base-color-picker" value="#FFFFFF" oninput="suggestColorCombinations(this.value)" class="w-10 h-10 border border-gray-300 rounded cursor-pointer">
                  <span id="base-color-value" class="text-sm font-mono">#FFFFFF</span>
                  <!-- â–¼ ãƒ‘ãƒ¬ãƒƒãƒˆè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ã‚’è¿½åŠ  â–¼ -->
                  <button onclick="toggleColorPalette()" class="ml-4 text-xs bg-gray-200 hover:bg-gray-300 text-gray-700 px-3 py-1 rounded">ãƒ‘ãƒ¬ãƒƒãƒˆ</button>
                  <!-- â–² ãƒ‘ãƒ¬ãƒƒãƒˆè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ã‚’è¿½åŠ  â–² -->
                </div>
                <!-- â–¼ ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ã‚’ã“ã“ã«ç§»å‹• (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆéè¡¨ç¤º) â–¼ -->
                <div id="color-palette" class="mb-6 hidden"></div> <!-- mt-4 ã‚’å‰Šé™¤ã— mb-6 ã‚’è¿½åŠ  -->
                <!-- â–² ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ â–² -->
                <div id="color-suggestions" class="flex flex-wrap gap-4"> <!-- grid ã‹ã‚‰ flex flex-wrap gap-4 ã«å¤‰æ›´ -->
                  <!-- è‰²ã®ææ¡ˆãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                </div>
                <!-- â–¼ ã“ã“ã«ã‚ã£ãŸã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ã‚’å‰Šé™¤ â–¼ -->
                <!-- <div id="color-palette" class="mt-4 hidden"></div> --> 
                <!-- â–² ã“ã“ã«ã‚ã£ãŸã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ã‚’å‰Šé™¤ â–² -->
              </div>
            </div>
          </div>
        </div>

        ã€€          <!-- â–¼â–¼â–¼ å˜ä½ä½“ç©è¡¨ãƒ„ãƒ¼ãƒ« â–¼â–¼â–¼ -->
          <div id="unit-volume-tool-content" class="tool-content" style="display: none;">
            <div class="max-w-2xl bg-white rounded-lg shadow-sm border border-gray-100">
              <div class="p-4 border-b border-gray-100">
                <h3 class="text-[13px] font-medium text-gray-800">å˜ä½ä½“ç©é‡é‡è¨ˆç®—</h3>
                <p class="text-[11px] text-gray-500 mt-0.5">ææ–™ã¨å¯¸æ³•ã‹ã‚‰é‡é‡ã‚’è¨ˆç®—ã—ã¾ã™ã€‚</p>
              </div>
              <div class="p-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <!-- å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
                  <div class="space-y-4">
                    <div>
                      <label for="material-select" class="block text-[11px] text-gray-600 mb-1">ææ–™ã‚’é¸æŠ</label>
                      <select id="material-select" class="w-full border border-gray-200 rounded px-2 py-1 text-[11px] focus:outline-none focus:border-gray-300">
                        <!-- ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯JSã§è¿½åŠ  -->
                      </select>
                    </div>
                    <div class="grid grid-cols-3 gap-2">
                      <div>
                        <label for="material-width" class="block text-[11px] text-gray-600 mb-1">å¹… (mm)</label>
                        <input type="number" id="material-width" placeholder="0" class="w-full border border-gray-200 rounded px-2 py-1 text-[11px] focus:outline-none focus:border-gray-300">
                      </div>
                      <div>
                        <label for="material-depth" class="block text-[11px] text-gray-600 mb-1">å¥¥è¡Œ (mm)</label>
                        <input type="number" id="material-depth" placeholder="0" class="w-full border border-gray-200 rounded px-2 py-1 text-[11px] focus:outline-none focus:border-gray-300">
                      </div>
                      <div>
                        <label for="material-height" class="block text-[11px] text-gray-600 mb-1">é«˜ã• (mm)</label>
                        <input type="number" id="material-height" placeholder="0" class="w-full border border-gray-200 rounded px-2 py-1 text-[11px] focus:outline-none focus:border-gray-300">
                      </div>
                    </div>
                    <button onclick="calculateMaterialWeight()" class="w-full bg-gray-800 text-white px-4 py-1.5 rounded text-[11px] hover:bg-gray-700 transition-colors">é‡é‡è¨ˆç®—</button>
                  </div>
                  <!-- è¨ˆç®—çµæœè¡¨ç¤º -->
                  <div class="bg-gray-50 p-4 rounded-lg flex flex-col justify-center items-center">
                     <p class="text-sm text-gray-600 mb-1">è¨ˆç®—çµæœ</p>
                     <p id="material-weight-result" class="text-2xl font-bold text-gray-800">- kg</p>
                     <p id="unit-weight-display" class="text-xs text-gray-500 mt-2"></p>
                   </div>
                </div>
                 <div class="mt-4 bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
                   <p class="text-sm text-yellow-800">
                     â€»ã“ã®è¨ˆç®—çµæœã¯å‚è€ƒå€¤ã§ã™ã€‚ææ–™ã®å¯†åº¦ã¯ç¨®é¡ã‚„çŠ¶æ…‹ã«ã‚ˆã£ã¦å¤‰å‹•ã—ã¾ã™ã€‚
                   </p>
                 </div>
              </div>
            </div>
          </div>
          <!-- â–²â–²â–² å˜ä½ä½“ç©è¡¨ãƒ„ãƒ¼ãƒ« â–²â–²â–² -->
      </section>
    </main>     
    
    <!-- â˜…â˜…â˜… å³ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼šåºƒå‘Šã‚¨ãƒªã‚¢ â˜…â˜…â˜… -->
    <aside class="w-[225px] shrink-0 text-sm hidden md:block"> <!-- space-y-4 ã‚’å‰Šé™¤ -->
      <!-- ã“ã“ã«ç§»å‹•ã—ãŸTodoãƒªã‚¹ãƒˆã‚’è¿½åŠ  -->
      <div class="todo-list-container hidden mb-4" id="calendar-todo-list"> <!-- ä»£ã‚ã‚Šã«ã“ã“ã«ãƒãƒ¼ã‚¸ãƒ³ã‚’è¿½åŠ  -->
        <h3>Todoãƒªã‚¹ãƒˆ</h3>
        <div class="todo-input-group">
          <input type="text" id="todo-input" placeholder="æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’å…¥åŠ›...">
          <button id="add-todo-btn">è¿½åŠ </button>
        </div>
        <ul id="todo-list">
        </ul>
      </div>

      <div>
        <h4 class="text-[12px] font-semibold mb-1">PR</h4>
        <img src="image/asahikasei_cm.png" class="mb-2 rounded w-[clamp(180px,22vw,320px)]" alt="åºƒå‘Š1" />
        <img src="image/asahikasei_cm.png" class="mb-2 rounded w-[clamp(180px,22vw,320px)]" alt="åºƒå‘Š2" />
        <img src="image/asahikasei_cm.png" class="mb-2 rounded w-[clamp(180px,22vw,320px)]" alt="åºƒå‘Š3" />
      </div>
    </aside>

      <script>
ã€€ã€€ã€€ã€€ // ... (ä»–ã® const å®£è¨€ãŒã‚ã‚Œã°ãã®ä¸‹ã«è¿½åŠ )â€»ã‚«ãƒ†ã‚´ãƒªãƒ¼è¿½åŠ 
        const cancelEventBtn = document.getElementById('cancel-event'); // æ—¢å­˜ã®å¤‰æ•°å®£è¨€ã®ä¾‹
        const prevDayViewBtn = document.getElementById('prev-day-view'); // æ—¢å­˜ã®å¤‰æ•°å®£è¨€ã®ä¾‹
        const nextDayViewBtn = document.getElementById('next-day-view'); // æ—¢å­˜ã®å¤‰æ•°å®£è¨€ã®ä¾‹
        const todoInput = document.getElementById('todo-input');       // æ—¢å­˜ã®å¤‰æ•°å®£è¨€ã®ä¾‹
        const addTodoBtn = document.getElementById('add-todo-btn');     // æ—¢å­˜ã®å¤‰æ•°å®£è¨€ã®ä¾‹
        const todoListUl = document.getElementById('todo-list');       // æ—¢å­˜ã®å¤‰æ•°å®£è¨€ã®ä¾‹

        // â†“â†“â†“ ã“ã“ã‹ã‚‰è¿½åŠ  â†“â†“â†“
        const categoryManagerDiv = document.getElementById('category-manager');
        const categoryManagerHeader = document.getElementById('category-manager-header');
        const toggleCategoryButton = document.getElementById('toggle-category-manager'); // ãƒœã‚¿ãƒ³ã®IDã‚‚å–å¾—
        const categoryManagerContent = document.getElementById('category-manager-content');
        const categoryNameInput = document.getElementById('category-name-input');
        const colorPaletteDiv = document.getElementById('color-palette');
        const addCategoryBtn = document.getElementById('add-category-btn');
        const categoryListUl = document.getElementById('category-list');
        const eventCategorySelect = document.getElementById('event-category'); // ã‚¤ãƒ™ãƒ³ãƒˆç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã‚«ãƒ†ã‚´ãƒªé¸æŠç”¨
        // â†‘â†‘â†‘ ã“ã“ã¾ã§è¿½åŠ  â†‘â†‘â†‘

                // â†‘â†‘â†‘ ã“ã“ã¾ã§è¿½åŠ  â†‘â†‘â†‘

        // â†“â†“â†“ ã“ã“ã‹ã‚‰ã‚«ãƒ†ã‚´ãƒªé–¢é€£é–¢æ•°ã‚’è¿½åŠ  â†“â†“â†“
        function findCategoryById(id) {
            // ID ã‚’ã‚‚ã¨ã« categories é…åˆ—ã‹ã‚‰ã‚«ãƒ†ã‚´ãƒªã‚’æ¢ã—ã¦è¿”ã™
            return categories.find(cat => cat.id === id);
        }

        function saveCategories() {
            // categories é…åˆ—ã®å†…å®¹ã‚’ localStorage ã«ä¿å­˜ã™ã‚‹
            localStorage.setItem('calendarCategories', JSON.stringify(categories));
        }

        function initializeCategories() {
            // localStorage ã‹ã‚‰ã‚«ãƒ†ã‚´ãƒªã‚’èª­ã¿è¾¼ã‚€ã€‚ãªã‘ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¨­å®šã™ã‚‹
            const storedCategories = localStorage.getItem('calendarCategories');
            if (storedCategories) {
                categories = JSON.parse(storedCategories);
            } else {
                // åˆå›èµ·å‹•æ™‚ã¾ãŸã¯ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’è¨­å®š
                categories = [
                    { id: 'cat-1', name: 'å€‹äºº', color: '#fffae6', borderColor: '#ffcc00', isDeletable: true, isEditable: true },
                    { id: 'cat-2', name: 'ä»•äº‹', color: '#e6f7ff', borderColor: '#1890ff', isDeletable: true, isEditable: true },
                    { id: 'cat-3', name: 'é‡è¦', color: '#f6ffed', borderColor: '#52c41a', isDeletable: true, isEditable: true },
                    { id: 'cat-4', name: 'ãã®ä»–', color: '#fff0f6', borderColor: '#eb2f96', isDeletable: false, isEditable: false } // ãã®ä»–ã¯ç·¨é›†ãƒ»å‰Šé™¤ä¸å¯
                ];
                saveCategories(); // åˆæœŸå€¤ã‚’ä¿å­˜
            }
            // å¿µã®ãŸã‚ã€å¤ã„ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ†ã‚´ãƒªãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ (calender.htmlã‹ã‚‰ç§»æ¤)
            localStorage.removeItem('customCategories');
        }

        function initializeColorPalette() {
            // ã‚«ãƒ†ã‚´ãƒªè¿½åŠ ç”¨ã®ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆã‚’ä½œæˆã™ã‚‹
            colorPaletteDiv.innerHTML = ''; // ãƒ‘ãƒ¬ãƒƒãƒˆã‚’ã‚¯ãƒªã‚¢
            paletteColors.forEach(color => {
                const swatch = document.createElement('div');
                swatch.className = 'color-swatch';
                swatch.style.backgroundColor = color;
                swatch.addEventListener('click', () => {
                    // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸè‰²ã‚’é¸æŠçŠ¶æ…‹ã«ã™ã‚‹
                    const currentSelected = colorPaletteDiv.querySelector('.selected');
                    if (currentSelected) {
                        currentSelected.classList.remove('selected');
                    }
                    swatch.classList.add('selected');
                    selectedColor = color; // é¸æŠã•ã‚ŒãŸè‰²ã‚’ä¿å­˜
                });
                colorPaletteDiv.appendChild(swatch);
            });
            // æœ€åˆã¯æœ€åˆã®è‰²ã‚’é¸æŠçŠ¶æ…‹ã«ã—ã¦ãŠã (ä»»æ„)
            if (!selectedColor && colorPaletteDiv.firstChild) {
                 colorPaletteDiv.firstChild.click();
            }
        }

        function renderCategoryList() {
            // ã‚«ãƒ†ã‚´ãƒªç®¡ç†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ã‚«ãƒ†ã‚´ãƒªã®ä¸€è¦§ã‚’è¡¨ç¤ºã™ã‚‹
            categoryListUl.innerHTML = ''; // ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢
            categories.forEach(cat => {
                const li = document.createElement('li');
                li.setAttribute('data-category-id', cat.id);

                const colorDiv = document.createElement('div');
                colorDiv.className = 'category-list-color';
                colorDiv.style.backgroundColor = cat.color; // ã‚«ãƒ†ã‚´ãƒªã®è‰²ã‚’è¡¨ç¤º

                const nameSpan = document.createElement('span');
                nameSpan.className = 'category-list-name';
                nameSpan.textContent = cat.name; // ã‚«ãƒ†ã‚´ãƒªåã‚’è¡¨ç¤º

                li.appendChild(colorDiv);
                li.appendChild(nameSpan);

                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'category-list-actions';
                li.appendChild(actionsDiv);

                // ç·¨é›†ãƒœã‚¿ãƒ³ (ç·¨é›†å¯èƒ½ãƒ•ãƒ©ã‚° isEditable ãŒ false ã§ãªã„å ´åˆ)
                if (cat.isEditable !== false) {
                    const editBtn = document.createElement('button');
                    editBtn.className = 'edit-category-btn';
                    editBtn.innerHTML = '&#9998;'; // é‰›ç­†ã‚¢ã‚¤ã‚³ãƒ³
                    editBtn.title = 'ã‚«ãƒ†ã‚´ãƒªç·¨é›†';
                    editBtn.addEventListener('click', (e) => {
                        e.stopPropagation(); // è¦ªè¦ç´ ã¸ã®ã‚¤ãƒ™ãƒ³ãƒˆä¼æ’­ã‚’åœæ­¢
                        startEditCategory(cat.id);
                    });
                    actionsDiv.appendChild(editBtn);
                }

                // å‰Šé™¤ãƒœã‚¿ãƒ³ (å‰Šé™¤å¯èƒ½ãƒ•ãƒ©ã‚° isDeletable ãŒ false ã§ãªã„å ´åˆ)
                if (cat.isDeletable !== false) {
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'delete-category-btn';
                    deleteBtn.innerHTML = '&#x1F5D1;'; // ã‚´ãƒŸç®±ã‚¢ã‚¤ã‚³ãƒ³
                    deleteBtn.title = 'ã‚«ãƒ†ã‚´ãƒªå‰Šé™¤';
                    deleteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        deleteCategory(cat.id);
                    });
                    actionsDiv.appendChild(deleteBtn);
                }

                categoryListUl.appendChild(li);
            });
        }

        function startEditCategory(id) {
            // ã‚«ãƒ†ã‚´ãƒªç·¨é›†æ©Ÿèƒ½ï¼ˆä»Šå›ã¯æœªå®Ÿè£…ï¼‰
            const category = findCategoryById(id);
            if (!category) return;
            console.log("Editing category:", category); // ç·¨é›†å¯¾è±¡ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›
            alert(`ã‚«ãƒ†ã‚´ãƒªã€Œ${category.name}ã€ã®ç·¨é›†æ©Ÿèƒ½ã¯ã¾ã ä½œã‚‰ã‚Œã¦ã„ã¾ã›ã‚“ã€‚`); // æœªå®Ÿè£…ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        }

        function addCategory() {
            // æ–°ã—ã„ã‚«ãƒ†ã‚´ãƒªã‚’è¿½åŠ ã™ã‚‹
            const name = categoryNameInput.value.trim(); // å…¥åŠ›ã•ã‚ŒãŸåå‰ã‚’å–å¾—ã—ã€å‰å¾Œã®ç©ºç™½ã‚’å‰Šé™¤
            if (!name) {
                alert('ã‚«ãƒ†ã‚´ãƒªåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'); // åå‰ãŒç©ºãªã‚‰è­¦å‘Š
                return;
            }
            if (!selectedColor) {
                alert('è‰²ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚'); // è‰²ãŒé¸æŠã•ã‚Œã¦ã„ãªã‘ã‚Œã°è­¦å‘Š
                return;
            }
            // åŒã˜åå‰ã®ã‚«ãƒ†ã‚´ãƒªãŒæ—¢ã«å­˜åœ¨ã™ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ (å¤§æ–‡å­—å°æ–‡å­—ã‚’åŒºåˆ¥ã—ãªã„)
            if (categories.some(cat => cat.name.toLowerCase() === name.toLowerCase())) {
                alert('åŒã˜åå‰ã®ã‚«ãƒ†ã‚´ãƒªãŒæ—¢ã«å­˜åœ¨ã—ã¾ã™ã€‚');
                return;
            }

            // æ–°ã—ã„ã‚«ãƒ†ã‚´ãƒªã®ãƒ‡ãƒ¼ã‚¿ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
            const newCategory = {
                id: 'custom-' + Date.now().toString(), // ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªIDã‚’ç”Ÿæˆ
                name: name,
                color: selectedColor,
                borderColor: selectedColor, // ãƒœãƒ¼ãƒ€ãƒ¼è‰²ã‚‚åŒã˜è‰²ã«ã™ã‚‹ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆè¡¨ç¤ºç”¨ï¼‰
                isDeletable: true,          // ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ†ã‚´ãƒªã¯å‰Šé™¤å¯èƒ½
                isEditable: true            // ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ†ã‚´ãƒªã¯ç·¨é›†å¯èƒ½
            };

            categories.push(newCategory); // é…åˆ—ã«è¿½åŠ 
            saveCategories();             // localStorage ã«ä¿å­˜
            renderCategoryList();         // ã‚«ãƒ†ã‚´ãƒªãƒªã‚¹ãƒˆã‚’å†æç”»
            populateCategoryDropdown();   // ã‚¤ãƒ™ãƒ³ãƒˆç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚‚æ›´æ–°
            categoryNameInput.value = ''; // å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªã‚¢
            // è‰²é¸æŠã‚’ãƒªã‚»ãƒƒãƒˆ (æœ€åˆã®è‰²ã‚’å†åº¦é¸æŠçŠ¶æ…‹ã«ã™ã‚‹)
            const currentSelected = colorPaletteDiv.querySelector('.selected');
            if (currentSelected) currentSelected.classList.remove('selected');
            if (colorPaletteDiv.firstChild) colorPaletteDiv.firstChild.click();
        }

        function deleteCategory(idToDelete) {
            // ã‚«ãƒ†ã‚´ãƒªã‚’å‰Šé™¤ã™ã‚‹
            const categoryToDelete = findCategoryById(idToDelete);
            if (!categoryToDelete) return; // å¯¾è±¡ãŒè¦‹ã¤ã‹ã‚‰ãªã‘ã‚Œã°ä½•ã‚‚ã—ãªã„

            // å‰Šé™¤ä¸å¯ã‚«ãƒ†ã‚´ãƒªã¯å‰Šé™¤ã—ãªã„
            if (categoryToDelete.isDeletable === false) {
                alert('ã“ã®ã‚«ãƒ†ã‚´ãƒªã¯å‰Šé™¤ã§ãã¾ã›ã‚“ã€‚');
                return;
            }

            // å‰Šé™¤ç¢ºèª
            if (!confirm(`ã‚«ãƒ†ã‚´ãƒªã€Œ${categoryToDelete.name}ã€ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ\nã“ã®ã‚«ãƒ†ã‚´ãƒªã®ã‚¤ãƒ™ãƒ³ãƒˆã¯ã€Œãã®ä»–ã€ã‚«ãƒ†ã‚´ãƒªã«å¤‰æ›´ã•ã‚Œã¾ã™ã€‚`)) {
                return; // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸã‚‰ä½•ã‚‚ã—ãªã„
            }

            // categories é…åˆ—ã‹ã‚‰å‰Šé™¤å¯¾è±¡ã‚’é™¤å¤–
            categories = categories.filter(cat => cat.id !== idToDelete);
            saveCategories(); // localStorage ã‚’æ›´æ–°

            // å‰Šé™¤ã•ã‚ŒãŸã‚«ãƒ†ã‚´ãƒªã«å±ã—ã¦ã„ãŸã‚¤ãƒ™ãƒ³ãƒˆã‚’ã€Œãã®ä»–ã€ã‚«ãƒ†ã‚´ãƒªã«å¤‰æ›´ã™ã‚‹
            const fallbackCategory = categories.find(cat => cat.name === 'ãã®ä»–' && cat.isDeletable === false);
            const fallbackCategoryId = fallbackCategory ? fallbackCategory.id : null;

            if (fallbackCategoryId) {
                events = events.map(event => {
                    if (event.category === idToDelete) {
                        return { ...event, category: fallbackCategoryId }; // ã‚«ãƒ†ã‚´ãƒªIDã‚’ä»˜ã‘æ›¿ãˆã‚‹
                    }
                    return event;
                });
                localStorage.setItem('calendarEvents', JSON.stringify(events)); // ã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã‚‚æ›´æ–°
            } else {
                // ã€Œãã®ä»–ã€ã‚«ãƒ†ã‚´ãƒªãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ (é€šå¸¸ã¯ç™ºç”Ÿã—ãªã„ã¯ãš)
                console.error("ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã€Œãã®ä»–ã€ã‚«ãƒ†ã‚´ãƒªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ã‚¤ãƒ™ãƒ³ãƒˆã®ã‚«ãƒ†ã‚´ãƒªã‚’å¤‰æ›´ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚");
            }

            // UIã‚’æ›´æ–°
            renderCategoryList();       // ã‚«ãƒ†ã‚´ãƒªãƒªã‚¹ãƒˆã‚’å†æç”»
            populateCategoryDropdown(); // ã‚¤ãƒ™ãƒ³ãƒˆç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚‚æ›´æ–°
            renderCalendar();           // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤ºã‚’æ›´æ–° (ã‚¤ãƒ™ãƒ³ãƒˆã®è‰²ãŒå¤‰ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚)
            renderTodayView(viewingDate); // ä»Šæ—¥ã®äºˆå®šè¡¨ç¤ºã‚‚æ›´æ–°
        }
        // â†‘â†‘â†‘ ã“ã“ã¾ã§ã‚«ãƒ†ã‚´ãƒªé–¢é€£é–¢æ•°ã‚’è¿½åŠ  â†‘â†‘â†‘

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let currentUser = 'default_user'; 
        const contacts = [];
        const todos = [];
        const teamTodos = [];
        const houkis = [];
        const projects = [];
        const teamProjects = [];
        const projectShares = {}; // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å…±æœ‰è¨­å®šã‚’ä¿å­˜
        

        // çµ±åˆãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
        const userData = {
            calendar: {
                events: [],
                categories: []
            },
            tasks: {
                personal: [],
                team: []
            },
            projects: {
                user: [],
                team: [],
                shares: {}
            },
            houkis: [],
            memos: [],
            calculator: {
                history: []
            },
            tools: {
                imageResize: { defaultSize: '1280' },
                glassCalculator: { history: [] },
                rainwaterCalculator: { history: [] }
            },
            settings: {},
            lastSaved: null
        };        

        // é‡è¤‡ã—ã¦ã„ã‚‹é–¢æ•°ã‚’å‰Šé™¤ã—ã€ä»¥ä¸‹ã®é–¢æ•°ã«çµ±ä¸€ã—ã¾ã™
        function switchSection(sectionId) {
          // ã™ã¹ã¦ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’éè¡¨ç¤ºã«ã™ã‚‹
          const sections = ['contact-area', 'user-area', 'team-area', 'calendar-area', 'houki-area', 'settings-area', 'user-input-section', 'general-tools-area', 'design-tools-area'];
          const calendarTodoList = document.getElementById('calendar-todo-list');
          
          sections.forEach(id => {
            const section = document.getElementById(id);
            if (section) {
              section.classList.add('hidden');
            }
          });
          // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”¨Todoãƒªã‚¹ãƒˆã‚‚éè¡¨ç¤ºã«ã™ã‚‹
          if (calendarTodoList) {
              calendarTodoList.classList.add('hidden');
          }
          
          // å‹•çš„ã«è¿½åŠ ã•ã‚ŒãŸå¯èƒ½æ€§ã®ã‚ã‚‹ãƒ•ã‚©ãƒ¼ãƒ ã‚’å‰Šé™¤
          const dynamicForms = ['register-form', 'publish-form', 'feedback-form', 'login-form'];
          dynamicForms.forEach(formId => {
            const form = document.getElementById(formId);
            if (form) {
              form.remove();
            }
          });
          
          // æŒ‡å®šã•ã‚ŒãŸã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹
          const targetSection = document.getElementById(sectionId);
          if (targetSection) {
            targetSection.classList.remove('hidden');
            // Myã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤ºæ™‚ã¯Todoãƒªã‚¹ãƒˆã‚‚è¡¨ç¤º
            if (sectionId === 'calendar-area' && calendarTodoList) {
              calendarTodoList.classList.remove('hidden');
            }
          } else {
            console.error(`Section with id ${sectionId} not found.`);
          }
        }

        // ä»¥ä¸‹ã®é–¢æ•°ã‚’è¿½åŠ 
        function toggleSection(id) {
          switchSection(id);
        }

        function showTodo() {
          switchSection('user-area');
        }

        function showTeamTodo() {
          switchSection('team-area');
        }

        function showMyCalendar() {
          switchSection('calendar-area');
          // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’åˆæœŸåŒ–
          initializeCalendar();
        }

        function showMyHouki() {
          switchSection('houki-area');
        }

        function showSettings() {
          switchSection('settings-area');
        }

        // function showUserInput() { // å‰Šé™¤
        //   switchSection('user-input-section');
        // }

        // æ²è¼‰å¸Œæœ›ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
        function showPublishForm(event) {
          if (event) event.preventDefault();
          
          // ä¸­å¤®ã‚«ãƒ©ãƒ ã®ã™ã¹ã¦ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’éè¡¨ç¤ºã«ã™ã‚‹
          const sectionsToHide = ['contact-area', 'user-area', 'team-area', 'calendar-area', 'houki-area', 'settings-area', 'user-input-section', 'general-tools-area', 'design-tools-area'];
          sectionsToHide.forEach(sectionId => {
            const section = document.getElementById(sectionId);
            if (section) {
              section.classList.add('hidden');
            }
          });

          const contentArea = document.getElementById('content-area');
          // ä»¥å‰ã®ãƒ•ã‚©ãƒ¼ãƒ ãŒã‚ã‚Œã°å‰Šé™¤
          const existingRegisterForm = document.getElementById('register-form');
          if (existingRegisterForm) existingRegisterForm.remove();
          const existingFeedbackForm = document.getElementById('feedback-form');
          if (existingFeedbackForm) existingFeedbackForm.remove();
          const existingPublishForm = document.getElementById('publish-form');
          if (existingPublishForm) existingPublishForm.remove();

          contentArea.innerHTML = `
            <div class="opacity-0 transition-all duration-500 ease-in-out transform translate-y-4" id="publish-form"> <!-- id ã‚’ publish-form ã«å¤‰æ›´ -->
              <h2 class="text-lg font-semibold mb-3">æ²è¼‰å¸Œæœ›</h2>
              <div class="bg-white rounded-lg shadow-md p-4 max-w-2xl">
                <form onsubmit="handleRegisterSubmit(event)" class="space-y-4"> <!-- é€ä¿¡å‡¦ç†ã¯é©åˆ‡ãªé–¢æ•°ã«å¤‰æ›´ãŒå¿…è¦ -->
                  <!-- ä¼šç¤¾æƒ…å ± -->
                  <div class="space-y-3">
                    <h3 class="font-semibold text-sm text-gray-700 border-b pb-1">ä¼šç¤¾æƒ…å ±</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div>
                        <label class="block text-xs text-gray-600 mb-1">ä¼šç¤¾å <span class="text-red-500">*</span></label>
                        <input required type="text" name="company" class="w-full border rounded px-2 py-1 text-sm" placeholder="ä¾‹ï¼šæ ªå¼ä¼šç¤¾ã€‡ã€‡">
                      </div>
                      <div>
                        <label class="block text-xs text-gray-600 mb-1">éƒ¨ç½²å</label>
                        <input type="text" name="department" class="w-full border rounded px-2 py-1 text-sm" placeholder="ä¾‹ï¼šå–¶æ¥­éƒ¨">
                      </div>
                    </div>
                  </div>

                  <!-- æ‹…å½“è€…æƒ…å ± -->
                  <div class="space-y-3">
                    <h3 class="font-semibold text-sm text-gray-700 border-b pb-1">ã”æ‹…å½“è€…æ§˜ æƒ…å ±</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div>
                        <label class="block text-xs text-gray-600 mb-1">ã”æ‹…å½“è€…å <span class="text-red-500">*</span></label>
                        <input required type="text" name="name" class="w-full border rounded px-2 py-1 text-sm" placeholder="ä¾‹ï¼šå±±ç”°å¤ªéƒ">
                      </div>
                      <div>
                        <label class="block text-xs text-gray-600 mb-1">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ <span class="text-red-500">*</span></label>
                        <input required type="email" name="email" class="w-full border rounded px-2 py-1 text-sm" placeholder="ä¾‹ï¼šexample@company.com">
                      </div>
                      <div>
                        <label class="block text-xs text-gray-600 mb-1">é›»è©±ç•ªå· <span class="text-red-500">*</span></label>
                        <input required type="tel" name="phone" class="w-full border rounded px-2 py-1 text-sm" placeholder="ä¾‹ï¼š03-1234-5678">
                      </div>
                    </div>
                  </div>

                  <!-- ãŠå•ã„åˆã‚ã›å†…å®¹ -->
                  <div class="space-y-2">
                    <h3 class="font-semibold text-sm text-gray-700 border-b pb-1">ãŠå•ã„åˆã‚ã›å†…å®¹</h3>
                    <textarea name="message" rows="4" class="w-full border rounded px-2 py-1 text-sm" placeholder="æ²è¼‰ã«é–¢ã™ã‚‹ã”è¦æœ›ã‚„ã”è³ªå•ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã”è¨˜å…¥ãã ã•ã„ã€‚"></textarea>
                  </div>

                  <!-- ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ -->
                  <div class="space-y-2">
                    <div class="flex items-start gap-2">
                      <input required type="checkbox" id="privacy" name="privacy" class="mt-1">
                      <label for="privacy" class="text-xs text-gray-600">
                        ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã«åŒæ„ã—ã¾ã™ã€‚
                        <a href="#" class="text-blue-600 hover:underline">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã‚’èª­ã‚€</a>
                      </label>
                    </div>
                  </div>

                  <!-- é€ä¿¡ãƒœã‚¿ãƒ³ -->
                  <div class="text-center">
                    <button type="submit" class="bg-blue-600 text-white px-8 py-2 rounded hover:bg-blue-700 transition-colors text-sm">
                      é€ä¿¡ã™ã‚‹
                    </button>
                  </div>
                </form>
              </div>
            </div>`;

          setTimeout(() => {
            const form = document.getElementById('publish-form'); // id ã‚’ publish-form ã«å¤‰æ›´
            form.classList.remove('opacity-0', 'translate-y-4');
          }, 100);
        }

        // ã”æ„è¦‹ãƒ»ã”è¦æœ›ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
        function showFeedbackForm(event) {
          if (event) event.preventDefault();
          
          // ä¸­å¤®ã‚«ãƒ©ãƒ ã®ã™ã¹ã¦ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’éè¡¨ç¤ºã«ã™ã‚‹
          const sectionsToHide = ['contact-area', 'user-area', 'team-area', 'calendar-area', 'houki-area', 'settings-area', 'user-input-section', 'general-tools-area', 'design-tools-area'];
          sectionsToHide.forEach(sectionId => {
            const section = document.getElementById(sectionId);
            if (section) {
              section.classList.add('hidden');
            }
          });

          const contentArea = document.getElementById('content-area');
          // ä»¥å‰ã®ãƒ•ã‚©ãƒ¼ãƒ ãŒã‚ã‚Œã°å‰Šé™¤
          const existingRegisterForm = document.getElementById('register-form');
          if (existingRegisterForm) existingRegisterForm.remove();
          const existingFeedbackForm = document.getElementById('feedback-form');
          if (existingFeedbackForm) existingFeedbackForm.remove();
          const existingPublishForm = document.getElementById('publish-form');
          if (existingPublishForm) existingPublishForm.remove();

          contentArea.innerHTML = `
            <div class="opacity-0 transition-all duration-500 ease-in-out transform translate-y-4" id="feedback-form">
              <h2 class="text-lg font-semibold mb-3">ã”æ„è¦‹ãƒ»ã”è¦æœ›</h2>
              <div class="bg-white rounded-lg shadow-md p-4 max-w-2xl">
                <form onsubmit="handleFeedbackSubmit(event)" class="space-y-4">
                  <!-- ä¼šç¤¾æƒ…å ± -->
                  <div class="space-y-3">
                    <h3 class="font-semibold text-sm text-gray-700 border-b pb-1">ä¼šç¤¾æƒ…å ±</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div>
                        <label class="block text-xs text-gray-600 mb-1">ä¼šç¤¾å <span class="text-red-500">*</span></label>
                        <input required type="text" name="company" class="w-full border rounded px-2 py-1 text-sm" placeholder="ä¾‹ï¼šæ ªå¼ä¼šç¤¾ã€‡ã€‡">
                      </div>
                      <div>
                        <label class="block text-xs text-gray-600 mb-1">éƒ¨ç½²å</label>
                        <input type="text" name="department" class="w-full border rounded px-2 py-1 text-sm" placeholder="ä¾‹ï¼šå–¶æ¥­éƒ¨">
                      </div>
                    </div>
                  </div>

                  <!-- æ‹…å½“è€…æƒ…å ± -->
                  <div class="space-y-3">
                    <h3 class="font-semibold text-sm text-gray-700 border-b pb-1">ã”æ‹…å½“è€…æ§˜ æƒ…å ±</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div>
                        <label class="block text-xs text-gray-600 mb-1">ã”æ‹…å½“è€…å <span class="text-red-500">*</span></label>
                        <input required type="text" name="name" class="w-full border rounded px-2 py-1 text-sm" placeholder="ä¾‹ï¼šå±±ç”°å¤ªéƒ">
                      </div>
                      <div>
                        <label class="block text-xs text-gray-600 mb-1">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ <span class="text-red-500">*</span></label>
                        <input required type="email" name="email" class="w-full border rounded px-2 py-1 text-sm" placeholder="ä¾‹ï¼šexample@company.com">
                      </div>
                      <div>
                        <label class="block text-xs text-gray-600 mb-1">é›»è©±ç•ªå· <span class="text-red-500">*</span></label>
                        <input required type="tel" name="phone" class="w-full border rounded px-2 py-1 text-sm" placeholder="ä¾‹ï¼š03-1234-5678">
                      </div>
                    </div>
                  </div>

                  <!-- ãŠå•ã„åˆã‚ã›å†…å®¹ -->
                  <div class="space-y-2">
                    <h3 class="font-semibold text-sm text-gray-700 border-b pb-1">ãŠå•ã„åˆã‚ã›å†…å®¹</h3>
                    <textarea name="message" rows="4" class="w-full border rounded px-2 py-1 text-sm" placeholder="ã”æ„è¦‹ãƒ»ã”è¦æœ›ã®å†…å®¹ã‚’ã”è¨˜å…¥ãã ã•ã„ã€‚"></textarea>
                  </div>

                  <!-- ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ -->
                  <div class="space-y-2">
                    <div class="flex items-start gap-2">
                      <input required type="checkbox" id="privacy" name="privacy" class="mt-1">
                      <label for="privacy" class="text-xs text-gray-600">
                        ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã«åŒæ„ã—ã¾ã™ã€‚
                        <a href="#" class="text-blue-600 hover:underline">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã‚’èª­ã‚€</a>
                      </label>
                    </div>
                  </div>

                  <!-- é€ä¿¡ãƒœã‚¿ãƒ³ -->
                  <div class="text-center">
                    <button type="submit" class="bg-blue-600 text-white px-8 py-2 rounded hover:bg-blue-700 transition-colors text-sm">
                      é€ä¿¡ã™ã‚‹
                    </button>
                  </div>
                </form>
              </div>
            </div>`;

          setTimeout(() => {
            const form = document.getElementById('feedback-form');
            form.classList.remove('opacity-0', 'translate-y-4');
          }, 100);
        }

        // æ–°è¦ä¼šå“¡ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
        function showRegister() {
          // ã¾ãšã€ä»–ã®å…¨ã¦ã®é™çš„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’éè¡¨ç¤ºã«ã™ã‚‹
          switchSection(''); // ç©ºæ–‡å­—ã‚’æ¸¡ã™ã“ã¨ã§ã€å…¨ã¦ã®é™çš„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’éš ã—ã€å‹•çš„ãƒ•ã‚©ãƒ¼ãƒ ã‚‚ã‚¯ãƒªã‚¢ã™ã‚‹

          const contentArea = document.getElementById('content-area');
          // æ—¢å­˜ã®ãƒ•ã‚©ãƒ¼ãƒ ãŒæ®‹ã£ã¦ã„ã‚Œã°å‰Šé™¤ (switchSectionã§å‡¦ç†ã•ã‚Œã‚‹ãŒä¸€å¿œæ®‹ã™)
          const existingRegisterForm = document.getElementById('register-form');
          if (existingRegisterForm) existingRegisterForm.remove();
          const existingFeedbackForm = document.getElementById('feedback-form');
          if (existingFeedbackForm) existingFeedbackForm.remove();
          const existingPublishForm = document.getElementById('publish-form');
          if (existingPublishForm) existingPublishForm.remove();
          const existingLoginForm = document.getElementById('login-form'); // login-formã‚‚å‰Šé™¤
          if (existingLoginForm) existingLoginForm.remove();

          contentArea.innerHTML = `
            <div class="opacity-0 transition-all duration-500 ease-in-out transform translate-y-4" id="register-form">
              <h2 class="text-lg font-semibold mb-3">æ–°è¦ä¼šå“¡ç™»éŒ²</h2>
              <div class="bg-white rounded-lg shadow-md p-4 max-w-2xl">
                <form onsubmit="handleRegisterSubmit(event)" class="space-y-4">
                  <div class="space-y-3">
                    <div>
                      <label class="block text-xs text-gray-600 mb-1">ãƒ¦ãƒ¼ã‚¶ãƒ¼å <span class="text-red-500">*</span></label>
                      <input required name="username" class="w-full border rounded px-2 py-1 text-sm" placeholder="user" />
                    </div>
                    <div>
                      <label class="block text-xs text-gray-600 mb-1">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ <span class="text-red-500">*</span></label>
                      <input required name="password" type="password" class="w-full border rounded px-2 py-1 text-sm" placeholder="password" />
                    </div>
                  </div>
                  <div class="text-center mt-4">
                    <button type="submit" class="bg-green-500 text-white px-8 py-2 rounded hover:bg-green-600 transition-colors text-sm">ç™»éŒ²</button>
                  </div>
                  <p class="text-sm text-center mt-4">ã™ã§ã«ç™»éŒ²æ¸ˆã¿ã®æ–¹ã¯ <a href="#" onclick="showLogin()" class="text-blue-600 hover:underline">ãƒ­ã‚°ã‚¤ãƒ³</a></p>
                </form>
              </div>
            </div>`;

          setTimeout(() => {
            const form = document.getElementById('register-form');
            form.classList.remove('opacity-0', 'translate-y-4');
          }, 100);
        }

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼åå…¥åŠ›å‡¦ç†é–¢æ•° - å‰Šé™¤
        // function enterUser() {
        //   const input = document.getElementById("username");
        //   const name = input.value.trim();
        //   if (!name) return alert("ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
        //   currentUser = name;
        //   document.getElementById("user-area").classList.remove("hidden");
        //   input.disabled = true;
        //   renderTodos();
        // }

        // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–¢é€£ã®å¤‰æ•°ã¨ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’è¿½åŠ 
        function showProjectForm() {
          const form = document.getElementById('projectForm');
          form.classList.remove('hidden');
        }

        function toggleProjectForm() {
          const form = document.getElementById('projectForm');
          form.classList.toggle('hidden');
          if (!form.classList.contains('hidden')) {
            document.getElementById('newProjectName').focus();
          }
        }

        function addProject(event) {
          event.preventDefault();
          const projectName = document.getElementById('newProjectName').value.trim();
          
          if (!projectName) {
            alert('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
            return;
          }
          
          if (projects.includes(projectName)) {
            alert('ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™');
            return;
          }
          
          projects.push(projectName);
          document.getElementById('newProjectName').value = '';
          saveAllData(); // çµ±åˆä¿å­˜ã‚·ã‚¹ãƒ†ãƒ ã§ä¿å­˜
          console.log('ğŸ“ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ã—ã¦ä¿å­˜:', projectName);
          toggleProjectForm();
          updateProjectDropdown();
          renderTodos();
        }

        function updateProjectDropdown() {
          const dropdown = document.getElementById('todoProject');
          dropdown.innerHTML = '<option value="">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠ</option>';
          projects.forEach(project => {
            dropdown.innerHTML += `<option value="${project}">${project}</option>`;
          });
        }

        function toggleTodoForm() {
          const form = document.getElementById('todoForm');
          form.classList.toggle('hidden');
          if (!form.classList.contains('hidden')) {
            document.getElementById('todoProject').focus();
          } else {
            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('todoProject').value = '';
            document.getElementById('dueDate').value = '';
            document.getElementById('todoPriority').value = '';
            document.getElementById('todoText').value = '';
          }
        }

        function addTodo(event) {
          event.preventDefault();
          
          const project = document.getElementById("todoProject").value.trim();
          const dueDate = document.getElementById("dueDate").value;
          const priority = document.getElementById("todoPriority").value;
          const todoText = document.getElementById("todoText").value.trim();
          
          if (!project || !dueDate || !priority || !todoText) {
            alert("å…¨ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
            return;
          }
          
          todos.push({
            project: project,
            text: todoText,
            dueDate: dueDate,
            priority: priority,
            completed: false,
            createdAt: new Date()
          });
          
          // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦éè¡¨ç¤ºã«
          document.getElementById("todoProject").value = "";
          document.getElementById("dueDate").value = "";
          document.getElementById("todoPriority").value = "";
          document.getElementById("todoText").value = "";
          saveAllData(); // çµ±åˆä¿å­˜ã‚·ã‚¹ãƒ†ãƒ ã§ä¿å­˜
          console.log('âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ ã—ã¦ä¿å­˜:', todoText, 'in', project);
          toggleTodoForm();
          
          renderTodos();
        }

        function toggleTodo(index) {
          todos[index].completed = !todos[index].completed;
          if (todos[index].completed) {
            // å®Œäº†ã—ãŸã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤
            setTimeout(() => {
              todos.splice(index, 1);
              renderTodos();
            }, 500);
          } else {
            saveAllData(); // çµ±åˆä¿å­˜ã‚·ã‚¹ãƒ†ãƒ ã§ä¿å­˜
            console.log('ğŸ”„ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¿ã‚¹ã‚¯ã‚’æœªå®Œäº†ã«æˆ»ã—ã¦ä¿å­˜');
            renderTodos();
          }
        }

        // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆ¥ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆã‹ã‚‰ã®å‰Šé™¤é–¢æ•°
        function deleteTodoFromProject(projectName, localIndex) {
          // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¯ã«ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã•ã‚ŒãŸé…åˆ—ã‹ã‚‰å®Ÿéš›ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å–å¾—
          const projectTodos = todos.filter(todo => !todo.completed && todo.project === projectName);
          const todoToDelete = projectTodos[localIndex];
          
          if (todoToDelete) {
            const actualIndex = todos.indexOf(todoToDelete);
            if (actualIndex !== -1) {
              // ã‚¹ãƒãƒ¼ãƒˆç¢ºèªUIã‚’è¡¨ç¤º
              showDeleteConfirmation(projectName, localIndex, actualIndex, todoToDelete.text);
            }
          }
        }

        // ã‚¹ãƒãƒ¼ãƒˆå‰Šé™¤ç¢ºèªUI
        function showDeleteConfirmation(projectName, localIndex, actualIndex, todoText) {
          // æ—¢å­˜ã®ç¢ºèªUIãŒã‚ã‚Œã°å‰Šé™¤
          const existingConfirm = document.querySelector('.delete-confirmation');
          if (existingConfirm) {
            existingConfirm.remove();
          }

          // ç¢ºèªUIã‚’ä½œæˆ
          const confirmDiv = document.createElement('div');
          confirmDiv.className = 'delete-confirmation fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white border-2 border-red-200 rounded-lg shadow-lg p-4 z-50 max-w-md';
          confirmDiv.innerHTML = `
            <div class="text-center">
              <div class="mb-3">
                <svg class="mx-auto h-12 w-12 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m-6 0V5a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
              </div>
              <h3 class="text-lg font-medium text-gray-900 mb-2">ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ</h3>
              <p class="text-sm text-gray-500 mb-4 break-words">"${todoText}"</p>
              <div class="flex gap-3 justify-center">
                <button onclick="cancelDeleteConfirmation()" 
                  class="px-4 py-2 text-sm bg-gray-200 text-gray-800 rounded hover:bg-gray-300 transition-colors">
                  ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                </button>
                <button onclick="confirmDeleteTodo(${actualIndex})" 
                  class="px-4 py-2 text-sm bg-red-500 text-white rounded hover:bg-red-600 transition-colors">
                  å‰Šé™¤ã™ã‚‹
                </button>
              </div>
            </div>
          `;

          // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’ä½œæˆ
          const overlay = document.createElement('div');
          overlay.className = 'delete-overlay fixed inset-0 bg-black bg-opacity-50 z-40';
          overlay.onclick = cancelDeleteConfirmation;

          // ä¸­å¤®ã‚«ãƒ©ãƒ ã«è¿½åŠ 
          document.body.appendChild(overlay);
          document.body.appendChild(confirmDiv);

          // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœ
          setTimeout(() => {
            confirmDiv.style.opacity = '0';
            confirmDiv.style.transform = 'translate(-50%, -50%) scale(0.95)';
            confirmDiv.style.transition = 'all 0.2s ease-out';
            setTimeout(() => {
              confirmDiv.style.opacity = '1';
              confirmDiv.style.transform = 'translate(-50%, -50%) scale(1)';
            }, 10);
          }, 0);
        }

        // å‰Šé™¤ç¢ºèªã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
        function cancelDeleteConfirmation() {
          const confirmDiv = document.querySelector('.delete-confirmation');
          const overlay = document.querySelector('.delete-overlay');
          
          if (confirmDiv) {
            confirmDiv.style.opacity = '0';
            confirmDiv.style.transform = 'translate(-50%, -50%) scale(0.95)';
            setTimeout(() => {
              confirmDiv.remove();
              if (overlay) overlay.remove();
            }, 200);
          }
        }

        // å‰Šé™¤ã‚’å®Ÿè¡Œ
        function confirmDeleteTodo(actualIndex) {
          // ç¢ºèªUIã‚’å‰Šé™¤
          cancelDeleteConfirmation();
          
          // ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤
          todos.splice(actualIndex, 1);
          saveAllData(); // çµ±åˆä¿å­˜ã‚·ã‚¹ãƒ†ãƒ ã§ä¿å­˜
          console.log('ğŸ—‘ï¸ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã¦ä¿å­˜');
          renderTodos(); // renderTodosé–¢æ•°ã‚’å‘¼ã³å‡ºã—
          
          // å‰Šé™¤å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
          showSuccessMessage('ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
        }

        // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
        function showSuccessMessage(message) {
          const successDiv = document.createElement('div');
          successDiv.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-300';
          successDiv.textContent = message;
          
          document.body.appendChild(successDiv);
          
          // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
          setTimeout(() => {
            successDiv.style.transform = 'translateX(0)';
          }, 100);
          
          // 3ç§’å¾Œã«è‡ªå‹•å‰Šé™¤
          setTimeout(() => {
            successDiv.style.transform = 'translateX(full)';
            setTimeout(() => {
              if (successDiv.parentNode) {
                successDiv.remove();
              }
            }, 300);
          }, 300);
        }
 
        function renderTodos() {
          const container = document.getElementById("projectTodoLists");
          container.innerHTML = "";
          
          // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¯ã«ã‚¿ã‚¹ã‚¯ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
          const groupedTodos = {};
          todos.filter(todo => !todo.completed).forEach(todo => {
            if (!groupedTodos[todo.project]) {
              groupedTodos[todo.project] = [];
            }
            groupedTodos[todo.project].push(todo);
          });
          
          // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¯ã«ã‚¿ã‚¹ã‚¯ã‚’è¡¨ç¤º
          Object.keys(groupedTodos).forEach(projectName => {
            const projectDiv = document.createElement('div');
            projectDiv.className = 'bg-white p-2 rounded shadow-sm text-xs';
            
            // æœŸé™ã§ã‚½ãƒ¼ãƒˆ
            const sortedTodos = groupedTodos[projectName].sort((a, b) => {
              return new Date(a.dueDate) - new Date(b.dueDate);
            });
            
            projectDiv.innerHTML = `
              <div class="flex items-center justify-between mb-1.5 pb-1.5 border-b">
                <h3 class="font-semibold">${projectName}</h3>
                <span class="text-gray-500">${sortedTodos.length}ä»¶</span>
              </div>
              <div class="space-y-1">
                ${sortedTodos.map((todo, index) => {
                  const isOverdue = new Date(todo.dueDate) < new Date();
                  const priorityColors = {
                    high: 'bg-red-100 text-red-800',
                    medium: 'bg-yellow-100 text-yellow-800',
                    low: 'bg-green-100 text-green-800'
                  };
                  
                  return `
                    <div class="flex items-center gap-1.5 py-0.5 ${isOverdue ? 'text-red-600' : ''}">
                      <input type="checkbox" 
                        onclick="toggleTodo(${todos.indexOf(todo)})" 
                        class="w-3 h-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500" />
                      <div class="w-[70px] flex-shrink-0 text-[10px]">
                        ${todo.dueDate}
                      </div>
                      <div class="flex-grow truncate text-[11px]">
                        ${todo.text}
                      </div>
                      <span class="flex-shrink-0 text-[10px] ${priorityColors[todo.priority]} px-1 rounded-sm">
                        ${todo.priority === 'high' ? 'é«˜' : todo.priority === 'medium' ? 'ä¸­' : 'ä½'}
                      </span>
                      <button onclick="deleteTodoFromProject('${projectName}', ${index})" 
                        class="flex-shrink-0 text-red-500 hover:text-red-700">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m-6 0V5a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                      </button>
                    </div>
                  `;
                }).join('')}
              </div>
            `;
            
            container.appendChild(projectDiv);
          });
        }

        // é€£çµ¡å…ˆé–¢é€£ã®é–¢æ•°ç¾¤
        function addContact() {
          const obj = {
            company: "",
            dept: "",
            name: "",
            role: "",
            phone: "",
            email: "",
            memo: "",
            locked: false  // å¿…ãšãƒ­ãƒƒã‚¯è§£é™¤çŠ¶æ…‹ã§ä½œæˆ
          };
          contacts.push(obj);
          renderContacts();
          saveAllData(); // â˜…çµ±åˆä¿å­˜è¿½åŠ â˜…
          console.log('ğŸ‘¤ é€£çµ¡å…ˆã‚’è¿½åŠ ã—ã¦ä¿å­˜');
          
          // æ–°ã—ãè¿½åŠ ã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰ã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
          const container = document.getElementById("contact-list");
          container.lastElementChild?.scrollIntoView({ behavior: 'smooth' });
        }

        // æ¤œç´¢ã‚¯ãƒªã‚¢é–¢æ•°
        function clearSearch() {
          const searchInput = document.querySelector('input[placeholder="ä¼šç¤¾åã‚„æ°åã§æ¤œç´¢..."]');
          searchInput.value = '';
          const list = document.querySelectorAll('#contact-list > div');
          list.forEach(card => {
            card.style.display = 'block';
          });
          renderContacts();
        }

        function deleteContact(index) {
          contacts.splice(index, 1);
          renderContacts();
          saveAllData(); // â˜…çµ±åˆä¿å­˜è¿½åŠ â˜…
          console.log('ğŸ—‘ï¸ é€£çµ¡å…ˆã‚’å‰Šé™¤ã—ã¦ä¿å­˜');
        }

        function toggleLock(index) {
          if (contacts[index]) {
            contacts[index].locked = !contacts[index].locked;
            renderContacts();
            saveAllData(); // â˜…çµ±åˆä¿å­˜è¿½åŠ â˜…
            console.log('ğŸ”’ é€£çµ¡å…ˆã®ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã‚’å¤‰æ›´ã—ã¦ä¿å­˜');
          }
        }

        function searchContacts(keyword) {
          const list = document.querySelectorAll('#contact-list > div');
          const searchText = keyword.toLowerCase();
          list.forEach(card => {
            const company = card.querySelector('input[placeholder="ä¼šç¤¾å"]').value.toLowerCase();
            const name = card.querySelector('input[placeholder="æ°å"]').value.toLowerCase();
            const dept = card.querySelector('input[placeholder="éƒ¨ç½²å"]').value.toLowerCase();
            const role = card.querySelector('input[placeholder="å½¹è·"]').value.toLowerCase();
            
            if (company.includes(searchText) || 
                name.includes(searchText) || 
                dept.includes(searchText) || 
                role.includes(searchText)) {
              card.style.display = 'block';
            } else {
              card.style.display = 'none';
            }
          });
        }

        // é€£çµ¡å…ˆãƒªã‚¹ãƒˆè¡¨ç¤ºé–¢æ•°
        function renderContacts() {
          contacts.sort((a, b) => {
          const aCompany = a.company || '';
          const bCompany = b.company || '';
          return aCompany.localeCompare(bCompany);
ã€€ã€€ã€€ã€€ã€€});
          const container = document.getElementById("contact-list");
          container.innerHTML = "";
          contacts.forEach((c, idx) => {
            const div = document.createElement("div");
            div.className = "bg-white border rounded text-xs w-[240px] p-2";
            const cardContent = `
             <div class="bg-gray-600 text-white px-2 py-1 flex justify-between items-center">
             <input type="text" value="${c.company || ''}" placeholder="ä¼šç¤¾å" onchange="contacts[${idx}].company = this.value; saveAllData();" class="bg-transparent focus:outline-none w-full" ${c.locked ? 'disabled' : ''} />
             <div class="flex gap-1 items-center ml-2">
             <button onclick="toggleLock(${idx})" class="w-6 h-6 rounded-full bg-white flex items-center justify-center">
                    ${c.locked
                      ? `<svg xmlns='http://www.w3.org/2000/svg' class='w-4 h-4' fill='none' viewBox='0 0 24 24' stroke='black'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M16 11V7a4 4 0 00-8 0v4M5 11h14v10H5V11z'/></svg>`
                      : `<svg xmlns='http://www.w3.org/2000/svg' class='w-4 h-4' fill='none' viewBox='0 0 24 24' stroke='black'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 11V7a4 4 0 00-8 0v4M5 11h14v10H5V11z'/></svg>`}
             </button>
             <button onclick="deleteContact(${idx})" class="w-6 h-6 rounded-full bg-white flex items-center justify-center">
             <svg xmlns='http://www.w3.org/2000/svg' class='w-4 h-4' fill='none' viewBox='0 0 24 24' stroke='black'>
             <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m-6 0V5a1 1 0 00-1-1h-4a1 1 0 00-1 1v2' />
             </svg>
             </button>
             </div>
             </div>
             <div class="px-2 py-1 space-y-1">
             <input type="text" value="${c.dept || ''}" placeholder="éƒ¨ç½²å" onchange="contacts[${idx}].dept = this.value; saveAllData();" class="p-1 border w-full" ${c.locked ? 'disabled' : ''} />
             <input type="text" value="${c.name || ''}" placeholder="æ°å" onchange="contacts[${idx}].name = this.value; saveAllData();" class="p-1 border w-full" ${c.locked ? 'disabled' : ''} />
             <input type="text" value="${c.role || ''}" placeholder="å½¹è·" onchange="contacts[${idx}].role = this.value; saveAllData();" class="p-1 border w-full" ${c.locked ? 'disabled' : ''} />
             <input type="text" value="${c.phone || ''}" placeholder="æºå¸¯ç•ªå·" onchange="contacts[${idx}].phone = this.value; saveAllData();" class="p-1 border w-full" ${c.locked ? 'disabled' : ''} />
             <input type="email" value="${c.email || ''}" placeholder="mail" onchange="contacts[${idx}].email = this.value; saveAllData();" class="p-1 border w-full" ${c.locked ? 'disabled' : ''} />
             <textarea placeholder="memo" onchange="contacts[${idx}].memo = this.value; saveAllData();" class="p-1 border w-full resize-none" ${c.locked ? 'disabled' : ''}>${c.memo || ''}</textarea>
             </div>
             `;
            div.innerHTML = cardContent;
            container.appendChild(div);
          });
        }

        function addHouki() {
          // æ³•è¦è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆ
          const formDiv = document.createElement('div');
          formDiv.className = 'bg-white p-4 rounded mb-2'; // shadow ã‚’å‰Šé™¤
          formDiv.innerHTML = `
            <div class="flex items-center gap-2">
              <input type="text" 
                id="newHoukiName" 
                placeholder="æ³•å¾‹åã‚’å…¥åŠ›" 
                class="p-2 border rounded flex-grow">
              <button onclick="createNewHouki(this.parentElement)" 
                class="px-4 py-2 text-sm bg-blue-500 text-white rounded hover:bg-blue-600">
                è¿½åŠ 
              </button>
              <button onclick="this.parentElement.remove()" 
                class="px-4 py-2 text-sm bg-gray-500 text-white rounded hover:bg-gray-600">
                ã‚­ãƒ£ãƒ³ã‚»ãƒ«
              </button>
            </div>
          `;
          
          // æ³•è¦ãƒªã‚¹ãƒˆã®å‰ã«ãƒ•ã‚©ãƒ¼ãƒ ã‚’æŒ¿å…¥
          const houkiList = document.getElementById('houki-list');
          houkiList.parentNode.insertBefore(formDiv, houkiList);
        }

        function createNewHouki(formDiv) {
          const nameInput = document.getElementById('newHoukiName');
          const name = nameInput.value.trim();
          
          if (!name) {
            alert('æ³•å¾‹åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
            return;
          }

          // æ—¢å­˜ã®æ³•è¦ã¨åå‰ãŒé‡è¤‡ã—ã¦ã„ãªã„ã‹ãƒã‚§ãƒƒã‚¯
          if (houkis.some(h => h.name === name)) {
            alert('ã“ã®æ³•å¾‹åã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™');
            return;
          }

          // æ–°ã—ã„æ³•è¦ã‚’è¿½åŠ ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§1ã¤ã®ç©ºã®æ¡é …ã‚’å«ã‚ã‚‹ï¼‰
          const houki = {
            name: name,
            articles: [{
              number: '',
              text: '',
              locked: false
            }],
            locked: false
          };
          houkis.push(houki);

          saveAllData(); // çµ±åˆä¿å­˜ã‚·ã‚¹ãƒ†ãƒ ã§ä¿å­˜
          console.log('ğŸ“š æ³•è¦ã‚’è¿½åŠ ã—ã¦ä¿å­˜:', name);
          
          // ãƒ•ã‚©ãƒ¼ãƒ ã‚’å‰Šé™¤
          formDiv.remove();
          
          // æ³•è¦ãƒªã‚¹ãƒˆã‚’å†æç”»
          renderHoukis();
          
          // æ–°ã—ãè¿½åŠ ã—ãŸæ³•è¦ã®ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã‚’é–‹ã
          setTimeout(() => {
            const accordion = document.getElementById(`accordion-${name}`);
            if (accordion) {
              accordion.classList.remove('hidden');
            }
          }, 0);
        }

        function renderHoukis() {
          const houkiList = document.getElementById('houki-list');
          houkiList.innerHTML = '';

          // æ³•å¾‹åã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
          const groupedHoukis = houkis.reduce((acc, houki) => {
            if (!acc[houki.name]) {
              acc[houki.name] = [];
            }
            acc[houki.name].push(houki);
            return acc;
          }, {});

          Object.keys(groupedHoukis).forEach(houkiName => {
            const houki = groupedHoukis[houkiName][0];
            const houkiDiv = document.createElement('div');
            houkiDiv.className = 'bg-white p-4 rounded shadow mb-2';
            houkiDiv.setAttribute('data-houki-name', houkiName);

            houkiDiv.innerHTML = `
              <div class="flex items-center gap-2 mb-2">
                <input type="text" 
                  placeholder="æ³•å¾‹å" 
                  value="${houkiName}" 
                  onchange="updateHoukiName('${houkiName}', this.value)" 
                  class="p-2 border" 
                  style="width: 60%;"
                  ${houki.locked ? 'disabled' : ''} />
                <button onclick="toggleAccordion('${houkiName}')" 
                  class="text-xs bg-blue-500 text-white px-2 py-1 rounded">
                  â–¼
                </button>
                <button onclick="lockHouki('${houkiName}')" 
                  class="text-xs ${houki.locked ? 'bg-yellow-500' : 'bg-gray-500'} text-white px-2 py-1 rounded">
                  ${houki.locked ? 'Unlock' : 'Lock'}
                </button>
                ${!houki.locked ? `
                  <button onclick="deleteHouki('${houkiName}')" 
                    class="text-xs bg-red-500 text-white px-2 py-1 rounded">
                  å‰Šé™¤
                  </button>
                ` : ''}
              </div>
              <div id="accordion-${houkiName}" class="space-y-2 hidden">
                ${houki.articles.map((article, articleIndex) => `
                  <div class="flex items-center gap-2 mb-2">
                    <input type="text" 
                      placeholder="æ¡é …" 
                      value="${article.number}" 
                      onchange="updateArticle('${houkiName}', ${articleIndex}, 'number', this.value)"
                      class="p-2 border h-[42px]" 
                      style="width: 20%;" 
                      ${houki.locked ? 'disabled' : ''} />
                    <textarea 
                      placeholder="æ³•æ–‡" 
                      onchange="updateArticle('${houkiName}', ${articleIndex}, 'text', this.value)"
                      class="p-2 border flex-grow h-[42px] resize-none"
                      ${houki.locked ? 'disabled' : ''}>${article.text}</textarea>
                  </div>
                `).join('')}
                ${!houki.locked ? `
                  <button onclick="addArticle('${houkiName}')" 
                    class="text-xs bg-green-500 text-white px-2 py-1 rounded">
                  +æ¡é …è¿½åŠ 
                  </button>
                ` : ''}
              </div>
            `;

            houkiList.appendChild(houkiDiv);
          });
        }

        // === çµ±åˆä¿å­˜ã‚·ã‚¹ãƒ†ãƒ  ===
        // çµ±åˆä¿å­˜é–¢æ•°
        function saveAllData() {
            try {
                updateUserData(); // æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’çµ±åˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«åæ˜ 
                userData.lastSaved = new Date().toISOString();
                localStorage.setItem('yaneyuka_userData', JSON.stringify(userData));
                console.log('âœ… å…¨ãƒ‡ãƒ¼ã‚¿ä¿å­˜å®Œäº†:', userData.lastSaved);
                showSaveStatus('ä¿å­˜å®Œäº†', 'success');
                updateLastSavedDisplay();
                return true;
            } catch (error) {
                console.error('âŒ ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
                showSaveStatus('ä¿å­˜å¤±æ•—', 'error');
                return false;
            }
        }

        // çµ±åˆèª­ã¿è¾¼ã¿é–¢æ•°
        function loadAllData() {
            try {
                const saved = localStorage.getItem('yaneyuka_userData');
                if (saved) {
                    const loaded = JSON.parse(saved);
                    // æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¨ãƒãƒ¼ã‚¸
                    Object.assign(userData, loaded);
                    
                    // å„æ©Ÿèƒ½ã«åæ˜ 
                    if (typeof events !== 'undefined') events = userData.calendar.events || [];
                    if (typeof categories !== 'undefined') categories = userData.calendar.categories || [];
                    if (typeof todos !== 'undefined') todos.splice(0, todos.length, ...(userData.tasks.personal || []));
                    if (typeof teamTodos !== 'undefined') teamTodos.splice(0, teamTodos.length, ...(userData.tasks.team || []));
                    if (typeof houkis !== 'undefined') houkis.splice(0, houkis.length, ...(userData.houkis || []));
                    if (typeof memos !== 'undefined') memos.splice(0, memos.length, ...(userData.memos || []));
                    if (typeof calculatorHistory !== 'undefined') calculatorHistory = userData.calculator.history || [];
                    if (typeof contacts !== 'undefined') contacts.splice(0, contacts.length, ...(userData.contacts || []));
                    if (typeof projects !== 'undefined') projects.splice(0, projects.length, ...(userData.projects.user || []));
                    if (typeof teamProjects !== 'undefined') teamProjects.splice(0, teamProjects.length, ...(userData.projects.team || []));
                    if (typeof projectShares !== 'undefined') Object.assign(projectShares, userData.projects.shares || {});                   
                    console.log('âœ… å…¨ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†:', userData.lastSaved);
                    return true;
                }
            } catch (error) {
                console.error('âŒ èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                return false;
            }
            return false;
        }

        // ãƒ‡ãƒ¼ã‚¿æ›´æ–°é–¢æ•°
        function updateUserData() {
            if (typeof events !== 'undefined') userData.calendar.events = events;
            if (typeof categories !== 'undefined') userData.calendar.categories = categories;
            if (typeof todos !== 'undefined') userData.tasks.personal = todos;
            if (typeof teamTodos !== 'undefined') userData.tasks.team = teamTodos;
            if (typeof houkis !== 'undefined') userData.houkis = houkis;
            if (typeof memos !== 'undefined') userData.memos = memos;
            if (typeof calculatorHistory !== 'undefined') userData.calculator.history = calculatorHistory;
            if (typeof contacts !== 'undefined') userData.contacts = contacts;
            if (typeof projects !== 'undefined') userData.projects.user = projects;
            if (typeof teamProjects !== 'undefined') userData.projects.team = teamProjects;
            if (typeof projectShares !== 'undefined') userData.projects.shares = projectShares;
        }

        // ä¿å­˜çŠ¶æ³è¡¨ç¤º
        function showSaveStatus(message, type = 'info') {
            const statusElements = document.querySelectorAll('#memo-save-status, .save-status, #main-save-status');
            statusElements.forEach(el => {
                if (el) {
                    el.textContent = message;
                    el.className = `save-status text-[10px] ${
                        type === 'success' ? 'text-green-600' : 
                        type === 'error' ? 'text-red-600' : 'text-gray-500'
                    }`;
                }
            });
        }

        // è‡ªå‹•ä¿å­˜æ©Ÿèƒ½
        let autoSaveInterval;
        function startAutoSave(intervalMinutes = 5) {
            stopAutoSave();
            autoSaveInterval = setInterval(() => {
                saveAllData();
            }, intervalMinutes * 60 * 1000);
            console.log(`ğŸ”„ è‡ªå‹•ä¿å­˜é–‹å§‹: ${intervalMinutes}åˆ†é–“éš”`);
        }

        function stopAutoSave() {
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
                autoSaveInterval = null;
            }
        }

        // æ‰‹å‹•ä¿å­˜
        function manualSave() {
            saveAllData();
        }

        // æœ€çµ‚ä¿å­˜æ™‚åˆ»è¡¨ç¤ºæ›´æ–°
        function updateLastSavedDisplay() {
            const element = document.getElementById('last-saved-time');
            if (element && userData.lastSaved) {
                const date = new Date(userData.lastSaved);
                element.textContent = date.toLocaleString('ja-JP');
            }
        }

        // è‡ªå‹•ä¿å­˜é–“éš”å¤‰æ›´
        function updateAutoSaveInterval() {
            const interval = parseInt(document.getElementById('auto-save-interval').value);
            if (interval > 0) {
                startAutoSave(interval);
            } else {
                stopAutoSave();
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function exportData() {
            updateUserData();
            const dataStr = JSON.stringify(userData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `yaneyuka_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            showSaveStatus('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Œäº†', 'success');
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    
                    if (confirm('ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¸Šæ›¸ãã—ã¾ã™ã‹ï¼Ÿï¼ˆå…ƒã«æˆ»ã›ã¾ã›ã‚“ï¼‰')) {
                        Object.assign(userData, imported);
                        loadAllData(); // ãƒ‡ãƒ¼ã‚¿ã‚’å„æ©Ÿèƒ½ã«åæ˜ 
                        
                        // ç”»é¢ã‚’æ›´æ–°
                        if (typeof renderCalendar === 'function') renderCalendar();
                        if (typeof renderTodoList === 'function') renderTodoList();
                        if (typeof renderHoukis === 'function') renderHoukis();
                        if (typeof renderMemoList === 'function') renderMemoList();
                        
                        showSaveStatus('ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†', 'success');
                    }
                } catch (error) {
                    alert('ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
                    showSaveStatus('ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¤±æ•—', 'error');
                }
            };
            reader.readAsText(file);
        }

        // ãƒšãƒ¼ã‚¸é›¢è„±å‰ã®è‡ªå‹•ä¿å­˜
        window.addEventListener('beforeunload', function() {
            updateUserData();
            saveAllData();
        });

        document.addEventListener('DOMContentLoaded', () => {
          loadSettings(); // è¨­å®šèª­ã¿è¾¼ã¿é–¢æ•°ã‚’å‘¼ã³å‡ºã™

          // è¨­å®šå¤‰æ›´æ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
        });

        function toggleAccordion(houkiName) {
          const accordion = document.getElementById(`accordion-${houkiName}`);
          if (accordion) {
            accordion.classList.toggle('hidden');
          }
        }

        function addArticle(houkiName) {
          const houki = houkis.find(h => h.name === houkiName);
          if (houki) {
            houki.articles.push({
              number: '',
              text: '',
              locked: false
            });
            renderHoukis();
            saveAllData(); // çµ±åˆä¿å­˜ã‚·ã‚¹ãƒ†ãƒ ã§ä¿å­˜
            console.log('ğŸ“š æ¡é …ã‚’è¿½åŠ ã—ã¦ä¿å­˜:', houkiName);
            // è¿½åŠ å¾Œã«ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã‚’é–‹ã„ãŸçŠ¶æ…‹ã«ã™ã‚‹
            setTimeout(() => {
            const accordion = document.getElementById(`accordion-${houkiName}`);
              if (accordion) {
            accordion.classList.remove('hidden');
              }
            }, 0);
          }
        }

        function updateHoukiName(oldName, newName) {
          const houki = houkis.find(h => h.name === oldName);
          if (houki) {
            houki.name = newName;
            renderHoukis();
            saveAllData(); // çµ±åˆä¿å­˜ã‚·ã‚¹ãƒ†ãƒ ã§ä¿å­˜
            console.log('ğŸ“š æ³•è¦åã‚’å¤‰æ›´ã—ã¦ä¿å­˜:', oldName, 'â†’', newName);
          }
        }

        function deleteHouki(houkiName) {
          const index = houkis.findIndex(h => h.name === houkiName);
          if (index !== -1) {
            houkis.splice(index, 1);
            renderHoukis();
            saveAllData(); // çµ±åˆä¿å­˜ã‚·ã‚¹ãƒ†ãƒ ã§ä¿å­˜
            console.log('ğŸ“š æ¡é …ã‚’è¿½åŠ ã—ã¦ä¿å­˜:', houkiName);
          }
        }

        function lockHouki(houkiName) {
          const houki = houkis.find(h => h.name === houkiName);
          if (houki) {
            houki.locked = !houki.locked;
            renderHoukis();
          }
        }

        function updateArticle(houkiName, articleIndex, field, value) {
          const houki = houkis.find(h => h.name === houkiName);
          if (houki && houki.articles[articleIndex]) {
            houki.articles[articleIndex][field] = value;
            saveAllData(); // çµ±åˆä¿å­˜ã‚·ã‚¹ãƒ†ãƒ ã§ä¿å­˜
            console.log('ğŸ“ æ³•è¦ã‚’æ›´æ–°ã—ã¦ä¿å­˜:', houkiName, field, value);
          }
        }

        function showTeamProjectForm() {
          const form = document.getElementById('teamProjectForm');
          form.classList.remove('hidden');
        }

        function toggleTeamProjectForm() {
          const form = document.getElementById('teamProjectForm');
          form.classList.toggle('hidden');
          if (!form.classList.contains('hidden')) {
            document.getElementById('newTeamProjectName').focus();
          }
        }

        function addTeamProject(event) {
          event.preventDefault();
          const projectName = document.getElementById('newTeamProjectName').value.trim();
          
          if (!projectName) {
            alert('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
            return;
          }
          
          if (teamProjects.includes(projectName)) {
            alert('ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™');
            return;
          }
          
          teamProjects.push(projectName);
          projectShares[projectName] = {
            owner: currentUser,
            sharedUsers: []
          };
          
          document.getElementById('newTeamProjectName').value = '';
          saveAllData(); // çµ±åˆä¿å­˜ã‚·ã‚¹ãƒ†ãƒ ã§ä¿å­˜
          console.log('ğŸ‘¥ ãƒãƒ¼ãƒ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ã—ã¦ä¿å­˜:', projectName);
          toggleTeamProjectForm();
          updateTeamProjectDropdown();
          renderTeamTodos();
        }

        function updateTeamProjectDropdown() {
          const dropdown = document.getElementById('teamTodoProject');
          const shareDropdown = document.getElementById('shareProjectSelect');
          const options = '<option value="">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠ</option>' + 
            teamProjects.map(project => `<option value="${project}">${project}</option>`).join('');
          
          dropdown.innerHTML = options;
          if (shareDropdown) {
            shareDropdown.innerHTML = options;
          }
        }

        function showShareProjectForm() {
          const form = document.getElementById('shareProjectForm');
          form.classList.remove('hidden');
          updateTeamProjectDropdown();
          renderSharedUsers();
        }

        function toggleShareProjectForm() {
          const form = document.getElementById('shareProjectForm');
          form.classList.toggle('hidden');
        }

        function addShareUser() {
          const projectName = document.getElementById('shareProjectSelect').value;
          const userName = document.getElementById('shareUserInput').value.trim();
          
          if (!projectName || !userName) {
            alert('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
            return;
          }
          
          if (!projectShares[projectName]) {
            projectShares[projectName] = {
              owner: currentUser,
              sharedUsers: []
            };
          }
          
          if (projectShares[projectName].sharedUsers.includes(userName)) {
            alert('ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æ—¢ã«è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™');
            return;
          }
          
          projectShares[projectName].sharedUsers.push(userName);
          document.getElementById('shareUserInput').value = '';
          saveAllData(); // çµ±åˆä¿å­˜ã‚·ã‚¹ãƒ†ãƒ ã§ä¿å­˜
          console.log('ğŸ‘¤ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…±æœ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿½åŠ ã—ã¦ä¿å­˜:', userName, 'to', projectName);
          renderSharedUsers();
        }

        function removeShareUser(projectName, userName) {
          if (projectShares[projectName]) {
            projectShares[projectName].sharedUsers = projectShares[projectName].sharedUsers.filter(u => u !== userName);
            saveAllData(); // çµ±åˆä¿å­˜ã‚·ã‚¹ãƒ†ãƒ ã§ä¿å­˜
            console.log('ğŸ—‘ï¸ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…±æœ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤ã—ã¦ä¿å­˜:', userName, 'from', projectName);
            renderSharedUsers();
          }
        }

        function renderSharedUsers() {
          const projectName = document.getElementById('shareProjectSelect').value;
          const container = document.getElementById('sharedUsersList');
          container.innerHTML = '';
          
          if (projectName && projectShares[projectName]) {
            projectShares[projectName].sharedUsers.forEach(user => {
              const div = document.createElement('div');
              div.className = 'flex items-center justify-between bg-gray-50 p-2 rounded';
              div.innerHTML = `
                <span class="text-xs">${user}</span>
                <button type="button" onclick="removeShareUser('${projectName}', '${user}')" 
                  class="text-xs text-red-500 hover:text-red-700">å‰Šé™¤</button>
              `;
              container.appendChild(div);
            });
          }
        }

        function saveShareSettings() {
          // ã“ã“ã§å…±æœ‰è¨­å®šã‚’ä¿å­˜ã—ã¾ã™ï¼ˆå®Ÿéš›ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ï¼‰
          alert('å…±æœ‰è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ');
          toggleShareProjectForm();
        }

        function toggleTeamTodoForm() {
          const form = document.getElementById('teamTodoForm');
          form.classList.toggle('hidden');
          if (!form.classList.contains('hidden')) {
            document.getElementById('teamTodoProject').focus();
          } else {
            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('teamTodoProject').value = '';
            document.getElementById('teamDueDate').value = '';
            document.getElementById('teamTodoPriority').value = '';
            document.getElementById('teamTodoText').value = '';
          }
        }

        function addTeamTodo(event) {
          event.preventDefault();
          
          const project = document.getElementById("teamTodoProject").value.trim();
          const dueDate = document.getElementById("teamDueDate").value;
          const priority = document.getElementById("teamTodoPriority").value;
          const todoText = document.getElementById("teamTodoText").value.trim();
          
          if (!project || !dueDate || !priority || !todoText) {
            alert("å…¨ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
            return;
          }
          
          teamTodos.push({
            project: project,
            text: todoText,
            dueDate: dueDate,
            priority: priority,
            completed: false,
            createdAt: new Date(),
            createdBy: currentUser
          });
          
          // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦éè¡¨ç¤ºã«
          document.getElementById("teamTodoProject").value = "";
          document.getElementById("teamDueDate").value = "";
          document.getElementById("teamTodoPriority").value = "";
          document.getElementById("teamTodoText").value = "";
          toggleTeamTodoForm();
          
          renderTeamTodos();
        }

        function toggleTeamTodo(index) {
          teamTodos[index].completed = !teamTodos[index].completed;
          if (teamTodos[index].completed) {
            // å®Œäº†ã—ãŸã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤
            setTimeout(() => {
              teamTodos.splice(index, 1);
              renderTeamTodos();
            }, 500);
          } else {
            renderTeamTodos();
          }
        }

        function renderTeamTodos() {
          const container = document.getElementById("teamProjectTodoLists");
          container.innerHTML = "";
          
          // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¯ã«ã‚¿ã‚¹ã‚¯ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
          const groupedTodos = {};
          teamTodos.filter(todo => !todo.completed).forEach(todo => {
            if (!groupedTodos[todo.project]) {
              groupedTodos[todo.project] = [];
            }
            groupedTodos[todo.project].push(todo);
          });
          
          // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¯ã«ã‚¿ã‚¹ã‚¯ã‚’è¡¨ç¤º
          Object.keys(groupedTodos).forEach(projectName => {
            // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’ãƒã‚§ãƒƒã‚¯
            if (!hasProjectAccess(projectName)) return;

            const projectDiv = document.createElement('div');
            projectDiv.className = 'bg-white p-2 rounded shadow-sm text-xs';
            
            // æœŸé™ã§ã‚½ãƒ¼ãƒˆ
            const sortedTodos = groupedTodos[projectName].sort((a, b) => {
              return new Date(a.dueDate) - new Date(b.dueDate);
            });
            
            projectDiv.innerHTML = `
              <div class="flex items-center justify-between mb-1.5 pb-1.5 border-b">
                <h3 class="font-semibold">${projectName}</h3>
                <span class="text-gray-500">${sortedTodos.length}ä»¶</span>
              </div>
              <div class="space-y-1">
                ${sortedTodos.map((todo, index) => {
                  const isOverdue = new Date(todo.dueDate) < new Date();
                  const priorityColors = {
                    high: 'bg-red-100 text-red-800',
                    medium: 'bg-yellow-100 text-yellow-800',
                    low: 'bg-green-100 text-green-800'
                  };
                  
                  return `
                    <div class="flex items-center gap-1.5 py-0.5 ${isOverdue ? 'text-red-600' : ''}">
                      <input type="checkbox" 
                        onclick="toggleTeamTodo(${teamTodos.indexOf(todo)})" 
                        class="w-3 h-3 rounded border-gray-300 text-blue-600 focus:ring-blue-500" />
                      <div class="w-[70px] flex-shrink-0 text-[10px]">
                        ${todo.dueDate}
                      </div>
                      <div class="flex-grow truncate text-[11px]">
                        ${todo.text}
                        <span class="text-[10px] text-gray-500 ml-1">(${todo.createdBy})</span>
                      </div>
                      <span class="flex-shrink-0 text-[10px] ${priorityColors[todo.priority]} px-1 rounded-sm">
                        ${todo.priority === 'high' ? 'é«˜' : todo.priority === 'medium' ? 'ä¸­' : 'ä½'}
                      </span>
                      ${canEditProject(projectName) ? `
                        <button onclick="deleteTeamTodo(${teamTodos.indexOf(todo)})" 
                          class="flex-shrink-0 text-red-500 hover:text-red-700">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m-6 0V5a1 1 0 00-1-1h-4a1 1 0 00-1 1v2" />
                          </svg>
                        </button>
                      ` : ''}
                    </div>
                  `;
                }).join('')}
              </div>
            `;
            
            container.appendChild(projectDiv);
          });
        }

        function hasProjectAccess(projectName) {
          // currentUser ãƒã‚§ãƒƒã‚¯ã‚’å‰Šé™¤ã—ã€å¸¸ã« true ã‚’è¿”ã™ã‹ã€åˆ¥ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…
          return true; // currentUser ãŒãªã„ã®ã§ã€ä¸€æ—¦ã™ã¹ã¦ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã¨ã™ã‚‹
          // if (!projectShares[projectName]) return false;
          // return projectShares[projectName].owner === currentUser || 
          //        projectShares[projectName].sharedUsers.includes(currentUser);
        }

        function canEditProject(projectName) {
          // currentUser ãƒã‚§ãƒƒã‚¯ã‚’å‰Šé™¤ã—ã€å¸¸ã« true ã‚’è¿”ã™ã‹ã€åˆ¥ã®ç·¨é›†æ¨©é™åˆ¶å¾¡ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…
          return true; // currentUser ãŒãªã„ã®ã§ã€ä¸€æ—¦ã™ã¹ã¦ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç·¨é›†å¯èƒ½ã¨ã™ã‚‹
          // return projectShares[projectName] && projectShares[projectName].owner === currentUser;
        }

        function deleteTeamTodo(index) {
          const todo = teamTodos[index];
          if (!canEditProject(todo.project)) {
            return;
          }

          // ã‚¹ãƒãƒ¼ãƒˆç¢ºèªUIã‚’ä½œæˆ
          const confirmDiv = document.createElement('div');
          confirmDiv.id = 'delete-team-todo-confirm';
          confirmDiv.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
          confirmDiv.innerHTML = `
            <div class="bg-white rounded-lg p-6 max-w-md mx-4 shadow-xl">
              <div class="text-center">
                <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4">
                  <svg class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                  </svg>
                </div>
                <h3 class="text-lg font-medium text-gray-900 mb-2">ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ</h3>
                <div class="bg-gray-50 p-3 rounded mb-4">
                  <p class="text-sm text-gray-700">${todo.text}</p>
                  <p class="text-xs text-blue-600 mt-1">ãƒãƒ¼ãƒ : ${todo.teamName}</p>
                </div>
                <div class="flex justify-center gap-3">
                  <button onclick="confirmDeleteTeamTodo(${index})" 
                    class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors">
                    å‰Šé™¤ã™ã‚‹
                  </button>
                  <button onclick="cancelDeleteTeamTodo()" 
                    class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 transition-colors">
                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                  </button>
                </div>
              </div>
            </div>
          `;
          
          document.body.appendChild(confirmDiv);
        }

        function confirmDeleteTeamTodo(index) {
          teamTodos.splice(index, 1);
          renderTeamTodos();
          saveAllData();
          cancelDeleteTeamTodo();
        }

        function cancelDeleteTeamTodo() {
          const confirmDiv = document.getElementById('delete-team-todo-confirm');
          if (confirmDiv) {
            confirmDiv.remove();
          }
        }

        // ãƒ„ãƒ¼ãƒ«é–¢é€£ã®é–¢æ•°
        function hideAllTools() {
          const tools = [
            'resize-tool-content',
            'glass-thickness-tool-content',
            'rainwater-tool-content',
            'function-calculator-content',
            'memo-tool-content'
          ];
          
          tools.forEach(toolId => {
            const element = document.getElementById(toolId);
            if (element) {
              element.style.display = 'none';
            }
          });
        }

        // ä¿®æ­£å¾Œã® toggle é–¢æ•°ã¯ã€ã¾ãšã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…ã®ä»–ã®ãƒ„ãƒ¼ãƒ«ã‚’éš ã—ã¦ã‹ã‚‰å¯¾è±¡ã‚’è¡¨ç¤º/éè¡¨ç¤ºã—ã¾ã™
        function hideToolContentsInSection(sectionId) {
          const section = document.getElementById(sectionId);
          if (!section) return;
          const toolContents = section.querySelectorAll('.tool-content');
          toolContents.forEach(content => content.style.display = 'none');
        }

        function toggleResizeTool() {
          const sectionId = 'general-tools-area';
          const toolId = 'resize-tool-content';
          const tool = document.getElementById(toolId);
          if (!tool) return;
          const isCurrentlyVisible = tool.style.display === 'block';
          hideToolContentsInSection(sectionId);
          if (!isCurrentlyVisible) {
            tool.style.display = 'block';
            setupDragAndDrop(); // è¡¨ç¤ºã•ã‚ŒãŸã¨ãã ã‘å®Ÿè¡Œ
          }
        }

        function toggleGlassThicknessTool() {
          const sectionId = 'design-tools-area';
          const toolId = 'glass-thickness-tool-content';
          const tool = document.getElementById(toolId);
          if (!tool) return;
          const isCurrentlyVisible = tool.style.display === 'block';
          hideToolContentsInSection(sectionId);
          if (!isCurrentlyVisible) {
            tool.style.display = 'block';
          }
        }

        function toggleRainwaterTool() {
          const sectionId = 'design-tools-area';
          const toolId = 'rainwater-tool-content';
          const tool = document.getElementById(toolId);
          if (!tool) return;
          const isCurrentlyVisible = tool.style.display === 'block';
          hideToolContentsInSection(sectionId);
          if (!isCurrentlyVisible) {
            tool.style.display = 'block';
          }
        }

        function toggleFunctionCalculator() {
          const sectionId = 'general-tools-area';
          const toolId = 'function-calculator-content';
          const tool = document.getElementById(toolId);
          if (!tool) return;
          const isCurrentlyVisible = tool.style.display === 'block';
          hideToolContentsInSection(sectionId);
          if (!isCurrentlyVisible) {
            tool.style.display = 'block';
          }
        }

        function toggleMemoTool() {
          const sectionId = 'general-tools-area';
          const toolId = 'memo-tool-content';
          const tool = document.getElementById(toolId);
          if (!tool) return;
          const isCurrentlyVisible = tool.style.display === 'block';
          hideToolContentsInSection(sectionId);
          if (!isCurrentlyVisible) {
            tool.style.display = 'block';
            initializeMemoApp(); // æ­£ã—ã„åˆæœŸåŒ–é–¢æ•°ã‚’å‘¼ã³å‡ºã™
          }
        }

        function setupDragAndDrop() {
          const dropArea = document.getElementById('drop-area');
          const uploadInput = document.getElementById('upload');
          const fileNameDisplay = document.getElementById('file-name');
          const convertButton = document.getElementById('convert-button');

          dropArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropArea.style.borderColor = '#000';
          });

          dropArea.addEventListener('dragleave', () => {
            dropArea.style.borderColor = '#ccc';
          });

          dropArea.addEventListener('drop', (e) => {
            e.preventDefault();
            dropArea.style.borderColor = '#ccc';
            const files = e.dataTransfer.files;
            if (files.length > 0) {
              uploadInput.files = files;
              fileNameDisplay.innerHTML = `<div class="mt-3 p-2 bg-gray-100 rounded text-left">
                <p class="text-[11px] text-gray-600 font-medium mb-1">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«:</p>
                <div class="text-[12px] text-gray-700">${Array.from(files).map(f => f.name).join('<br>')}</div>
              </div>`;
              convertButton.style.display = 'inline-block';
            }
          });

          uploadInput.addEventListener('change', () => {
            if (uploadInput.files.length > 0) {
              fileNameDisplay.innerHTML = `<div class="mt-3 p-2 bg-gray-100 rounded text-left">
                <p class="text-[11px] text-gray-600 font-medium mb-1">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«:</p>
                <div class="text-[12px] text-gray-700">${Array.from(uploadInput.files).map(f => f.name).join('<br>')}</div>
              </div>`;
              convertButton.style.display = 'inline-block';
            }
          });
        }

        function resizeImages() {
          const files = document.getElementById('upload').files;
          const size = parseInt(document.getElementById('size').value);
          const canvas = document.getElementById('canvas');
          const ctx = canvas.getContext('2d');

          if (files.length === 0) return alert('ç”»åƒã‚’é¸ã‚“ã§ãã ã•ã„');

          Array.from(files).forEach((file, index) => {
            const img = new Image();
            const reader = new FileReader();
            reader.onload = function(e) {
              img.onload = function() {
                const aspectRatio = img.width / img.height;
                let newWidth, newHeight;

                if (img.width > img.height) {
                  newWidth = size;
                  newHeight = size / aspectRatio;
                } else {
                  newHeight = size;
                  newWidth = size * aspectRatio;
                }

                canvas.width = newWidth;
                canvas.height = newHeight;
                ctx.drawImage(img, 0, 0, newWidth, newHeight);

                const link = document.createElement('a');
                link.download = `resized_${file.name}`;
                link.href = canvas.toDataURL('image/jpeg');
                link.click();
              };
              img.src = e.target.result;
            };
            reader.readAsDataURL(file);
          });
        }

        // --- END è‰²å½©ãƒã‚§ãƒƒã‚«ãƒ¼é–¢é€£ ---

        // --- ã‚¬ãƒ©ã‚¹åšè¨ˆç®—é–¢é€£ã®é–¢æ•° ---
        function calculateGlassThickness() {
          const shortSide = parseFloat(document.getElementById('glass-short-side').value);
          const longSide = parseFloat(document.getElementById('glass-long-side').value);
            const windPressureNm2 = parseFloat(document.getElementById('wind-pressure').value); // N/m^2
          const glassType = document.getElementById('glass-type').value;

            if (isNaN(shortSide) || shortSide <= 0 || isNaN(longSide) || longSide <= 0 || isNaN(windPressureNm2) || windPressureNm2 < 0) {
                alert('æœ‰åŠ¹ãªå¯¸æ³•ã¨é¢¨åœ§åŠ›ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
            return;
          }

            // å˜ä½ã‚’Nã¨mmã«çµ±ä¸€
            const windPressureNmm2 = windPressureNm2 / 1000000; // N/mm^2

          // ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã®è¨ˆç®—
          const aspectRatio = longSide / shortSide;
          
          // ä¿‚æ•°Î²ã®æ±ºå®šï¼ˆJIS R 3109ã«ã‚ˆã‚‹ï¼‰
            let beta = 0.75; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ (ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”1)
          if (aspectRatio >= 2) {
            beta = 0.5;
          } else if (aspectRatio > 1) {
                beta = 0.75 - 0.25 * (aspectRatio - 1); // ç·šå½¢è£œé–“
          }

            // è¨±å®¹å¿œåŠ›åº¦ã®è¨­å®š (N/mm^2)
          let allowableStress;
          switch (glassType) {
                case 'float':       allowableStress = 12.0; break;
                case 'tempered':    allowableStress = 35.0; break;
                case 'laminated':   allowableStress = 12.0; break;
                default:            allowableStress = 12.0; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
            }

            // ã‚¬ãƒ©ã‚¹åšã•ã®è¨ˆç®—ï¼ˆå˜ä½ã‚’N, mmã§çµ±ä¸€ï¼‰
            // t [mm] = sqrt( (beta * P_Nmm2 * a_mm^2) / sigma_Nmm2 )
            const calculatedThickness = Math.sqrt(
                (beta * windPressureNmm2 * Math.pow(shortSide, 2)) / allowableStress
            );

          // æ¨å¥¨åšã•ã®æ±ºå®šï¼ˆè¦æ ¼åšã•ã«åˆ‡ã‚Šä¸Šã’ï¼‰
          const standardThicknesses = [3, 4, 5, 6, 8, 10, 12, 15, 19];
            let recommendedThickness = standardThicknesses[standardThicknesses.length - 1]; // Initialize with max
            for (let t of standardThicknesses) {
                if (t >= calculatedThickness) {
                    recommendedThickness = t;
              break;
            }
          }

            // çµæœã®è¡¨ç¤ºã‚’æ›´æ–°
            const resultDiv = document.getElementById('glass-result');
          const resultContent = document.getElementById('glass-result-content');
            resultDiv.classList.remove('hidden');
            
          resultContent.innerHTML = `
              <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                  <div class="bg-gray-50 p-4 rounded-lg">
                    <p class="text-sm text-gray-600">è¨ˆç®—åšã•</p>
                    <p class="text-2xl font-bold text-gray-800">${calculatedThickness.toFixed(1)} <span class="text-sm">mm</span></p>
            </div>
                  <div class="bg-blue-50 p-4 rounded-lg">
                    <p class="text-sm text-gray-600">æ¨å¥¨åšã•</p>
                    <p class="text-2xl font-bold text-blue-800">${recommendedThickness} <span class="text-sm">mm</span></p>
                  </div>
                </div>
                <div class="mt-4 bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
                  <p class="text-sm text-yellow-800">
                    â€»ã“ã®è¨ˆç®—çµæœã¯å‚è€ƒå€¤ã§ã™ã€‚å®Ÿéš›ã®è¨­è¨ˆã«ã¯ã€å»ºç¯‰åŸºæº–æ³•ã‚„é–¢é€£æ³•è¦ã€ãã®ä»–ã®è¦ä»¶ã‚’è€ƒæ…®ã—ã¦ãã ã•ã„ã€‚
                  </p>
                </div>
            </div>
          `;
        }

        function calculateWindPressure() {
            // Note: Wind pressure calculation elements might not exist in userpage.html
            const regionTypeInput = document.getElementById('region-type');
            const buildingHeightInput = document.getElementById('building-height');
            const basicWindSpeedInput = document.getElementById('basic-wind-speed');
            const windPressureOutput = document.getElementById('wind-pressure'); // Target for output

            if (!regionTypeInput || !buildingHeightInput || !basicWindSpeedInput || !windPressureOutput) {
                console.warn("Wind pressure calculation elements not found. Cannot calculate.");
                return; // è¦ç´ ãŒãªã‘ã‚Œã°è¨ˆç®—ã—ãªã„
            }

            const regionType = parseFloat(regionTypeInput.value);
            const buildingHeight = parseFloat(buildingHeightInput.value);
            const basicWindSpeed = parseFloat(basicWindSpeedInput.value);

            if (isNaN(regionType) || isNaN(buildingHeight) || buildingHeight < 0 || isNaN(basicWindSpeed) || basicWindSpeed < 0) {
                alert('æœ‰åŠ¹ãªåœ°åŸŸåŒºåˆ†ã€å»ºç‰©é«˜ã•ã€åŸºæº–é¢¨é€Ÿã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            // åœ°åŸŸåŒºåˆ†ã«ã‚ˆã‚‹ç²—åº¦ä¿‚æ•°ã‚’è¨­å®š (å»ºç¯‰åŸºæº–æ³•æ–½è¡Œä»¤ ç¬¬87æ¡)
            // (ç°¡æ˜“çš„ãªåŒºåˆ†ã€‚å®Ÿéš›ã¯ã‚‚ã£ã¨è¤‡é›‘)
            let Er;
            switch(parseInt(regionType)) { // Ensure integer comparison
                case 1: Er = 1.0; break; // â… åœ°åŸŸ (æµ·å²¸éƒ¨)
                case 2: Er = 0.8; break; // â…¡åœ°åŸŸ (å¹³åœ°éƒ¨)
                case 3: Er = 0.6; break; // â…¢åœ°åŸŸ (ä¸˜é™µéƒ¨)
                case 4: Er = 0.4; break; // â…£åœ°åŸŸ (å±±å²³éƒ¨) - ç°¡æ˜“çš„ã«è¨­å®š
                default: Er = 0.8; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯â…¡åœ°åŸŸ
            }

            // ã‚¬ã‚¹ãƒˆå½±éŸ¿ä¿‚æ•° Gf (ä¸€èˆ¬çš„ãªå€¤ã¨ã—ã¦1.5ã‚’ä½¿ç”¨ - å‘Šç¤º1454å·ãªã©å‚ç…§)
            // å®Ÿéš›ã¯é«˜ã•ã‚„åœ°åŸŸåŒºåˆ†ã§å¤‰å‹•ã™ã‚‹ãŒç°¡æ˜“çš„ã«å›ºå®šå€¤ã¨ã™ã‚‹
            const Gf = 1.5; 

            // è¨­è¨ˆç”¨é€Ÿåº¦åœ§ã®è¨ˆç®— q (N/mÂ²) = 0.6 * Er^2 * V0^2 * Gf
            // â€» å³å¯†ã«ã¯é«˜ã•æ–¹å‘åˆ†å¸ƒä¿‚æ•° Ep ã‚‚è€ƒæ…®ã™ã‚‹ãŒã“ã“ã§ã¯çœç•¥
            const pressure = 0.6 * Math.pow(Er, 2) * Math.pow(basicWindSpeed, 2) * Gf;

            // è¨ˆç®—çµæœã‚’è¨­è¨ˆé¢¨åœ§åŠ›ã®å…¥åŠ›æ¬„ã«è¨­å®š (N/m^2)
            windPressureOutput.value = Math.round(pressure);
            
            // è¨ˆç®—ãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹
            toggleWindPressureCalc();
        }
        // --- END ã‚¬ãƒ©ã‚¹åšè¨ˆç®—é–¢é€£ ---

        // --- é›¨æ°´è¨ˆç®—é–¢é€£ã®é–¢æ•° ---
        function calculateEavesTrough() {
            const roofArea = parseFloat(document.getElementById('eaves-roof-area').value);
            const rainfallIntensity = parseFloat(document.getElementById('rainfall-intensity').value);

            if (isNaN(roofArea) || roofArea <= 0 || isNaN(rainfallIntensity) || rainfallIntensity <= 0) {
                alert('æœ‰åŠ¹ãªå±‹æ ¹é¢ç©ã¨é™é›¨å¼·åº¦ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            // å¿…è¦æ’æ°´é‡ Q (L/min) = å±‹æ ¹é¢ç© (m^2) * é™é›¨å¼·åº¦ (mm/h) / 60 
            // é™é›¨å¼·åº¦ mm/h ã‚’ L/(min*m^2) ã«æ›ç®— (1 mm/h = 1 L/h/m^2 = 1/60 L/min/m^2)
            const requiredFlowRate = roofArea * rainfallIntensity / 60;

            showRainwaterResult({ eavesFlowRate: requiredFlowRate });
        }

        function calculateDownpipe() {
            const roofArea = parseFloat(document.getElementById('downpipe-roof-area').value);
            const wallArea = parseFloat(document.getElementById('downpipe-wall-area').value) || 0;

            if (isNaN(roofArea) || roofArea < 0 || isNaN(wallArea) || wallArea < 0) {
                alert('æœ‰åŠ¹ãªå—ã‘æŒã¡é¢ç©ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            // é›†æ°´é¢ç© A (m^2) = å—ã‘æŒã¡å±‹æ ¹é¢ç© + (å—ã‘æŒã¡å£é¢ç© * 0.5)
            const catchmentArea = roofArea + (wallArea * 0.5);

            // å¿…è¦æ–­é¢ç© (cm^2) = é›†æ°´é¢ç© (m^2) * 1 (cm^2/m^2)
            const requiredCrossSectionArea = catchmentArea; // 1 m^2 ã‚ãŸã‚Š 1 cm^2 ã®ç°¡æ˜“è¨ˆç®—

            showRainwaterResult({
                verticalArea: requiredCrossSectionArea,
                verticalCatchment: catchmentArea,
                verticalRoof: roofArea,
                verticalWall: wallArea
            });
        }

        function showRainwaterResult(results) {
            const resultDiv = document.getElementById('rainwater-result');
            const resultContent = document.getElementById('rainwater-result-content');
            if (!resultDiv || !resultContent) return;

            resultDiv.classList.remove('hidden');
            let html = '<div class="space-y-4">';

            if (results.eavesFlowRate !== undefined) {
                html += `
                  <div class="bg-blue-50 p-4 rounded-lg">
                    <p class="text-sm text-gray-600">è»’æ¨‹è¨ˆç®—çµæœ</p>
                    <p class="text-lg font-semibold text-blue-800">å¿…è¦æ’æ°´é‡: ${results.eavesFlowRate.toFixed(1)} L/min</p>
                    <p class="text-xs text-gray-500 mt-1">æ¨å¥¨è»’æ¨‹ã‚µã‚¤ã‚º: ${recommendGutterSize(results.eavesFlowRate)}</p>
                  </div>
                `;
            }

            if (results.verticalArea !== undefined) {
                html += `
                  <div class="bg-green-50 p-4 rounded-lg">
                    <p class="text-sm text-gray-600">ç«ªæ¨‹è¨ˆç®—çµæœ (ç°¡æ˜“è¨ˆç®—)</p>
                    <p class="text-lg font-semibold text-green-800">å¿…è¦æ–­é¢ç©ç›®å®‰: ${results.verticalArea.toFixed(1)} cmÂ²</p>
                    <p class="text-xs text-gray-500 mt-1">æ¨å¥¨ç«ªæ¨‹ã‚µã‚¤ã‚º: ${recommendDownpipeSize(results.verticalArea)}</p>
                    <div class="text-xs text-gray-500 mt-2">
                      <p>è¨ˆç®—æ ¹æ‹ :</p>
                      <p>ãƒ»é›†æ°´é¢ç©: ${results.verticalCatchment.toFixed(1)}ã¡</p>
                      <p>  (å±‹æ ¹ ${results.verticalRoof.toFixed(1)}ã¡ + å£ ${results.verticalWall.toFixed(1)}ã¡ Ã— 0.5)</p>
                      <p>â€»1mÂ²ã‚ãŸã‚Š1cmÂ²ã¨ã—ã¦è¨ˆç®—</p>
                  </div>
                </div>
              `;
            }

            html += `
              <div class="mt-4 bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
                <p class="text-sm text-yellow-800">
                  â€»ã“ã®è¨ˆç®—çµæœã¯å‚è€ƒå€¤ã§ã™ã€‚å®Ÿéš›ã®è¨­è¨ˆã«ã¯ã€ãƒ¡ãƒ¼ã‚«ãƒ¼ã®ä»•æ§˜ã‚„åœ°åŸŸã®æ¡ä¾‹ã€è¨­ç½®æ¡ä»¶ç­‰ã‚’è€ƒæ…®ã—ã¦ãã ã•ã„ã€‚
                </p>
              </div>
            </div>`;

            resultContent.innerHTML = html;
        }

        // è»’æ¨‹ã®æ¨å¥¨ã‚µã‚¤ã‚ºã‚’è¿”ã™é–¢æ•° (æ’æ°´é‡ L/min ã«åŸºã¥ãä¾‹)
        function recommendGutterSize(flowRate) {
            // ã“ã‚Œã¯ä¸€èˆ¬çš„ãªç›®å®‰ã§ã™ã€‚ãƒ¡ãƒ¼ã‚«ãƒ¼ã®è£½å“ä»•æ§˜ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
            if (flowRate <= 30) return 'å‘¼ã³å¾„ 100 (ä¾‹: åŠä¸¸105, è§’100)';
            if (flowRate <= 50) return 'å‘¼ã³å¾„ 120 (ä¾‹: åŠä¸¸120, è§’120)';
            if (flowRate <= 80) return 'å‘¼ã³å¾„ 150 (ä¾‹: åŠä¸¸150, è§’140)';
            if (flowRate <= 120) return 'å‘¼ã³å¾„ 180 (ä¾‹: åŠä¸¸180)';
            return 'å‘¼ã³å¾„ 180ä»¥ä¸Š (è¦è©³ç´°æ¤œè¨)';
        }

        // ç«ªæ¨‹ã®æ¨å¥¨ã‚µã‚¤ã‚ºã‚’è¿”ã™é–¢æ•° (å¿…è¦æ–­é¢ç© cmÂ² ã«åŸºã¥ãä¾‹)
        function recommendDownpipeSize(area) {
            // ã“ã‚Œã¯ä¸€èˆ¬çš„ãªç›®å®‰ã§ã™ã€‚ãƒ¡ãƒ¼ã‚«ãƒ¼ã®è£½å“ä»•æ§˜ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
            if (area <= 28) return 'å‘¼ã³å¾„ 60 (Ï†60)';   // æ–­é¢ç© ç´„28cm2
            if (area <= 44) return 'å‘¼ã³å¾„ 75 (Ï†75)';   // æ–­é¢ç© ç´„44cm2
            if (area <= 78) return 'å‘¼ã³å¾„ 100 (Ï†100)'; // æ–­é¢ç© ç´„78cm2
            if (area <= 113) return 'å‘¼ã³å¾„ 120 (Ï†120)'; // æ–­é¢ç© ç´„113cm2
            if (area <= 177) return 'å‘¼ã³å¾„ 150 (Ï†150)'; // æ–­é¢ç© ç´„177cm2
            return 'å‘¼ã³å¾„ 150ä»¥ä¸Š (è¦è©³ç´°æ¤œè¨)';
        }
        // --- END é›¨æ°´è¨ˆç®—é–¢é€£ ---

        // --- ã“ã“ã‹ã‚‰ä»–ã®JSé–¢æ•° (è¨­å®šã€èªè¨¼ãªã©) ---

        // è¨­å®šã®ä¿å­˜
        function saveSettings() {
        }

        // è¨­å®šã®èª­ã¿è¾¼ã¿
        function loadSettings() {
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è¨­å®šã‚’å¾©å…ƒ & ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
        document.addEventListener('DOMContentLoaded', () => {
          loadSettings();

          // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—
          const params = new URLSearchParams(window.location.search);
          const sectionParam = params.get('section');

          // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«åŸºã¥ã„ã¦è¡¨ç¤ºã™ã‚‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ±ºå®š
          if (sectionParam) {
              switch (sectionParam) {
                  case 'myhouki':
                      showMyHouki();
                      break;
                  case 'todo':
                      showTodo();
                      break;
                  case 'teamtodo':
                      showTeamTodo();
                      break;
                  case 'generaltools':
                      showGeneralTools();
                      break;
                  case 'designtools':
                      showDesignTools();
                      break;
                  case 'contact':
                      switchSection('contact-area');
                      break;
                  case 'settings':
                      showSettings();
                      break;
                  default:
                      // ä¸æ˜ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¡¨ç¤º
                      showMyCalendar();
              }
          } else {
              // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¡¨ç¤º
              showMyCalendar();
          }
        });

        // ãƒ„ãƒ¼ãƒ«ã‚«ãƒ†ã‚´ãƒªè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆé–¢æ•°
        function filterToolButtons(category) {
          const toolButtonsContainer = document.querySelector('#tools-area .tool-buttons');
          if (!toolButtonsContainer) return;

          const allButtons = toolButtonsContainer.querySelectorAll('.tool-button');
          allButtons.forEach(button => {
            if (button.dataset.toolCategory === category) {
              button.style.display = 'inline-block'; // ã¾ãŸã¯ block
            } else {
              button.style.display = 'none';
            }
          });
        }

        // ä¸€èˆ¬ãƒ„ãƒ¼ãƒ«è¡¨ç¤ºé–¢æ•°
        function showGeneralTools() {
          switchSection('general-tools-area');
          // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒ¡ãƒ¢æ©Ÿèƒ½ã‚’è¡¨ç¤º
          setTimeout(() => {
            toggleToolDisplay('general-tools-area', 'memo-tool-content');
          }, 100);
        }

        // è¨­è¨ˆãƒ„ãƒ¼ãƒ«è¡¨ç¤ºé–¢æ•°
        function showDesignTools() {
          switchSection('design-tools-area');
          // å¿…è¦ã«å¿œã˜ã¦ã€æœ€åˆã«è¡¨ç¤ºã™ã‚‹ãƒ„ãƒ¼ãƒ«ã‚’ã“ã“ã§æŒ‡å®šã§ãã¾ã™
          // ä¾‹: toggleGlassThicknessTool();
        }

        // ãƒ„ãƒ¼ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆé–¢æ•° (toggle***)
        // å„ãƒ„ãƒ¼ãƒ«ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤ºæ™‚ã«ã€ãã®ä¸­ã®ãƒ„ãƒ¼ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ä¸€æ—¦éè¡¨ç¤ºã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã«ä½¿ç”¨ã—ã¾ã™
        // ï¼ˆç¾çŠ¶ã€å„ toggle*** é–¢æ•°å†…ã§å€‹åˆ¥ã« display ã‚’æ“ä½œã—ã¦ã„ã‚‹ãŸã‚ã€ã“ã®é–¢æ•°ã¯å¿…é ˆã§ã¯ãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼‰
        // function hideToolContents(sectionId) {
        //   const section = document.getElementById(sectionId);
        //   if (!section) return;
        //   const toolContents = section.querySelectorAll('.tool-content');
        //   toolContents.forEach(content => content.style.display = 'none');
        // }

        function toggleResizeTool() {
          // åŒã˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…ã®ä»–ã®ãƒ„ãƒ¼ãƒ«ã‚’éš ã™ (å¿…è¦ã§ã‚ã‚Œã°)
          // hideToolContents('general-tools-area'); 
          const tool = document.getElementById('resize-tool-content');
          if (tool) {
            tool.style.display = tool.style.display === 'none' ? 'block' : 'none';
            if (tool.style.display === 'block') {
              setupDragAndDrop(); // è¡¨ç¤ºã•ã‚ŒãŸã¨ãã ã‘å®Ÿè¡Œ
            }
          }
        }

        function toggleGlassThicknessTool() {
          // hideToolContents('design-tools-area');
          const tool = document.getElementById('glass-thickness-tool-content');
          if (tool) {
            tool.style.display = tool.style.display === 'none' ? 'block' : 'none';
          }
        }

        function toggleRainwaterTool() {
          // hideToolContents('design-tools-area');
          const tool = document.getElementById('rainwater-tool-content');
          if (tool) {
            tool.style.display = tool.style.display === 'none' ? 'block' : 'none';
          }
        }

        function toggleFunctionCalculator() {
          // hideToolContents('general-tools-area');
          const tool = document.getElementById('function-calculator-content');
          if (tool) {
            tool.style.display = tool.style.display === 'none' ? 'block' : 'none';
          }
        }

        function toggleMemoTool() {
          // hideToolContents('general-tools-area');
          const tool = document.getElementById('memo-tool-content');
          if (tool) {
            tool.style.display = tool.style.display === 'none' ? 'block' : 'none';
            if (tool.style.display === 'block') { // ãƒ¡ãƒ¢ãƒ„ãƒ¼ãƒ«ãŒè¡¨ç¤ºã•ã‚ŒãŸã¨ãã®ã¿åˆæœŸåŒ–
              initializeMemoApp(); // æ­£ã—ã„åˆæœŸåŒ–é–¢æ•°ã‚’å‘¼ã³å‡ºã™
            }
          }
        }

        // --- ãƒ„ãƒ¼ãƒ«è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆãƒ­ã‚¸ãƒƒã‚¯ --- 
        function hideToolContentsInSection(sectionId) {
          const section = document.getElementById(sectionId);
          if (!section) {
            console.error("Section not found for hiding tools:", sectionId);
            return;
          }
          const toolContents = section.querySelectorAll('.tool-content');
          toolContents.forEach(content => {
            content.style.display = 'none'; 
          });
        }

        function toggleToolDisplay(sectionId, toolId) {
          const tool = document.getElementById(toolId);
          if (!tool) {
            console.error("Tool content not found:", toolId);
            return;
          }

          const isCurrentlyVisible = tool.style.display === 'block';

          // ã¾ãšã€æŒ‡å®šã•ã‚ŒãŸã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…ã®ã™ã¹ã¦ã®ãƒ„ãƒ¼ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éè¡¨ç¤ºã«ã™ã‚‹
          hideToolContentsInSection(sectionId);

          // ã‚‚ã—ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸãƒ„ãƒ¼ãƒ«ãŒå…ƒã€…éè¡¨ç¤ºã ã£ãŸå ´åˆã®ã¿ã€è¡¨ç¤ºã™ã‚‹
          if (!isCurrentlyVisible) {
            tool.style.display = 'block';
            // ãƒ„ãƒ¼ãƒ«ã”ã¨ã®åˆæœŸåŒ–å‡¦ç†
            if (toolId === 'resize-tool-content') {
              setupDragAndDrop();
            } else if (toolId === 'function-calculator-content') {
              initializeCalculator();
            } else if (toolId === 'memo-tool-content') {
              initializeMemoApp();
            } else if (toolId === 'color-checker-content') { 
              initializeColorChecker(); 
            } else if (toolId === 'unit-volume-tool-content') {
              initializeUnitVolumeTool();
            }
          }
          // å…ƒã€…è¡¨ç¤ºã•ã‚Œã¦ã„ãŸå ´åˆã¯ã€hideToolContentsInSection ã§éš ã•ã‚ŒãŸã¾ã¾ã«ãªã‚‹
        }
        // --- æ—¢å­˜ã® toggle***Tool é–¢æ•°ç¾¤ã¯å‰Šé™¤ --- 

      // --- ã“ã“ã‹ã‚‰è‰²å½©ææ¡ˆãƒ„ãƒ¼ãƒ«ã®é–¢æ•° ---
      function hexToRgb(hex) {
        let r = 0, g = 0, b = 0;
        if (hex.length == 4) {
          r = parseInt(hex[1] + hex[1], 16);
          g = parseInt(hex[2] + hex[2], 16);
          b = parseInt(hex[3] + hex[3], 16);
        } else if (hex.length == 7) {
          r = parseInt(hex[1] + hex[2], 16);
          g = parseInt(hex[3] + hex[4], 16);
          b = parseInt(hex[5] + hex[6], 16);
        }
        return { r, g, b };
      }

      function rgbToHsl(r, g, b) {
        r /= 255; g /= 255; b /= 255;
        const max = Math.max(r, g, b), min = Math.min(r, g, b);
        let h, s, l = (max + min) / 2;

        if (max == min) {
          h = s = 0; // achromatic
        } else {
          const d = max - min;
          s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
          switch (max) {
            case r: h = (g - b) / d + (g < b ? 6 : 0); break;
            case g: h = (b - r) / d + 2; break;
            case b: h = (r - g) / d + 4; break;
          }
          h /= 6;
        }
        return { h: h * 360, s: s * 100, l: l * 100 };
      }

      function hslToRgb(h, s, l) {
        h /= 360; s /= 100; l /= 100;
        let r, g, b;

        if (s == 0) {
          r = g = b = l; // achromatic
        } else {
          const hue2rgb = (p, q, t) => {
            if (t < 0) t += 1;
            if (t > 1) t -= 1;
            if (t < 1 / 6) return p + (q - p) * 6 * t;
            if (t < 1 / 2) return q;
            if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;
            return p;
          };
          const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
          const p = 2 * l - q;
          r = hue2rgb(p, q, h + 1 / 3);
          g = hue2rgb(p, q, h);
          b = hue2rgb(p, q, h - 1 / 3);
        }
        return { r: Math.round(r * 255), g: Math.round(g * 255), b: Math.round(b * 255) };
      }

      function rgbToHex(r, g, b) {
        return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase();
      }

      function getLuminance(r, g, b) {
        const a = [r, g, b].map(v => {
          v /= 255;
          return v <= 0.03928 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4);
        });
        return a[0] * 0.2126 + a[1] * 0.7152 + a[2] * 0.0722;
      }

      function getContrastRatio(rgb1, rgb2) {
        const lum1 = getLuminance(rgb1.r, rgb1.g, rgb1.b);
        const lum2 = getLuminance(rgb2.r, rgb2.g, rgb2.b);
        const brightest = Math.max(lum1, lum2);
        const darkest = Math.min(lum1, lum2);
        return (brightest + 0.05) / (darkest + 0.05);
      }

      function suggestColorCombinations(baseHex) {
        document.getElementById('base-color-value').textContent = baseHex.toUpperCase();
        const baseRgb = hexToRgb(baseHex);
        const baseHsl = rgbToHsl(baseRgb.r, baseRgb.g, baseRgb.b);
        const suggestionsDiv = document.getElementById('color-suggestions');
        suggestionsDiv.innerHTML = ''; // Clear previous suggestions

        const schemes = [
          { name: 'è£œè‰² (Complementary)', angle: 180 },
          { name: 'é¡ä¼¼è‰² (Analogous)', angle: 30 },
          { name: 'ãƒˆãƒ©ã‚¤ã‚¢ãƒ‰ (Triadic)', angle: 120 },
          { name: 'åˆ†å‰²è£œè‰² (Split Complementary)', angle: 150 },
          { name: 'ãƒ†ãƒˆãƒ©ãƒ¼ãƒ‰ (Tetradic/Rectangular)', angle: 60 } // Tetradic usually involves multiple steps
        ];

        schemes.forEach(scheme => {
          const card = document.createElement('div');
          card.className = 'bg-gray-50 p-2 rounded-lg border border-gray-200 flex-grow'; // p-4 ã‚’ p-2 ã«å¤‰æ›´, flex-growè¿½åŠ 
          let colorsHtml = `<h4 class="text-sm font-semibold text-gray-700 mb-2">${scheme.name}</h4>`; // mb-3 ã‚’ mb-2 ã«å¤‰æ›´
          colorsHtml += '<div class="flex flex-col gap-1 mb-2">'; // flex-wrap gap-2 mb-3 ã‹ã‚‰ flex flex-col gap-1 mb-2 ã«å¤‰æ›´

          let suggestedColors = []; // â˜… åŸºæº–è‰²ã‚’å«ã‚ãšã«ç©ºã§åˆæœŸåŒ–

          if (scheme.name === 'é¡ä¼¼è‰² (Analogous)') {
            const hsl1 = { ...baseHsl, h: (baseHsl.h - scheme.angle + 360) % 360 };
            const hsl2 = { ...baseHsl, h: (baseHsl.h + scheme.angle) % 360 };
            const rgb1 = hslToRgb(hsl1.h, hsl1.s, hsl1.l);
            const rgb2 = hslToRgb(hsl2.h, hsl2.s, hsl2.l);
            suggestedColors.push(rgbToHex(rgb1.r, rgb1.g, rgb1.b));
            suggestedColors.push(rgbToHex(rgb2.r, rgb2.g, rgb2.b));
          } else if (scheme.name === 'ãƒˆãƒ©ã‚¤ã‚¢ãƒ‰ (Triadic)') {
            const hsl1 = { ...baseHsl, h: (baseHsl.h + scheme.angle) % 360 };
            const hsl2 = { ...baseHsl, h: (baseHsl.h + 2 * scheme.angle) % 360 };
            const rgb1 = hslToRgb(hsl1.h, hsl1.s, hsl1.l);
            const rgb2 = hslToRgb(hsl2.h, hsl2.s, hsl2.l);
            suggestedColors.push(rgbToHex(rgb1.r, rgb1.g, rgb1.b));
            suggestedColors.push(rgbToHex(rgb2.r, rgb2.g, rgb2.b));
          } else if (scheme.name === 'åˆ†å‰²è£œè‰² (Split Complementary)') {
            const complementHsl = { ...baseHsl, h: (baseHsl.h + 180) % 360 };
            const hsl1 = { ...complementHsl, h: (complementHsl.h - 30 + 360) % 360 };
            const hsl2 = { ...complementHsl, h: (complementHsl.h + 30) % 360 };
            const rgb1 = hslToRgb(hsl1.h, hsl1.s, hsl1.l);
            const rgb2 = hslToRgb(hsl2.h, hsl2.s, hsl2.l);
            suggestedColors.push(rgbToHex(rgb1.r, rgb1.g, rgb1.b));
            suggestedColors.push(rgbToHex(rgb2.r, rgb2.g, rgb2.b));
          } else if (scheme.name === 'ãƒ†ãƒˆãƒ©ãƒ¼ãƒ‰ (Tetradic/Rectangular)') {
             const hsl1 = { ...baseHsl, h: (baseHsl.h + scheme.angle) % 360 };
             const hsl2 = { ...baseHsl, h: (baseHsl.h + 180) % 360 };
             const hsl3 = { ...baseHsl, h: (baseHsl.h + 180 + scheme.angle) % 360 };
             const rgb1 = hslToRgb(hsl1.h, hsl1.s, hsl1.l);
             const rgb2 = hslToRgb(hsl2.h, hsl2.s, hsl2.l);
             const rgb3 = hslToRgb(hsl3.h, hsl3.s, hsl3.l);
             suggestedColors.push(rgbToHex(rgb1.r, rgb1.g, rgb1.b));
             suggestedColors.push(rgbToHex(rgb2.r, rgb2.g, rgb2.b));
             suggestedColors.push(rgbToHex(rgb3.r, rgb3.g, rgb3.b));
          } else { // Complementary and others with a single angle shift
            const hsl1 = { ...baseHsl, h: (baseHsl.h + scheme.angle) % 360 };
            const rgb1 = hslToRgb(hsl1.h, hsl1.s, hsl1.l);
            suggestedColors.push(rgbToHex(rgb1.r, rgb1.g, rgb1.b));
          }


          suggestedColors.forEach(hex => {
            const rgb = hexToRgb(hex); // HEXã‹ã‚‰RGBã«å¤‰æ›
            colorsHtml += `<div class="flex items-center gap-2">
                           <div class="w-12 h-6 rounded border border-gray-300 flex-shrink-0" style="background-color: ${hex};"></div>
                           <span class="text-[10px] font-mono text-gray-600">${hex}</span>
                           <span class="text-[10px] text-gray-500 ml-1">R${rgb.r} G${rgb.g} B${rgb.b}</span>
                         </div>`;
          });
          colorsHtml += '</div>';

          card.innerHTML = colorsHtml;
          suggestionsDiv.appendChild(card);
        });
      }

      // --- ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆç”Ÿæˆãƒ»å‡¦ç†é–¢æ•° ---
      function generateColorPalette() {
        const paletteContainer = document.getElementById('color-palette');
        if (!paletteContainer) return;

        // Tailwind CSS v3 Default Colors (å‚è€ƒ)
        const tailwindColors = {
          gray: { 50: "#F9FAFB", 100: "#F3F4F6", 200: "#E5E7EB", 300: "#D1D5DB", 400: "#9CA3AF", 500: "#6B7280", 600: "#4B5563", 700: "#374151", 800: "#1F2937", 900: "#111827" },
          red: { 50: "#FEF2F2", 100: "#FEE2E2", 200: "#FECACA", 300: "#FCA5A5", 400: "#F87171", 500: "#EF4444", 600: "#DC2626", 700: "#B91C1C", 800: "#991B1B", 900: "#7F1D1D" },
          orange: { 50: "#FFF7ED", 100: "#FFEDD5", 200: "#FED7AA", 300: "#FDBA74", 400: "#FB923C", 500: "#F97316", 600: "#EA580C", 700: "#C2410C", 800: "#9A3412", 900: "#7C2D12" },
          amber: { 50: "#FFFBEB", 100: "#FEF3C7", 200: "#FDE68A", 300: "#FCD34D", 400: "#FBBF24", 500: "#F59E0B", 600: "#D97706", 700: "#B45309", 800: "#92400E", 900: "#78350F" },
          yellow: { 50: "#FEFCE8", 100: "#FEF9C3", 200: "#FEF08A", 300: "#FDE047", 400: "#FACC15", 500: "#EAB308", 600: "#CA8A04", 700: "#A16207", 800: "#854D0E", 900: "#713F12" },
          lime: { 50: "#F7FEE7", 100: "#ECFCCB", 200: "#D9F99D", 300: "#BEF264", 400: "#A3E635", 500: "#84CC16", 600: "#65A30D", 700: "#4D7C0F", 800: "#3F6212", 900: "#365314" },
          green: { 50: "#F0FDF4", 100: "#DCFCE7", 200: "#BBF7D0", 300: "#86EFAC", 400: "#4ADE80", 500: "#22C55E", 600: "#16A34A", 700: "#15803D", 800: "#166534", 900: "#14532D" },
          emerald: { 50: "#ECFDF5", 100: "#D1FAE5", 200: "#A7F3D0", 300: "#6EE7B7", 400: "#34D399", 500: "#10B981", 600: "#059669", 700: "#047857", 800: "#065F46", 900: "#064E3B" },
          teal: { 50: "#F0FDFA", 100: "#CCFBF1", 200: "#99F6E4", 300: "#5EEAD4", 400: "#2DD4BF", 500: "#14B8A6", 600: "#0D9488", 700: "#0F766E", 800: "#115E59", 900: "#134E4A" },
          cyan: { 50: "#ECFEFF", 100: "#CFFAFE", 200: "#A5F3FC", 300: "#67E8F9", 400: "#22D3EE", 500: "#06B6D4", 600: "#0891B2", 700: "#0E7490", 800: "#155E75", 900: "#164E63" },
          sky: { 50: "#F0F9FF", 100: "#E0F2FE", 200: "#BAE6FD", 300: "#7DD3FC", 400: "#38BDF8", 500: "#0EA5E9", 600: "#0284C7", 700: "#0369A1", 800: "#075985", 900: "#0C4A6E" },
          blue: { 50: "#EFF6FF", 100: "#DBEAFE", 200: "#BFDBFE", 300: "#93C5FD", 400: "#60A5FA", 500: "#3B82F6", 600: "#2563EB", 700: "#1D4ED8", 800: "#1E40AF", 900: "#1E3A8A" },
          indigo: { 50: "#EEF2FF", 100: "#E0E7FF", 200: "#C7D2FE", 300: "#A5B4FC", 400: "#818CF8", 500: "#6366F1", 600: "#4F46E5", 700: "#4338CA", 800: "#3730A3", 900: "#312E81" },
          violet: { 50: "#F5F3FF", 100: "#EDE9FE", 200: "#DDD6FE", 300: "#C4B5FD", 400: "#A78BFA", 500: "#8B5CF6", 600: "#7C3AED", 700: "#6D28D9", 800: "#5B21B6", 900: "#4C1D95" },
          purple: { 50: "#FAF5FF", 100: "#F3E8FF", 200: "#E9D5FF", 300: "#D8B4FE", 400: "#C084FC", 500: "#A855F7", 600: "#9333EA", 700: "#7E22CE", 800: "#6B21A8", 900: "#581C87" },
          fuchsia: { 50: "#FDF4FF", 100: "#FAE8FF", 200: "#F5D0FE", 300: "#F0ABFC", 400: "#E879F9", 500: "#D946EF", 600: "#C026D3", 700: "#A21CAF", 800: "#86198F", 900: "#701A75" },
          pink: { 50: "#FDF2F8", 100: "#FCE7F3", 200: "#FBCFE8", 300: "#F9A8D4", 400: "#F472B6", 500: "#EC4899", 600: "#DB2777", 700: "#BE185D", 800: "#9D174D", 900: "#831843" },
          rose: { 50: "#FFF1F2", 100: "#FFE4E6", 200: "#FECDD3", 300: "#FDA4AF", 400: "#FB7185", 500: "#F43F5E", 600: "#E11D48", 700: "#BE123C", 800: "#9F1239", 900: "#881337" }
        };

        // ãƒ‘ãƒ¬ãƒƒãƒˆã®HTMLã‚’ç”Ÿæˆ
        let paletteHTML = '<div class="grid gap-0.5" style="grid-template-columns: repeat(' + Object.keys(tailwindColors).length + ', minmax(0, 1fr));">'; // åˆ—æ•°ã¯è‰²ã®ç¨®é¡ã®æ•°

        const shades = [50, 100, 200, 300, 400, 500, 600, 700, 800, 900]; // è¡¨ç¤ºã™ã‚‹æ˜åº¦

        // è‰²ã®è¡Œ
        shades.forEach(shade => {
          Object.keys(tailwindColors).forEach(colorName => {
            const hex = tailwindColors[colorName][shade];
            if (hex) {
              paletteHTML += `<div class="w-full h-5 rounded-sm border border-gray-100 cursor-pointer hover:scale-110 hover:shadow transition-transform" 
                               style="background-color: ${hex};" 
                               data-color="${hex}" 
                               title="${colorName}-${shade}: ${hex}">
                           </div>`;
            } else {
              paletteHTML += '<div></div>'; // è‰²ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ç©ºã®ã‚»ãƒ«
            }
          });
        });

        paletteHTML += '</div>';
        paletteContainer.innerHTML = paletteHTML;

        // ãƒ‘ãƒ¬ãƒƒãƒˆã¸ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ  (ã‚¤ãƒ™ãƒ³ãƒˆå§”ä»»)
        paletteContainer.addEventListener('click', function(event) {
          const target = event.target;
          if (target.dataset.color) { // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã®ãŒè‰²è¦‹æœ¬ã‹ç¢ºèª
            const selectedColor = target.dataset.color;
            const colorPicker = document.getElementById('base-color-picker');
            const colorValueSpan = document.getElementById('base-color-value');
            
            if(colorPicker) colorPicker.value = selectedColor;
            if(colorValueSpan) colorValueSpan.textContent = selectedColor.toUpperCase();
            suggestColorCombinations(selectedColor);
          }
        });
      }

      // ãƒ„ãƒ¼ãƒ«è¡¨ç¤ºæ™‚ã«ãƒ‘ãƒ¬ãƒƒãƒˆã‚’ç”Ÿæˆ
      function initializeColorChecker() {
         generateColorPalette();
         const initialColor = document.getElementById('base-color-picker').value;
         suggestColorCombinations(initialColor);
      }
      // --- è‰²å½©ææ¡ˆãƒ„ãƒ¼ãƒ«ã®é–¢æ•°ã“ã“ã¾ã§ ---

      // --- ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆé–¢æ•° ---
      function toggleColorPalette() {
        const palette = document.getElementById('color-palette');
        if (palette) {
          palette.classList.toggle('hidden');
        }
      }
      // --- å˜ä½ä½“ç©é‡é‡è¨ˆç®—ãƒ„ãƒ¼ãƒ«ã®é–¢æ•° ---
      const materials = [
        { name: "æ°´", weight: 1000 },
        { name: "ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆï¼ˆæ™®é€šï¼‰", weight: 2300 },
        { name: "ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆï¼ˆè»½é‡ï¼‰", weight: 1800 },
        { name: "é‰„", weight: 7850 },
        { name: "ã‚¢ãƒ«ãƒŸãƒ‹ã‚¦ãƒ ", weight: 2700 },
        { name: "ã‚¹ãƒ†ãƒ³ãƒ¬ã‚¹é‹¼", weight: 7930 },
        { name: "ã‚¬ãƒ©ã‚¹", weight: 2500 },
        { name: "æœ¨æï¼ˆæ‰ï¼‰", weight: 400 },
        { name: "æœ¨æï¼ˆæªœï¼‰", weight: 450 },
        { name: "æœ¨æï¼ˆæ¾ï¼‰", weight: 550 },
        { name: "ã‚¢ã‚¹ãƒ•ã‚¡ãƒ«ãƒˆ", weight: 2200 },
        { name: "åœŸï¼ˆä¹¾ç‡¥ï¼‰", weight: 1600 },
        { name: "åœŸï¼ˆæ¹¿æ½¤ï¼‰", weight: 1800 },
        { name: "ç ‚åˆ©", weight: 1700 },
        { name: "ç ‚", weight: 1600 },
        { name: "ãƒ¬ãƒ³ã‚¬", weight: 1800 },
        { name: "çŸ³è†ãƒœãƒ¼ãƒ‰ (12.5mm)", weight: 9.5 }, // ã“ã‚Œã¯é¢ç©ã‚ãŸã‚Šã®é‡é‡ (kg/m2) ã®ä¾‹
        { name: "åˆæ¿ (12mm)", weight: 7 }, // ã“ã‚Œã‚‚é¢ç©ã‚ãŸã‚Šã®é‡é‡ (kg/m2) ã®ä¾‹
        // å¿…è¦ã«å¿œã˜ã¦ä»–ã®ææ–™ã‚’è¿½åŠ 
      ];

      function initializeUnitVolumeTool() {
        const selectElement = document.getElementById('material-select');
        if (!selectElement) return;

        selectElement.innerHTML = '<option value="">ææ–™ã‚’é¸æŠã—ã¦ãã ã•ã„</option>'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 

        materials.forEach((material, index) => {
          const option = document.createElement('option');
          option.value = index; // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å€¤ã¨ã—ã¦ä½¿ç”¨
          // é¢ç©ã‚ãŸã‚Šã®é‡é‡ã‚’æŒã¤ææ–™ã«ã¯æ³¨è¨˜ã‚’è¿½åŠ 
          const displayName = material.weight < 100 ? `${material.name} (kg/mÂ²)` : material.name;
          option.textContent = displayName;
          selectElement.appendChild(option);
        });

        // é¸æŠè‚¢ãŒå¤‰æ›´ã•ã‚ŒãŸã¨ãã«å˜ä½é‡é‡è¡¨ç¤ºã‚’æ›´æ–°ã™ã‚‹ãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ 
        selectElement.addEventListener('change', displaySelectedUnitWeight);
        // åˆæœŸè¡¨ç¤ºã®ãŸã‚ã«å‘¼ã³å‡ºã—
        displaySelectedUnitWeight(); 
      }

      function displaySelectedUnitWeight() {
        const selectElement = document.getElementById('material-select');
        const unitWeightDisplay = document.getElementById('unit-weight-display');
        if (!selectElement || !unitWeightDisplay) return;

        const selectedIndex = selectElement.value;
        if (selectedIndex !== "") {
          const selectedMaterial = materials[parseInt(selectedIndex)];
          // é¢ç©ã‚ãŸã‚Šã®é‡é‡ã‹ä½“ç©ã‚ãŸã‚Šã®é‡é‡ã‹ã§è¡¨ç¤ºã‚’åˆ†ã‘ã‚‹
          if (selectedMaterial.weight < 100) {
            unitWeightDisplay.textContent = `å˜ä½é‡é‡: ${selectedMaterial.weight} kg/mÂ²`;
          } else {
            unitWeightDisplay.textContent = `å˜ä½ä½“ç©é‡é‡: ${selectedMaterial.weight} kg/mÂ³`;
          }
        } else {
          unitWeightDisplay.textContent = ''; // ä½•ã‚‚é¸æŠã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã‚¯ãƒªã‚¢
        }
         // çµæœè¡¨ç¤ºã‚‚ãƒªã‚»ãƒƒãƒˆ
         const resultElement = document.getElementById('material-weight-result');
         if (resultElement) resultElement.textContent = '- kg';
      }

      function calculateMaterialWeight() {
        const selectElement = document.getElementById('material-select');
        const widthInput = document.getElementById('material-width');
        const depthInput = document.getElementById('material-depth');
        const heightInput = document.getElementById('material-height');
        const resultElement = document.getElementById('material-weight-result');

        if (!selectElement || !widthInput || !depthInput || !heightInput || !resultElement) {
            console.error("å˜ä½ä½“ç©è¨ˆç®—ã«å¿…è¦ãªè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚");
            return;
        }

        const selectedIndex = selectElement.value;
        const width = parseFloat(widthInput.value) || 0;
        const depth = parseFloat(depthInput.value) || 0;
        const height = parseFloat(heightInput.value) || 0;

        if (selectedIndex === "") {
          alert('ææ–™ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
          resultElement.textContent = '- kg';
          return;
        }

        if (width <= 0 || depth <= 0 || height <= 0) {
          alert('æœ‰åŠ¹ãªå¯¸æ³•ï¼ˆå¹…ã€å¥¥è¡Œã€é«˜ã•ï¼‰ã‚’mmå˜ä½ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
          resultElement.textContent = '- kg';
          return;
        }

        const selectedMaterial = materials[parseInt(selectedIndex)];
        const unitWeight = selectedMaterial.weight;

        let calculatedWeight;

        // å˜ä½é‡é‡ãŒå°ã•ã„å€¤ï¼ˆä¾‹: 100æœªæº€ï¼‰ã®å ´åˆã¯é¢ç©è¨ˆç®—ã¨ä»®å®š
        if (unitWeight < 100) {
           // é¢ç© (m^2) = å¹… (m) * å¥¥è¡Œ (m) --- é«˜ã•ã¯ç„¡è¦–
           const areaM2 = (width / 1000) * (depth / 1000);
           calculatedWeight = areaM2 * unitWeight;
           resultElement.textContent = `${calculatedWeight.toFixed(2)} kg (é¢ç©è¨ˆç®—)`;
        } else {
          // ä½“ç© (m^3) = å¹… (m) * å¥¥è¡Œ (m) * é«˜ã• (m)
          const volumeM3 = (width / 1000) * (depth / 1000) * (height / 1000);
          // é‡é‡ (kg) = ä½“ç© (m^3) * å˜ä½ä½“ç©é‡é‡ (kg/m^3)
          calculatedWeight = volumeM3 * unitWeight;
          resultElement.textContent = `${calculatedWeight.toFixed(2)} kg`;
        }
         // å˜ä½é‡é‡è¡¨ç¤ºã‚‚æ›´æ–°ã—ã¦ãŠã
         // displaySelectedUnitWeight(); // â† ã“ã®è¡Œã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ
      }

      // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã€ã¾ãŸã¯ãƒ„ãƒ¼ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ææ–™ãƒªã‚¹ãƒˆã‚’åˆæœŸåŒ–
      // toggleToolDisplay é–¢æ•°å†…ã§ unit-volume-tool-content ãŒè¡¨ç¤ºã•ã‚Œã‚‹éš›ã«å‘¼ã¶ã‚ˆã†ã«å¤‰æ›´æ¸ˆã¿ãªã®ã§ã€
      // ã“ã“ã§ã® DOMContentLoaded å†…ã®å‘¼ã³å‡ºã—ã¯ä¸è¦ãªå ´åˆã‚‚ã‚ã‚Šã¾ã™ã€‚
      // document.addEventListener('DOMContentLoaded', initializeUnitVolumeTool); 
      // --- å˜ä½ä½“ç©é‡é‡è¨ˆç®—ãƒ„ãƒ¼ãƒ«ã®é–¢æ•°ã“ã“ã¾ã§ ---

      // --- â–¼â–¼â–¼ é–¢æ•°é›»å“ã®é–¢æ•° â–¼â–¼â–¼ ---
      let calculatorCurrentInput = '';
      let calculatorExpressionValue = '';
      let calculatorHistory = []; // è¨ˆç®—å±¥æ­´ç”¨é…åˆ—
      let lastAns = 0; // Store the last answer
      let justCalculated = false; // Flag to check if the last action was '='

      // Helper function to convert degrees to radians
      function degToRad(degrees) {
        return degrees * (Math.PI / 180);
      }

      // â˜…â˜…â˜… æ–°ã—ã„ä¸‰è§’é–¢æ•°å‡¦ç†ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿½åŠ  â˜…â˜…â˜…
      const trigFunctions = {
        sin: (x) => Math.sin(degToRad(x)),
        cos: (x) => Math.cos(degToRad(x)),
        tan: (x) => Math.tan(degToRad(x)),
        // å¿…è¦ã«å¿œã˜ã¦ä»–ã®é–¢æ•° (ä¾‹: log10, ln, sqrt) ã‚‚ã“ã“ã«è¿½åŠ å¯èƒ½
        log: (x) => Math.log10(x), // log ã¯ log10 ã¨ã™ã‚‹
        ln: (x) => Math.log(x),    // ln ã¯è‡ªç„¶å¯¾æ•°
        'âˆš': (x) => Math.sqrt(x)   // âˆš ã¯ sqrt
      };

      // â˜…â˜…â˜… æ–°ã—ã„å®‰å…¨ãªè©•ä¾¡é–¢æ•°ã‚’è¿½åŠ  â˜…â˜…â˜…
      function safeEvaluate(expression) {
        try {
          // 0. Clean up expression: remove extra spaces, handle consecutive operators (e.g., 5 * - 2 -> 5 * -2)
          expression = expression.replace(/\s+/g, ''); // Remove all spaces
          // Be careful with replacing operators, might need more sophisticated logic for order of operations
          // Example: handle `--` -> `+`? `+-` -> `-`?
          // For now, focus on function evaluation and basic security.

          // 1. é–¢æ•°å‘¼ã³å‡ºã— (ä¾‹: sin(30), log(100)) ã‚’å…ˆã«è©•ä¾¡ (å†å¸°çš„ã«)
          //    æ­£è¦è¡¨ç¾ã‚’æ”¹å–„ã—ã€ãƒã‚¹ãƒˆã•ã‚ŒãŸæ‹¬å¼§ã«ã‚‚å¯¾å¿œã§ãã‚‹ã‚ˆã†ã«è©¦ã¿ã‚‹ (é™å®šçš„)
          const evaluateFunctions = (expr) => {
             return expr.replace(/(sin|cos|tan|log|ln|âˆš)\s*\(([^()]*|\([^()]*\))*\)/g, (match, func, arg) => {
                 try {
                     // å¼•æ•°éƒ¨åˆ†ã‚’å†å¸°çš„ã«è©•ä¾¡
                     const argValue = evaluateFunctions(arg); // Use evaluateFunctions recursively
                     const numArg = safeEvaluateBasicOpsOnly(argValue); // Evaluate argument using basic ops only

                     if (trigFunctions[func]) {
                         if (func === 'tan' && Math.abs(numArg % 180) === 90) {
                             throw new Error('Math Error: tan(90)');
                         }
                         const funcResult = trigFunctions[func](numArg);
                         if (isNaN(funcResult)) throw new Error(`Math Error: ${func}(${numArg})`);
                         return funcResult;
                     } else {
                          throw new Error(`Unknown function: ${func}`);
                     }
                 } catch(e) {
                     // If function evaluation fails, re-throw or return an error indicator
                     console.error(`Error evaluating function ${func}(${arg}):`, e);
                     throw e; // Re-throw the error
                 }
             });
          };
          expression = evaluateFunctions(expression);


          // 2. ç´¯ä¹— (^) ã‚’ Math.pow ã«ç½®æ› (å³çµåˆæ€§ã‚’è€ƒæ…®ã—ãŸãƒ«ãƒ¼ãƒ—)
          // æ³¨æ„: è¤‡é›‘ãªå¼ã‚„æ¼”ç®—å­ã®å„ªå…ˆé †ä½ã¯å®Œå…¨ã«ã¯è€ƒæ…®ã§ããªã„
          while (expression.includes('^')) {
               // Find the rightmost exponentiation
               let lastIndex = expression.lastIndexOf('^');
               // Find the base (number before ^)
               let baseMatch = expression.substring(0, lastIndex).match(/([\d\.\+\-eE]+)$/);
               // Find the exponent (number after ^)
               let expMatch = expression.substring(lastIndex + 1).match(/^([\d\.\+\-eE]+)/);

               if (baseMatch && expMatch) {
                   let base = baseMatch[1];
                   let exponent = expMatch[1];
                   let baseStart = lastIndex - base.length;
                   let expEnd = lastIndex + 1 + exponent.length;

                   // Ensure base and exponent are numbers
                   const baseNum = parseFloat(base);
                   const expNum = parseFloat(exponent);
                   if (isNaN(baseNum) || isNaN(expNum)) {
                       throw new Error(`Invalid base or exponent: ${base}^${exponent}`);
                   }

                   let powResult = Math.pow(baseNum, expNum);
                   if (isNaN(powResult)) throw new Error('Math Error: Exponentiation resulted in NaN');

                   // Replace the section with the result
                   expression = expression.substring(0, baseStart) + powResult.toString() + expression.substring(expEnd);
               } else {
                    throw new Error('Invalid exponentiation syntax'); // Could not parse base or exponent
               }
           }


          // 3. æ®‹ã£ãŸåŸºæœ¬çš„ãªå››å‰‡æ¼”ç®—ã‚’è©•ä¾¡ (å®‰å…¨ãªæ–‡å­—ã®ã¿è¨±å¯)
          return safeEvaluateBasicOpsOnly(expression);

        } catch (err) {
          console.error("safeEvaluate Error:", err, "Original expression:", expression);
          // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¹ãƒ­ãƒ¼ã—ã¦ calculatorInput ã§æ•æ‰
          throw err; 
        }
      }

      // â˜…â˜…â˜… åŸºæœ¬çš„ãªå››å‰‡æ¼”ç®—ã®ã¿ã‚’è©•ä¾¡ã™ã‚‹è£œåŠ©é–¢æ•° â˜…â˜…â˜…
      function safeEvaluateBasicOpsOnly(expression) {
           try {
                // å®‰å…¨ãªæ–‡å­—ã®ã¿è¨±å¯ (æ•°å­—, ., +, -, *, /, (, ), e, E)
                // Math.pow ã‚„ä»–ã®é–¢æ•°ã¯ã“ã“ã§ã¯è¨±å¯ã—ãªã„
                 if (!/^[\d\s\.\+\-\*\/\(\)!%eE]*$/.test(expression)) {
                   // ç°¡æ˜“çš„ãªãƒã‚§ãƒƒã‚¯ã€‚ã‚ˆã‚Šå³å¯†ãªãƒ‘ãƒ¼ã‚µãƒ¼ãŒæœ›ã¾ã—ã„ã€‚
                   // æ„å›³ã—ãªã„æ–‡å­—ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã¯ã‚¨ãƒ©ãƒ¼
                   console.warn("safeEvaluateBasicOpsOnly blocked potentially unsafe characters in:", expression);
                   throw new Error('Invalid characters for basic calculation');
                }

                // Functionã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã§æœ€çµ‚è©•ä¾¡
                const calculate = new Function(`return ${expression}`);
                const result = calculate();

                if (isNaN(result)) {
                     throw new Error('Calculation resulted in NaN');
                 }
                 // Infinity ã¯ãã®ã¾ã¾è¿”ã™ã‹ã€ã‚¨ãƒ©ãƒ¼ã«ã™ã‚‹ã‹é¸æŠ
                 if (!isFinite(result)) {
                     // throw new Error('Result is Infinity');
                     return result; // Infinity ã‚’è¿”ã™å ´åˆ
                 }

                return result;
           } catch (basicErr) {
                console.error("safeEvaluateBasicOpsOnly Error:", basicErr, "Expression:", expression);
                // ã‚¨ãƒ©ãƒ¼ã‚’å†ã‚¹ãƒ­ãƒ¼ã—ã¦ safeEvaluate ã§æ•æ‰ã•ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹
                throw basicErr;
           }
      }


      function calculatorInput(value) {
        const display = document.getElementById('calculator-display');
        const expressionDisplay = document.getElementById('calculator-expression');
        if (!display || !expressionDisplay) return;

        // AC (All Clear)
        if (value === 'AC') {
          calculatorCurrentInput = '';
          calculatorExpressionValue = '';
          display.value = '0'; // Show 0 instead of empty
          expressionDisplay.value = '';
          justCalculated = false; // Reset flag
        }
        // DEL (Delete)
        else if (value === 'DEL') {
          if (justCalculated) { // If deleting from a result, start fresh
              calculatorCurrentInput = '';
          }
          calculatorCurrentInput = calculatorCurrentInput.slice(0, -1);
          display.value = calculatorCurrentInput || '0'; // Show 0 if empty
          justCalculated = false; // Reset flag
        }
        // (-) Toggle Sign
        else if (value === '(-)') {
          if (justCalculated) { // If toggling sign after result, start fresh
             calculatorCurrentInput = '';
             justCalculated = false;
          }
          if (calculatorCurrentInput !== '') {
            // Toggle sign of the current number input
            if (calculatorCurrentInput.startsWith('-')) {
                calculatorCurrentInput = calculatorCurrentInput.substring(1);
            } else {
                calculatorCurrentInput = '-' + calculatorCurrentInput;
            }
            display.value = calculatorCurrentInput;
          } else {
             // Allow starting with minus sign if expression is empty or ends with operator/paren
             if (calculatorExpressionValue === '' || /[\\+\\-\\*\\/\\(\\^]$/.test(calculatorExpressionValue.trim())) {
                 calculatorCurrentInput = '-';
                 display.value = calculatorCurrentInput;
             }
          }
        }
        // Ans
        else if (value === 'Ans') {
           if (justCalculated) { // Start new input if after =
               calculatorCurrentInput = '';
               justCalculated = false;
           }
           calculatorCurrentInput += lastAns.toString();
           display.value = calculatorCurrentInput;
        }
        // Numbers and decimal point
        else if (!isNaN(value) || value === '.') {
           if (justCalculated) {
               calculatorCurrentInput = ''; // Clear previous result
               expressionDisplay.value = ''; // Also clear expression display
               calculatorExpressionValue = '';
               justCalculated = false;
           }
           // Prevent multiple decimal points in the current input segment
           if (value === '.' && calculatorCurrentInput.includes('.')) return;
          calculatorCurrentInput += value;
          display.value = calculatorCurrentInput;
        }
        // Operators (+, -, Ã—, Ã·, ^)
        else if (['+', '-', 'Ã—', 'Ã·', '^'].includes(value)) {
          // Append current input to expression if it exists
          if (calculatorCurrentInput !== '') {
            calculatorExpressionValue += calculatorCurrentInput;
            calculatorCurrentInput = '';
          }

          // Replace display operators with calculation operators
          let operator = value;
          if (value === 'Ã—') operator = '*';
          if (value === 'Ã·') operator = '/';

          // Add operator to expression (avoid double operators, allow negative sign)
          if (calculatorExpressionValue !== '' && !/[\\+\\-\\*\\/\\^]$/.test(calculatorExpressionValue.trim())) {
              calculatorExpressionValue += operator;
          } else if (value === '-' && calculatorExpressionValue === '') {
              // Allow starting expression with negative
              calculatorExpressionValue += operator;
          } else if (calculatorExpressionValue !== '' && /[\\+\\-\\*\\/\\^]$/.test(calculatorExpressionValue.trim()) && value === '-') {
              // Allow changing operator to negative e.g., 5 * - 2
              calculatorExpressionValue += operator;
          } else if (calculatorExpressionValue !== '' && /[\\+\\-\\*\\/\\^]$/.test(calculatorExpressionValue.trim())) {
              // Replace last operator if not adding a negative sign
              calculatorExpressionValue = calculatorExpressionValue.trim().slice(0,-1) + operator;
          } else if (calculatorExpressionValue === '') {
               // Handle case where only Ans was pressed then an operator
               calculatorExpressionValue = lastAns.toString() + operator;
          }


          expressionDisplay.value = calculatorExpressionValue; // Update expression display
          display.value = ''; // Clear current number display
          justCalculated = false; // Reset flag
        }
        // Square (xÂ²)
        else if (value === 'xÂ²') {
             if (calculatorCurrentInput !== '') {
                  // Append as ^2 to the expression
                  calculatorExpressionValue += calculatorCurrentInput + '^2';
                  expressionDisplay.value = calculatorExpressionValue;
                  calculatorCurrentInput = ''; // Clear current input
                  display.value = '';
                  justCalculated = false;
              } else if (calculatorExpressionValue !== '') {
                   // Or apply to the last number/result in the expression (more complex logic needed)
                   // Simplified: Apply ^2 to the whole expression (may not be mathematically correct)
                   // calculatorExpressionValue = `(${calculatorExpressionValue})^2`;
                   // Better: just append ^2, evaluate later
                   calculatorExpressionValue += '^2';
                   expressionDisplay.value = calculatorExpressionValue;
                   justCalculated = false;
              }
        }
        // Functions requiring parenthesis (âˆš, log, ln, sin, cos, tan)
        else if (['âˆš', 'log', 'ln', 'sin', 'cos', 'tan'].includes(value)) {
             if (justCalculated) { // Start new expression if after =
                 calculatorExpressionValue = ''; // Clear expression
                 expressionDisplay.value = '';
                 justCalculated = false;
             }
             // Append function name and opening parenthesis
            if (calculatorCurrentInput !== '') {
                calculatorExpressionValue += calculatorCurrentInput; // Add current input before function
                calculatorCurrentInput = '';
            }
            calculatorExpressionValue += value + '(';
            expressionDisplay.value = calculatorExpressionValue;
            display.value = ''; // Clear current input display
            justCalculated = false;
        }
        // Parentheses
         else if (value === '(' || value === ')') {
             if (justCalculated) { // Start new expression if after =
                 calculatorCurrentInput = '';
                 calculatorExpressionValue = '';
                 expressionDisplay.value = '';
                 justCalculated = false;
             }
             if (calculatorCurrentInput !== '') {
                 calculatorExpressionValue += calculatorCurrentInput; // Add current input before parenthesis
                 calculatorCurrentInput = '';
             }
             calculatorExpressionValue += value;
             expressionDisplay.value = calculatorExpressionValue;
             display.value = ''; // Clear current input display
             justCalculated = false;
         }
        // Equals (=)
        else if (value === '=') {
          if (calculatorExpressionValue === '' && calculatorCurrentInput === '') return; // Nothing to calculate

          // Append the final number input to the expression
          if (calculatorCurrentInput !== '') {
               calculatorExpressionValue += calculatorCurrentInput;
               calculatorCurrentInput = ''; // Clear current input after appending
          }

          // Replace display operators with calculation operators for evaluation
          let expressionToEvaluate = calculatorExpressionValue
              .replace(/Ã—/g, '*')
              .replace(/Ã·/g, '/');
              // Power (^) and functions (sin, cos, etc.) handled by safeEvaluate

          try {
              // Use the refined safeEvaluate function
              console.log("Calling safeEvaluate with:", expressionToEvaluate); // Debugging
              const result = safeEvaluate(expressionToEvaluate);
              const displayResult = Number.isFinite(result) ? result : result.toString(); // Handle Infinity display

              display.value = displayResult;
              lastAns = Number.isFinite(result) ? result : 0; // Store finite results for Ans
              // Add to history
              calculatorHistory.push({ expression: calculatorExpressionValue.trim(), result: displayResult, note: '' }); // Store original-looking expression and add note property
              renderCalculatorHistory();
              saveAllData(); // çµ±åˆä¿å­˜ã‚·ã‚¹ãƒ†ãƒ ã§ä¿å­˜
              console.log('ğŸ§® è¨ˆç®—çµæœã‚’å±¥æ­´ã«ä¿å­˜:', calculatorExpressionValue.trim(), '=', displayResult);

              // Reset for next calculation
              calculatorExpressionValue = ''; // Clear the expression used for calculation
              calculatorCurrentInput = Number.isFinite(result) ? result.toString() : ''; // Result becomes start of next input display (if finite)
              expressionDisplay.value = ''; // Clear the top expression display
              justCalculated = true; // Set flag indicating calculation was just performed

          } catch (error) {
            // Display specific math errors or a general error
            display.value = error.message.startsWith('Math Error') || error.message.startsWith('Syntax Error') || error.message.includes('Invalid characters') ? error.message : 'Error';
            console.error('Calculator Error:', error); // Log detailed error
            expressionDisplay.value = calculatorExpressionValue; // Show the expression that caused error
            calculatorExpressionValue = ''; // Clear internal expression value
            calculatorCurrentInput = '';
            justCalculated = false; // Reset flag on error
          }
        }
        // Other buttons (EXP, nCr, SHIFT, ALPHA, MODE) - Not implemented
        else {
            console.warn('Functionality not implemented for:', value);
        }
      }

      function renderCalculatorHistory() {
          const historyDiv = document.getElementById('calculator-history');
          if (!historyDiv) return;
          historyDiv.innerHTML = ''; // Clear existing history
          const historyLength = calculatorHistory.length; // Get total length before slicing
          calculatorHistory.slice(-10).reverse().forEach((entry, loopIndex) => { // Show last 10 entries, newest first
              const originalIndex = historyLength - 1 - loopIndex; // Calculate the index in the original array
              const entryDiv = document.createElement('div');
              // Use flex layout for one line display
              entryDiv.className = 'p-2 border-b border-gray-200 flex items-center gap-2 text-xs';
              entryDiv.innerHTML = `
                  <input type="text"
                         placeholder="ãƒ¡ãƒ¢..."
                         value="${entry.note || ''}"
                         oninput="updateCalculatorHistoryNote(${originalIndex}, this.value)"
                         class="flex-grow border border-gray-200 rounded px-1 py-0.5 focus:outline-none focus:border-gray-400 min-w-0" 
                         style="flex-basis: 30%;"> <!-- Adjust basis as needed -->
                  <div class="text-gray-500 text-right truncate min-w-0" style="flex-basis: 40%;">
                      ${entry.expression} =
                  </div>
                  <div class="font-semibold text-right truncate min-w-0" style="flex-basis: 30%;">
                      ${entry.result}
                  </div>
              `;
              historyDiv.appendChild(entryDiv);
          });
      }

      // â˜…â˜…â˜… æ–°ã—ã„é–¢æ•°: è¨ˆç®—å±¥æ­´ã®ãƒ¡ãƒ¢ã‚’æ›´æ–° â˜…â˜…â˜…
      function updateCalculatorHistoryNote(index, note) {
          if (index >= 0 && index < calculatorHistory.length) {
              calculatorHistory[index].note = note;
              saveAllData(); // çµ±åˆä¿å­˜ã‚·ã‚¹ãƒ†ãƒ ã§ä¿å­˜
              console.log('ğŸ§® è¨ˆç®—å±¥æ­´ãƒ¡ãƒ¢ã‚’ä¿å­˜:', index, note);
              // ã“ã“ã§ localStorage ãªã©ã«æ°¸ç¶šåŒ–ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½
              // localStorage.setItem('calculatorHistory', JSON.stringify(calculatorHistory));
          }
      }
        // --- â–²â–²â–² é–¢æ•°é›»å“ã®é–¢æ•° â–²â–²â–² ---

        // é–¢æ•°é›»å“åˆæœŸåŒ–é–¢æ•°
        function initializeCalculator() {
          const display = document.getElementById('calculator-display');
          const expressionDisplay = document.getElementById('calculator-expression');
          
          if (display && expressionDisplay) {
            display.value = '0';
            expressionDisplay.value = '';
            calculatorCurrentInput = '';
            calculatorExpressionValue = '';
            justCalculated = false;
            renderCalculatorHistory();
          }
        }

      // --- â–¼â–¼â–¼ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æ©Ÿèƒ½ã®é–¢æ•° â–¼â–¼â–¼ ---
      let currentMonth = new Date();

      // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’åˆæœŸåŒ–ã™ã‚‹é–¢æ•°
      function initializeCalendar() {
          renderCalendar(currentMonth);
          
          // å‰æœˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
          document.getElementById('prev-month').addEventListener('click', function() {
              currentMonth.setMonth(currentMonth.getMonth() - 1);
              renderCalendar(currentMonth);
          });
          
          // ç¿Œæœˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
          document.getElementById('next-month').addEventListener('click', function() {
              currentMonth.setMonth(currentMonth.getMonth() + 1);
              renderCalendar(currentMonth);
          });
      }

      // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’æç”»ã™ã‚‹é–¢æ•°
      function renderCalendar(date) {
          const year = date.getFullYear();
          const month = date.getMonth();
          
          // æœˆã®è¡¨ç¤ºã‚’æ›´æ–°
          const monthNames = ["1æœˆ", "2æœˆ", "3æœˆ", "4æœˆ", "5æœˆ", "6æœˆ", "7æœˆ", "8æœˆ", "9æœˆ", "10æœˆ", "11æœˆ", "12æœˆ"];
          document.getElementById('current-month-display').textContent = `${year}å¹´ ${monthNames[month]}`;
          
          // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚°ãƒªãƒƒãƒ‰ã‚’ã‚¯ãƒªã‚¢
          const calendarGrid = document.getElementById('calendar-grid');
          calendarGrid.innerHTML = '';
          
          // æœˆã®æœ€åˆã®æ—¥ã¨æœ€å¾Œã®æ—¥ã‚’å–å¾—
          const firstDay = new Date(year, month, 1);
          const lastDay = new Date(year, month + 1, 0);
          
          // æœˆã®æœ€åˆã®æ—¥ã®æ›œæ—¥ï¼ˆ0: æ—¥æ›œæ—¥, 1: æœˆæ›œæ—¥, ..., 6: åœŸæ›œæ—¥ï¼‰
          const firstDayOfWeek = firstDay.getDay();
          
          // å‰æœˆã®æ—¥ã‚’è¿½åŠ 
          for (let i = 0; i < firstDayOfWeek; i++) {
              const prevMonthDay = new Date(year, month, -i);
              const dayElement = document.createElement('div');
              dayElement.className = 'text-center text-xs text-gray-300 p-2 border border-gray-100 rounded';
              dayElement.textContent = prevMonthDay.getDate();
              calendarGrid.prepend(dayElement);
          }
          
          // å½“æœˆã®æ—¥ã‚’è¿½åŠ 
          for (let i = 1; i <= lastDay.getDate(); i++) {
              const dayElement = document.createElement('div');
              const currentDate = new Date(year, month, i);
              const isToday = isSameDay(currentDate, new Date());
              
              // ã‚¹ã‚¿ã‚¤ãƒ«ã®é©ç”¨
              let className = 'text-center text-xs p-2 border border-gray-100 rounded cursor-pointer';
              if (isToday) {
                  className += ' bg-blue-100 border-blue-300';
              } else {
                  className += ' hover:bg-gray-100';
              }
              
              // åœŸæ—¥ã®ã‚¹ã‚¿ã‚¤ãƒ«
              const dayOfWeek = new Date(year, month, i).getDay();
              if (dayOfWeek === 0) { // æ—¥æ›œæ—¥
                  className += ' text-red-500';
              } else if (dayOfWeek === 6) { // åœŸæ›œæ—¥
                  className += ' text-blue-500';
              } else {
                  className += ' text-gray-700';
              }
              
              dayElement.className = className;
              dayElement.textContent = i;
              calendarGrid.appendChild(dayElement);
          }
          
          // ã‚°ãƒªãƒƒãƒ‰ã‚’7ã®å€æ•°ã«ã™ã‚‹ãŸã‚ã«å¿…è¦ãªç¿Œæœˆã®æ—¥ã‚’è¿½åŠ 
          const totalDaysAdded = firstDayOfWeek + lastDay.getDate();
          const remainingCells = 7 - (totalDaysAdded % 7);
          if (remainingCells < 7) {
              for (let i = 1; i <= remainingCells; i++) {
                  const dayElement = document.createElement('div');
                  dayElement.className = 'text-center text-xs text-gray-300 p-2 border border-gray-100 rounded';
                  dayElement.textContent = i;
                  calendarGrid.appendChild(dayElement);
              }
          }
      }

      // åŒã˜æ—¥ä»˜ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹é–¢æ•°
      function isSameDay(date1, date2) {
          return date1.getFullYear() === date2.getFullYear() &&
                 date1.getMonth() === date2.getMonth() &&
                 date1.getDate() === date2.getDate();
      }
      // --- â–²â–²â–² ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æ©Ÿèƒ½ã®é–¢æ•° â–²â–²â–² ---

      // --- â–¼â–¼â–¼ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æ©Ÿèƒ½æ‹¡å¼µ â–¼â–¼â–¼ ---
      document.addEventListener('DOMContentLoaded', function() {
        // â˜…â˜…â˜… ã“ã“ã«çµ±åˆä¿å­˜ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ã‚’è¿½åŠ  â˜…â˜…â˜…
        // çµ±åˆä¿å­˜ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ï¼ˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”¨ï¼‰
        loadAllData(); // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        const calendarSection = document.getElementById('calendar-area');
        if (!calendarSection) return;

        const calendarGrid = document.getElementById('calendar-grid');
        const prevMonthBtn = document.getElementById('prev-month');
        const nextMonthBtn = document.getElementById('next-month');
        const todayBtn = document.getElementById('today-btn');
        const eventModal = document.getElementById('event-modal');
        const eventForm = document.getElementById('event-form');
        const modalTitle = document.getElementById('modal-title');
        const eventIdInput = document.getElementById('event-id');
        const eventDateInput = document.getElementById('event-date');
        const eventTitleInput = document.getElementById('event-title');
        const eventCategoryInput = document.getElementById('event-category');
        const eventDescriptionInput = document.getElementById('event-description');
        const deleteEventBtn = document.getElementById('delete-event');
        const eventStartHourSelect = document.getElementById('event-start-hour');
        const eventStartMinuteSelect = document.getElementById('event-start-minute');
        const eventEndHourSelect = document.getElementById('event-end-hour');
        const eventEndMinuteSelect = document.getElementById('event-end-minute');
        const cancelEventBtn = document.getElementById('cancel-event');
        const prevDayViewBtn = document.getElementById('prev-day-view');
        const nextDayViewBtn = document.getElementById('next-day-view');
        const todoInput = document.getElementById('todo-input');
        const addTodoBtn = document.getElementById('add-todo-btn');
        const todoListUl = document.getElementById('todo-list');
        
        let currentDate = new Date();
        let viewingDate = new Date();
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();
        let events = JSON.parse(localStorage.getItem('calendarEvents')) || [];
        let todos = JSON.parse(localStorage.getItem('todos')) || [];
        let categories = [];

        // ã‚«ãƒ†ã‚´ãƒªåˆæœŸåŒ–
        function initializeCategories() {
          const storedCategories = localStorage.getItem('calendarCategories');
          if (storedCategories) {
            categories = JSON.parse(storedCategories);
          } else {
            categories = [
              { id: 'cat-1', name: 'å€‹äºº', color: '#fffae6', borderColor: '#ffcc00', isDeletable: true },
              { id: 'cat-2', name: 'ä»•äº‹', color: '#e6f7ff', borderColor: '#1890ff', isDeletable: true },
              { id: 'cat-3', name: 'é‡è¦', color: '#f6ffed', borderColor: '#52c41a', isDeletable: true },
              { id: 'cat-4', name: 'ãã®ä»–', color: '#fff0f6', borderColor: '#eb2f96', isDeletable: false }
            ];
            saveCategories();
          }
        }

        function saveCategories() {
          localStorage.setItem('calendarCategories', JSON.stringify(categories));
        }

        function findCategoryById(id) {
          return categories.find(cat => cat.id === id);
        }
        
        const dayNames = ['æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ', 'æ—¥'];
        const monthNames = ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ', '7æœˆ', '8æœˆ', '9æœˆ', '10æœˆ', '11æœˆ', '12æœˆ'];
        
        function renderCalendar() {
          const firstDay = new Date(currentYear, currentMonth, 1);
          const lastDay = new Date(currentYear, currentMonth + 1, 0);
          calendarGrid.innerHTML = '';
          
          // æ›œæ—¥ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ 
          dayNames.forEach((day, index) => {
            const dayHeader = document.createElement('div');
            dayHeader.className = 'day-header';
            // åœŸæ›œæ—¥ã¨æ—¥æ›œæ—¥ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨
            if (index === 5) {
              dayHeader.classList.add('saturday-header');
            } else if (index === 6) {
              dayHeader.classList.add('sunday-header');
            }
            dayHeader.textContent = day;
            calendarGrid.appendChild(dayHeader);
          });
          
          // æœˆã®æœ€åˆã®æ—¥ã®æ›œæ—¥ã‚’å–å¾—ï¼ˆ0: æ—¥æ›œæ—¥, 1: æœˆæ›œæ—¥, ...ï¼‰
          // æœˆæ›œå§‹ã¾ã‚Šã®ãŸã‚èª¿æ•´
          let startingDay = firstDay.getDay() - 1;
          if (startingDay === -1) startingDay = 6; // æ—¥æ›œæ—¥ã®å ´åˆ
          
          // å‰æœˆã®æ—¥ã‚’è¿½åŠ 
          const prevMonthLastDay = new Date(currentYear, currentMonth, 0).getDate();
          for (let i = 0; i < startingDay; i++) {
            const date = new Date(currentYear, currentMonth - 1, prevMonthLastDay - startingDay + i + 1);
            const dayCell = createDayCell(prevMonthLastDay - startingDay + i + 1, true, date);
            calendarGrid.appendChild(dayCell);
          }
          
          // å½“æœˆã®æ—¥ã‚’è¿½åŠ 
          for (let day = 1; day <= lastDay.getDate(); day++) {
            const date = new Date(currentYear, currentMonth, day);
            const dayCell = createDayCell(day, false, date);
            calendarGrid.appendChild(dayCell);
          }
          
          // ç¿Œæœˆã®æ—¥ã‚’è¿½åŠ 
          const totalCells = startingDay + lastDay.getDate();
          const remainingCells = 7 - (totalCells % 7);
          if (remainingCells < 7) {
            for (let day = 1; day <= remainingCells; day++) {
              const date = new Date(currentYear, currentMonth + 1, day);
              const dayCell = createDayCell(day, true, date);
              calendarGrid.appendChild(dayCell);
            }
          }
          
          document.getElementById('current-month-year').textContent = `${currentYear}å¹´${currentMonth + 1}æœˆ`;
        }
        
        function createDayCell(day, isOtherMonth, date) {
          const dayCell = document.createElement('div');
          dayCell.className = 'day-cell';
          if (isOtherMonth) {
            dayCell.classList.add('other-month');
          }
          
          const today = new Date();
          today.setHours(0, 0, 0, 0);
          const cellDate = new Date(date);
          cellDate.setHours(0, 0, 0, 0);
          
          if (cellDate.getTime() === today.getTime()) {
            dayCell.classList.add('today');
          } else if (!isOtherMonth && cellDate < today) {
            dayCell.classList.add('past-day');
          }
          
          const dayNumber = document.createElement('div');
          dayNumber.className = 'day-number';
          dayNumber.textContent = day;
          
          // æ›œæ—¥ã«å¿œã˜ãŸã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨
          const dayOfWeek = cellDate.getDay();
          if (dayOfWeek === 0) { // æ—¥æ›œæ—¥
            dayNumber.classList.add('sunday');
          } else if (dayOfWeek === 6) { // åœŸæ›œæ—¥
            dayNumber.classList.add('saturday');
          }
          
          dayCell.appendChild(dayNumber);
          
          // ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ 
          const eventList = document.createElement('div');
          eventList.className = 'event-list';
          const dateStr = formatDate(date);
          const dayEvents = events.filter(event => event.date === dateStr);
          
          if (dayEvents.length > 0) {
            const eventsToShow = dayEvents.slice(0, 2);
            eventsToShow.forEach(event => {
              const category = findCategoryById(event.category) || { name: 'æœªåˆ†é¡', color: '#eee', borderColor: '#ccc' };
              const eventItem = document.createElement('div');
              eventItem.className = 'event-item';
              eventItem.style.backgroundColor = category.color;
              eventItem.style.borderLeft = `3px solid ${category.borderColor}`;
              
              let eventText = '';
              if (event.startTime) {
                eventText += event.startTime + ' ';
              }
              eventText += event.title;
              eventItem.textContent = eventText;
              eventItem.setAttribute('data-event-id', event.id);
              
              eventItem.addEventListener('click', function(e) {
                e.stopPropagation();
                openEditEventModal(event);
              });
              
              eventList.appendChild(eventItem);
            });
            
            if (dayEvents.length > 2) {
              const eventCount = document.createElement('div');
              eventCount.className = 'event-count';
              eventCount.textContent = `+${dayEvents.length - 2}`;
              dayCell.appendChild(eventCount);
            }
          }
          
          dayCell.appendChild(eventList);
          
          dayCell.addEventListener('dblclick', function() {
            viewingDate = new Date(date);
            renderTodayView(viewingDate);
            openAddEventModal(date);
          });
          
          return dayCell;
        }
        
        function formatDate(date) {
          return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        }
        
        function generateHourOptions() {
          const options = [];
          for (let h = 0; h < 24; h++) {
            options.push(String(h).padStart(2, '0'));
          }
          return options;
        }
        
        function generateMinuteOptions() {
          return ['00', '15', '30', '45'];
        }
        
        function populateSelectWithOptions(selectElement, options) {
          selectElement.innerHTML = '';
          const emptyOption = document.createElement('option');
          emptyOption.value = '';
          emptyOption.textContent = '--';
          selectElement.appendChild(emptyOption);
          
          options.forEach(value => {
            const option = document.createElement('option');
            option.value = value;
            option.textContent = value;
            selectElement.appendChild(option);
          });
        }
        
        function populateCategoryDropdown() {
          eventCategoryInput.innerHTML = '';
          categories.forEach(cat => {
            const option = document.createElement('option');
            option.value = cat.id;
            option.textContent = cat.name;
            option.style.backgroundColor = cat.color;
            eventCategoryInput.appendChild(option);
          });
        }
        
        function openAddEventModal(date) {
          modalTitle.textContent = `${date.getFullYear()}å¹´${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥ ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ `;
          eventIdInput.value = '';
          eventDateInput.value = formatDate(date);
          eventTitleInput.value = '';
          
          const hourOptions = generateHourOptions();
          const minuteOptions = generateMinuteOptions();
          
          populateSelectWithOptions(eventStartHourSelect, hourOptions);
          populateSelectWithOptions(eventStartMinuteSelect, minuteOptions);
          populateSelectWithOptions(eventEndHourSelect, hourOptions);
          populateSelectWithOptions(eventEndMinuteSelect, minuteOptions);
          
          populateCategoryDropdown();
          eventCategoryInput.value = categories[0]?.id || '';
          eventDescriptionInput.value = '';
          
          deleteEventBtn.style.display = 'none';
          eventModal.style.display = 'flex';
        }
        
        function openEditEventModal(event) {
          modalTitle.textContent = 'ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç·¨é›†';
          eventIdInput.value = event.id;
          eventDateInput.value = event.date;
          eventTitleInput.value = event.title;
          
          const hourOptions = generateHourOptions();
          const minuteOptions = generateMinuteOptions();
          
          populateSelectWithOptions(eventStartHourSelect, hourOptions);
          populateSelectWithOptions(eventStartMinuteSelect, minuteOptions);
          populateSelectWithOptions(eventEndHourSelect, hourOptions);
          populateSelectWithOptions(eventEndMinuteSelect, minuteOptions);
          
          if (event.startTime && event.startTime.includes(':')) {
            const [startH, startM] = event.startTime.split(':');
            eventStartHourSelect.value = startH;
            eventStartMinuteSelect.value = startM;
          }
          
          if (event.endTime && event.endTime.includes(':')) {
            const [endH, endM] = event.endTime.split(':');
            eventEndHourSelect.value = endH;
            eventEndMinuteSelect.value = endM;
          }
          
          populateCategoryDropdown();
          eventCategoryInput.value = event.category || '';
          eventDescriptionInput.value = event.description || '';
          
          deleteEventBtn.style.display = 'block';
          eventModal.style.display = 'flex';
        }
        
        function saveEvent(e) {
          e.preventDefault();
          
          const eventData = {
            id: eventIdInput.value || Date.now().toString(),
            date: eventDateInput.value,
            title: eventTitleInput.value,
            startTime: (eventStartHourSelect.value && eventStartMinuteSelect.value)
                        ? `${eventStartHourSelect.value}:${eventStartMinuteSelect.value}`
                        : '',
            endTime: (eventEndHourSelect.value && eventEndMinuteSelect.value)
                        ? `${eventEndHourSelect.value}:${eventEndMinuteSelect.value}`
                        : '',
            category: eventCategoryInput.value,
            description: eventDescriptionInput.value
          };
          
          if (!eventData.title) {
            alert('ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
            return;
          }
          
          if (eventIdInput.value) {
            events = events.map(event => event.id === eventData.id ? eventData : event);
          } else {
            events.push(eventData);
          }
          
          localStorage.setItem('calendarEvents', JSON.stringify(events));
          closeModal();
          renderCalendar();
          renderTodayView(viewingDate);
        }
        
        function deleteEvent() {
          const eventId = eventIdInput.value;
          if (eventId && confirm('ã“ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
            events = events.filter(event => event.id !== eventId);
            localStorage.setItem('calendarEvents', JSON.stringify(events));
            closeModal();
            renderCalendar();
            renderTodayView(viewingDate);
          }
        }
        
        function closeModal() {
          eventModal.style.display = 'none';
        }
        
        function goToPrevMonth() {
          currentMonth--;
          if (currentMonth < 0) {
            currentMonth = 11;
            currentYear--;
          }
          renderCalendar();
        }
        
        function goToNextMonth() {
          currentMonth++;
          if (currentMonth > 11) {
            currentMonth = 0;
            currentYear++;
          }
          renderCalendar();
        }
        
        function goToToday() {
          const today = new Date();
          currentMonth = today.getMonth();
          currentYear = today.getFullYear();
          viewingDate = new Date();
          renderCalendar();
          renderTodayView(viewingDate);
        }
        
        function renderTodayView(dateToRender) {
          const todayDateElem = document.getElementById('today-date');
          const todayEventsElem = document.getElementById('today-events');
          
          const dateStr = formatDate(dateToRender);
          const dayOfWeek = dayNames[dateToRender.getDay() === 0 ? 6 : dateToRender.getDay() - 1];
          todayDateElem.textContent = `${dateToRender.getFullYear()}å¹´${dateToRender.getMonth() + 1}æœˆ${dateToRender.getDate()}æ—¥(${dayOfWeek})`;
          
          const eventsForDay = events
            .filter(event => event.date === dateStr)
            .sort((a, b) => {
              if (a.startTime && b.startTime) return a.startTime.localeCompare(b.startTime);
              if (a.startTime) return -1;
              if (b.startTime) return 1;
              return 0;
            });
          
          todayEventsElem.innerHTML = '';
          
          if (eventsForDay.length === 0) {
            todayEventsElem.innerHTML = '<li class="no-events">æœ¬æ—¥ã®äºˆå®šã¯ã‚ã‚Šã¾ã›ã‚“</li>';
            return;
          }
          
          eventsForDay.forEach(event => {
            const category = findCategoryById(event.category) || { name: 'æœªåˆ†é¡', color: '#eee', borderColor: '#ccc' };
            const li = document.createElement('li');
            li.style.backgroundColor = category.color; // èƒŒæ™¯è‰²ã¯ã‚«ãƒ†ã‚´ãƒªä¾å­˜ã®ã¾ã¾
            li.style.borderLeft = `3px solid ${category.borderColor}`; // å·¦ãƒœãƒ¼ãƒ€ãƒ¼ã‚‚ã‚«ãƒ†ã‚´ãƒªä¾å­˜
            li.setAttribute('data-event-id', event.id);
            li.style.display = 'block'; // è¡¨ç¤ºå½¢å¼ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã«å¤‰æ›´
            li.style.padding = '4px 8px'; // é©åº¦ãªãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’è¿½åŠ 
            li.style.marginBottom = '4px'; // ãƒªã‚¹ãƒˆé–“ã®ãƒãƒ¼ã‚¸ãƒ³
            li.style.cursor = 'pointer'; // ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã‚’ç¤ºã™
            li.style.borderRadius = '3px'; // è§’ã‚’å°‘ã—ä¸¸ã‚ã‚‹

            // æ™‚é–“è¡¨ç¤ºç”¨ Div
            const timeDiv = document.createElement('div');
            timeDiv.style.whiteSpace = 'nowrap';
            timeDiv.style.overflow = 'hidden';
            timeDiv.style.textOverflow = 'ellipsis';
            let timeText = '';
            if (event.startTime) {
              timeText += event.startTime;
              if (event.endTime) {
                timeText += ` - ${event.endTime}`;
              }
            }
            timeDiv.textContent = timeText || 'çµ‚æ—¥'; // æ™‚é–“ãŒãªã„å ´åˆã¯ã€Œçµ‚æ—¥ã€
            timeDiv.style.fontSize = '11px';
            timeDiv.style.color = 'rgba(0, 0, 0, 0.7)'; // å°‘ã—æ¿ƒã„ã‚°ãƒ¬ãƒ¼

            // ã‚¿ã‚¤ãƒˆãƒ«è¡¨ç¤ºç”¨ Div
            const titleDiv = document.createElement('div');
            titleDiv.style.whiteSpace = 'nowrap';
            titleDiv.style.overflow = 'hidden';
            titleDiv.style.textOverflow = 'ellipsis';
            titleDiv.textContent = event.title;
            titleDiv.style.fontWeight = 'bold';
            titleDiv.style.fontSize = '13px'; // å°‘ã—å¤§ãã
            titleDiv.style.margin = '2px 0';

            // è©³ç´°è¡¨ç¤ºç”¨ Div
            const descriptionDiv = document.createElement('div');
            descriptionDiv.style.whiteSpace = 'nowrap';
            descriptionDiv.style.overflow = 'hidden';
            descriptionDiv.style.textOverflow = 'ellipsis';
            descriptionDiv.textContent = event.description || '\u00A0'; // è©³ç´°ãŒãªã„å ´åˆã¯ãƒãƒ¼ãƒ–ãƒ¬ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹
            descriptionDiv.style.fontSize = '11px';
            descriptionDiv.style.color = 'rgba(0, 0, 0, 0.6)'; // å°‘ã—è–„ã„ã‚°ãƒ¬ãƒ¼

            // li è¦ç´ ã«å„ Div ã‚’è¿½åŠ 
            li.appendChild(timeDiv);
            li.appendChild(titleDiv);
            li.appendChild(descriptionDiv);

            li.addEventListener('click', () => {
              openEditEventModal(event);
            });

            todayEventsElem.appendChild(li);
          });
          
        }
        
        function goToPrevDayView() {
          viewingDate.setDate(viewingDate.getDate() - 1);
          renderTodayView(viewingDate);
        }
        
        function goToNextDayView() {
          viewingDate.setDate(viewingDate.getDate() + 1);
          renderTodayView(viewingDate);
        }
        
        function renderTodoList() {
          todoListUl.innerHTML = '';
          
          if (todos.length === 0) {
            todoListUl.innerHTML = '<li class="no-events">ã‚¿ã‚¹ã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“</li>';
            return;
          }
          
          todos.forEach((todo, index) => {
            const li = document.createElement('li');
            li.setAttribute('data-index', index);
            
            const textSpan = document.createElement('span');
            textSpan.className = 'todo-text';
            textSpan.textContent = todo.text;
            if (todo.completed) {
              textSpan.classList.add('completed');
            }
            textSpan.addEventListener('click', () => toggleTodoComplete(index));
            
            const actionsDiv = document.createElement('div');
            actionsDiv.className = 'todo-actions';
            
            const toggleBtn = document.createElement('button');
            toggleBtn.className = 'toggle-btn';
            toggleBtn.innerHTML = todo.completed ? '&#x21B6;' : '&#x2714;';
            toggleBtn.title = todo.completed ? 'æœªå®Œäº†ã«æˆ»ã™' : 'å®Œäº†ã«ã™ã‚‹';
            if (todo.completed) toggleBtn.classList.add('completed');
            toggleBtn.addEventListener('click', () => toggleTodoComplete(index));
            
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-btn';
            deleteBtn.innerHTML = '&#x1F5D1;';
            deleteBtn.title = 'å‰Šé™¤';
            deleteBtn.addEventListener('click', () => deleteTodo(index));
            
            actionsDiv.appendChild(toggleBtn);
            actionsDiv.appendChild(deleteBtn);
            
            li.appendChild(textSpan);
            li.appendChild(actionsDiv);
            
            todoListUl.appendChild(li);
          });
          
          saveTodos();
        }
        
        function addTodo() {
          const text = todoInput.value.trim();
          if (text === '') return;
          
          todos.push({ text: text, completed: false });
          todoInput.value = '';
          renderTodoList();
        }
        
        function toggleTodoComplete(index) {
          if (todos[index]) {
            todos[index].completed = !todos[index].completed;
            renderTodoList();
          }
        }
        
        function deleteTodo(index) {
          if (confirm('ã“ã®Todoã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
            todos.splice(index, 1);
            saveAllData(); // çµ±åˆä¿å­˜ã‚·ã‚¹ãƒ†ãƒ ã§ä¿å­˜
            console.log('ğŸ—‘ï¸ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã¦ä¿å­˜');
            renderTodoList();
          }
        }
        
        function saveTodos() {
          localStorage.setItem('todos', JSON.stringify(todos));
        }
        
        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
        if (prevMonthBtn) prevMonthBtn.addEventListener('click', goToPrevMonth);
        if (nextMonthBtn) nextMonthBtn.addEventListener('click', goToNextMonth);
        if (todayBtn) todayBtn.addEventListener('click', goToToday);
        if (eventForm) eventForm.addEventListener('submit', saveEvent);
        if (deleteEventBtn) deleteEventBtn.addEventListener('click', deleteEvent);
        if (cancelEventBtn) cancelEventBtn.addEventListener('click', closeModal);
        if (prevDayViewBtn) prevDayViewBtn.addEventListener('click', goToPrevDayView);
        if (nextDayViewBtn) nextDayViewBtn.addEventListener('click', goToNextDayView);
        if (eventModal) eventModal.addEventListener('click', function(e) {
          if (e.target === eventModal) {
            closeModal();
          }
        });
        if (addTodoBtn) addTodoBtn.addEventListener('click', addTodo);
        if (todoInput) todoInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            addTodo();
          }
        });

        // â†“â†“â†“ ã“ã“ã‹ã‚‰ã‚«ãƒ†ã‚´ãƒªç®¡ç†ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ  â†“â†“â†“
        if (addCategoryBtn) {
            addCategoryBtn.addEventListener('click', addCategory);
        }
        if (categoryManagerHeader) { // ãƒ˜ãƒƒãƒ€ãƒ¼å…¨ä½“ã‚’ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«ã™ã‚‹å ´åˆ
            categoryManagerHeader.addEventListener('click', () => {
            categoryManagerDiv.classList.toggle('open'); // openã‚¯ãƒ©ã‚¹ã‚’ä»˜ã‘å¤–ã—ã—ã¦è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
      ã€€});
        }
        // â†‘â†‘â†‘ ã“ã“ã¾ã§ã‚«ãƒ†ã‚´ãƒªç®¡ç†ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ  â†‘â†‘â†‘
        
        // åˆæœŸåŒ– (ã“ã®ãƒ–ãƒ­ãƒƒã‚¯å…¨ä½“ã‚’ç½®ãæ›ãˆã‚‹)
        initializeCategories();     // 1. ã‚«ãƒ†ã‚´ãƒªãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€ (localStorage or ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)
        // initializeSelectors();      // 2. å¹´æœˆã‚»ãƒ¬ã‚¯ã‚¿åˆæœŸåŒ– (userpage.html ã«ã¯ä¸è¦ã‹ã‚‚ï¼Ÿã‚ã‚Œã°æ®‹ã™)
        populateCategoryDropdown(); // 3. ã‚¤ãƒ™ãƒ³ãƒˆç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã‚«ãƒ†ã‚´ãƒªé¸æŠè‚¢ã‚’è¨­å®š (ã‚«ãƒ†ã‚´ãƒªãƒ‡ãƒ¼ã‚¿ãŒå¿…è¦)
        initializeColorPalette();   // 4. ã‚«ãƒ†ã‚´ãƒªè¿½åŠ ç”¨ã®ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆã‚’ä½œæˆ
        renderCategoryList();       // 5. ã‚«ãƒ†ã‚´ãƒªç®¡ç†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º (ã‚«ãƒ†ã‚´ãƒªãƒ‡ãƒ¼ã‚¿ãŒå¿…è¦)
        renderCalendar();           // 6. ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æœ¬ä½“ã‚’æç”»
        renderTodayView(viewingDate); // 7. ã€Œæœ¬æ—¥ã®äºˆå®šã€æ¬„ã‚’æç”» (ã‚«ãƒ†ã‚´ãƒªãƒ‡ãƒ¼ã‚¿ãŒå¿…è¦)
        renderTodoList();           // 8. Todoãƒªã‚¹ãƒˆã‚’æç”»
        initializeMemoTool(); // ãƒ¡ãƒ¢ãƒ„ãƒ¼ãƒ«åˆæœŸåŒ–ã‚’å‘¼ã³å‡ºã™
      }); 

      // --- â–¼â–¼â–¼ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æ©Ÿèƒ½æ‹¡å¼µ â–¼â–¼â–¼ ---
      // â†“â†“â†“ ã“ã“ã«è¿½åŠ  â†“â†“â†“
      const paletteColors = [
          '#ffadad', '#ffd6a5', '#fdffb6', '#caffbf', '#9bf6ff', '#a0c4ff', '#bdb2ff', '#ffc6ff',
          '#ff8a80', '#ffb480', '#ffff80', '#bfff80', '#80ffea', '#80b3ff', '#9f80ff', '#ff80ed'
      ];
      let categories = []; // å…¨ã‚«ãƒ†ã‚´ãƒªã‚’æ ¼ç´
      let selectedColor = null; // ã‚«ãƒ†ã‚´ãƒªè¿½åŠ æ™‚ã«é¸æŠã•ã‚ŒãŸè‰²
      // â†‘â†‘â†‘ ã“ã“ã¾ã§è¿½åŠ  â†‘â†‘â†‘

      document.addEventListener('DOMContentLoaded', function() {

      // çµ±åˆä¿å­˜ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
      console.log('ğŸš€ çµ±åˆä¿å­˜ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–é–‹å§‹');
      loadAllData(); // çµ±åˆãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
      updateLastSavedDisplay(); // æœ€çµ‚ä¿å­˜æ™‚åˆ»è¡¨ç¤º
      startAutoSave(5); // 5åˆ†é–“éš”ã§è‡ªå‹•ä¿å­˜é–‹å§‹
            // å„æ©Ÿèƒ½ã®ç”»é¢ã‚’æ›´æ–°ï¼ˆä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºï¼‰
            if (typeof renderHoukis === 'function') {
          renderHoukis();
          console.log('ğŸ“š Myæ³•è¦ã‚’å†è¡¨ç¤º');
      }
      if (typeof renderContacts === 'function') {
          renderContacts();
          console.log('ğŸ‘¤ é€£çµ¡å…ˆã‚’å†è¡¨ç¤º');
      }
      if (typeof renderTodos === 'function') {
          renderTodos();
          console.log('âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¿ã‚¹ã‚¯ã‚’å†è¡¨ç¤º');
      }
      if (typeof renderTeamTodos === 'function') {
          renderTeamTodos();
          console.log('ğŸ‘¥ ãƒãƒ¼ãƒ ã‚¿ã‚¹ã‚¯ã‚’å†è¡¨ç¤º');
      }
      if (typeof updateTeamProjectDropdown === 'function') {
          updateTeamProjectDropdown();
          console.log('ğŸ”„ ãƒãƒ¼ãƒ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’æ›´æ–°');
      }
      if (typeof updateProjectDropdown === 'function') {
          updateProjectDropdown();
          console.log('ğŸ”„ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚’æ›´æ–°');
      }
      if (typeof renderMemoList === 'function') {
          renderMemoList();
          console.log('ğŸ“ ãƒ¡ãƒ¢ãƒªã‚¹ãƒˆã‚’å†è¡¨ç¤º');
      }
      if (typeof renderCalendar === 'function') {
          renderCalendar();
          console.log('ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’å†è¡¨ç¤º');
      }

      console.log('âœ… çµ±åˆä¿å­˜ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†');
      });

      // --- â–²â–²â–² ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æ©Ÿèƒ½æ‹¡å¼µ â–²â–²â–² ---
      // --- â–¼â–¼â–¼ ãƒ¡ãƒ¢æ©Ÿèƒ½ JavaScript â–¼â–¼â–¼ ---

// --- Helper Functions ---
function generateMemoId() {
  return Date.now().toString() + Math.random().toString(36).substring(2, 9);
}

// --- Core Memo Data Management ---
let memos = [];
let currentMemoId = null;

function loadMemos() {
  const storedMemos = localStorage.getItem('userMemos');
  if (storedMemos) {
    try {
      memos = JSON.parse(storedMemos);
      if (!Array.isArray(memos)) {
        console.warn("Invalid memo data in localStorage, resetting.");
        memos = [];
      }
      memos = memos.map(m => ({
          id: m.id || generateMemoId(),
          title: m.title || '',
          content: m.content || '',
          category: m.category || '',
          tags: Array.isArray(m.tags) ? m.tags : [],
          createdAt: m.createdAt || Date.now(),
          updatedAt: m.updatedAt || Date.now()
      }));
    } catch (e) {
      console.error("Error loading or parsing memos from localStorage:", e);
      memos = [];
    }
  } else {
    memos = [];
  }
  memos.sort((a, b) => (b.updatedAt || 0) - (a.updatedAt || 0));
}

function saveMemos() {
  try {
    localStorage.setItem('userMemos', JSON.stringify(memos));
    console.log("Memos saved to localStorage.");
  } catch (e) {
    console.error("Error saving memos to localStorage:", e);
    updateSaveStatus('ãƒ¡ãƒ¢ã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚', 5000);
  }
}

// --- DOM Element References ---
let memoListContainer, memoTitleInput, memoContentEditor, memoCategoryInput, memoTagsInput;
let deleteMemoButton, manualSaveButton, createNewMemoButton, memoSearchInput;
let memoCategoryFilter, memoTagFilter, memoCharCountSpan, memoSaveStatusSpan;

// --- UI Rendering Functions ---
function renderMemoList() {
  if (!memoListContainer) return;
  memoListContainer.innerHTML = '';

  const searchTerm = memoSearchInput ? memoSearchInput.value.toLowerCase() : '';
  const categoryFilterValue = memoCategoryFilter ? memoCategoryFilter.value : '';
  const tagFilterValue = memoTagFilter ? memoTagFilter.value : '';

  const filteredMemos = memos.filter(memo => {
      const searchContent = `${memo.title || ''} ${memo.content ? memo.content.replace(/<[^>]*>/g, ' ') : ''} ${memo.category || ''} ${(memo.tags || []).join(' ')}`.toLowerCase();
      const matchesSearch = !searchTerm || searchContent.includes(searchTerm);
      const matchesCategory = !categoryFilterValue || (memo.category === categoryFilterValue);
      const matchesTag = !tagFilterValue || (memo.tags && memo.tags.includes(tagFilterValue));
      return matchesSearch && matchesCategory && matchesTag;
  });

  if (filteredMemos.length === 0) {
    memoListContainer.innerHTML = '<p class="text-xs text-gray-500 px-2 py-4 text-center">è©²å½“ã™ã‚‹ãƒ¡ãƒ¢ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
  } else {
    filteredMemos.forEach(memo => {
      const listItem = document.createElement('div');
      listItem.classList.add('p-2', 'border-b', 'border-gray-100', 'cursor-pointer', 'hover:bg-gray-100', 'rounded', 'transition');
      listItem.dataset.memoId = memo.id;
      listItem.innerHTML = `
          <h4 class="text-xs font-medium truncate mb-1">${memo.title || 'ç„¡é¡Œã®ãƒ¡ãƒ¢'}</h4>
          <p class="text-[10px] text-gray-500 truncate mb-1">${new Date(memo.updatedAt || memo.createdAt).toLocaleString('ja-JP', { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' })}</p>
          <div class="flex flex-wrap gap-1">
              ${memo.category ? `<span class="text-[9px] bg-gray-200 text-gray-700 px-1.5 py-0.5 rounded">${memo.category}</span>` : ''}
              ${memo.tags && memo.tags.length > 0 ? memo.tags.map(tag => `<span class="text-[9px] bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded">${tag}</span>`).join(' ') : ''}
          </div>
      `;
      if (memo.id === currentMemoId) {
        listItem.classList.add('bg-blue-50');
      }
      memoListContainer.appendChild(listItem);
    });
  }
  updateFilters();
}

function displayMemo(memoId) {
  const memo = memos.find(m => m.id === memoId);
  if (!memo || !memoTitleInput || !memoContentEditor || !memoCategoryInput || !memoTagsInput) return;

  currentMemoId = memo.id;
  memoTitleInput.value = memo.title || '';
  memoContentEditor.innerHTML = memo.content || '';
  memoCategoryInput.value = memo.category || '';
  memoTagsInput.value = memo.tags ? memo.tags.join(', ') : '';

  updateCharCount();
  updateSaveStatus(`æœ€çµ‚æ›´æ–°: ${new Date(memo.updatedAt || memo.createdAt).toLocaleString('ja-JP')}`, 0);
  if (deleteMemoButton) deleteMemoButton.style.display = 'inline-flex';
  renderMemoList(); // Re-render list to update highlight
  
  // ã‚¿ã‚¤ãƒˆãƒ«ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’å½“ã¦ã¦å³æ™‚ç·¨é›†å¯èƒ½ã«
  if (memoTitleInput) memoTitleInput.focus();


}

function clearEditor() {
    currentMemoId = null;
    if (memoTitleInput) memoTitleInput.value = '';
    if (memoContentEditor) memoContentEditor.innerHTML = '';
    if (memoCategoryInput) memoCategoryInput.value = '';
    if (memoTagsInput) memoTagsInput.value = '';
    if (deleteMemoButton) deleteMemoButton.style.display = 'none';
    if (memoSaveStatusSpan) memoSaveStatusSpan.textContent = 'æ–°ã—ã„ãƒ¡ãƒ¢';
    updateCharCount();
    renderMemoList(); // Re-render list to remove highlight
}

function updateFilters() {
    if (!memoCategoryFilter || !memoTagFilter) return;
    const categories = [...new Set(memos.map(m => m.category).filter(Boolean))].sort();
    const tags = [...new Set(memos.flatMap(m => m.tags || []).filter(Boolean))].sort();
    const currentCategory = memoCategoryFilter.value;
    const currentTag = memoTagFilter.value;
    memoCategoryFilter.innerHTML = '<option value="">ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒª</option>';
    categories.forEach(cat => {
        const option = document.createElement('option'); option.value = cat; option.textContent = cat; memoCategoryFilter.appendChild(option);
    });
    if (categories.includes(currentCategory)) { memoCategoryFilter.value = currentCategory; } else { memoCategoryFilter.value = ""; }
    memoTagFilter.innerHTML = '<option value="">ã™ã¹ã¦ã®ã‚¿ã‚°</option>';
    tags.forEach(tag => {
        const option = document.createElement('option'); option.value = tag; option.textContent = tag; memoTagFilter.appendChild(option);
    });
    if (tags.includes(currentTag)) { memoTagFilter.value = currentTag; } else { memoTagFilter.value = ""; }
}

function updateCharCount() {
    if (memoContentEditor && memoCharCountSpan) {
        const text = memoContentEditor.innerText || '';
        memoCharCountSpan.textContent = `${text.length} æ–‡å­—`;
    }
}

function updateSaveStatus(message, duration = 2000) {
    if (memoSaveStatusSpan) {
        memoSaveStatusSpan.textContent = message;
        if (duration > 0) {
            const messageToClear = message;
          setTimeout(() => {
                if (memoSaveStatusSpan.textContent === messageToClear) {
                   const currentMemo = memos.find(m => m.id === currentMemoId);
                   if (currentMemo) {
                       updateSaveStatus(`æœ€çµ‚æ›´æ–°: ${new Date(currentMemo.updatedAt || currentMemo.createdAt).toLocaleString('ja-JP')}`, 0);
                   } else {
                       updateSaveStatus('æ–°ã—ã„ãƒ¡ãƒ¢', 0);
                   }
                }
            }, duration);
        }
    }
}

// --- Action Functions ---
function createNewMemo() {
  clearEditor();
  if (memoTitleInput) memoTitleInput.focus();
  updateSaveStatus('æ–°è¦ãƒ¡ãƒ¢ä½œæˆä¸­...', 0);
}

function saveMemo() {
  if (!memoTitleInput || !memoContentEditor || !memoCategoryInput || !memoTagsInput) return;

  const title = memoTitleInput.value.trim();
  const content = memoContentEditor.innerHTML;
  const category = memoCategoryInput.value.trim();
  const tags = memoTagsInput.value.split(',').map(tag => tag.trim()).filter(Boolean);
  const now = Date.now();

  if (!currentMemoId && !title && memoContentEditor.innerText.trim() === '') {
      updateSaveStatus('å†…å®¹ãŒå…¥åŠ›ã•ã‚Œã¦ã„ãªã„ãŸã‚ä¿å­˜ã—ã¾ã›ã‚“ã€‚', 3000);
      return;
  }

  let memo;
  if (currentMemoId) {
      memo = memos.find(m => m.id === currentMemoId);
  }

  if (memo) {
      memo.title = title;
      memo.content = content;
      memo.category = category;
      memo.tags = tags;
      memo.updatedAt = now;
  } else {
      memo = {
          id: generateMemoId(),
          title: title,
          content: content,
          category: category,
          tags: tags,
          createdAt: now,
          updatedAt: now
      };
      memos.push(memo);
      currentMemoId = memo.id;
  }

  memos.sort((a, b) => (b.updatedAt || 0) - (a.updatedAt || 0));
  saveMemos();
  renderMemoList();
  displayMemo(currentMemoId);
  updateSaveStatus('ä¿å­˜ã—ã¾ã—ãŸï¼', 2000);
}

function deleteMemo() {
  if (!currentMemoId) return;
  const memoToDelete = memos.find(m => m.id === currentMemoId);
  if (!memoToDelete) return;

  const titleToDelete = memoToDelete.title || 'ã“ã®ãƒ¡ãƒ¢';
  if (confirm(`ã€Œ${titleToDelete}ã€ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ`)) {
    memos = memos.filter(m => m.id !== currentMemoId);
    saveMemos();
    currentMemoId = null;
    clearEditor();
    updateSaveStatus('ãƒ¡ãƒ¢ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚', 3000);
  }
}

function formatDoc(command, value = null) {
  if (!memoContentEditor) return;
  memoContentEditor.focus();
  try {
      document.execCommand(command, false, value);
  } catch (e) {
      console.error("Error executing format command:", command, e);
  }
  memoContentEditor.focus();
  updateSaveStatus('ç·¨é›†ä¸­...', 0);
}
// --- Initialization Function ---
function initializeMemoTool() {
  console.log("ãƒ¡ãƒ¢ãƒ„ãƒ¼ãƒ«ã‚’åˆæœŸåŒ–ä¸­...");
  
  // Get element references
  memoListContainer = document.getElementById('memo-list');
  memoTitleInput = document.getElementById('memo-title');
  memoContentEditor = document.getElementById('memo-content');
  memoCategoryInput = document.getElementById('memo-category');
  memoTagsInput = document.getElementById('memo-tags');
  deleteMemoButton = document.getElementById('delete-button');
  manualSaveButton = document.getElementById('manual-save-button');
  const memoToolContentDiv = document.getElementById('memo-tool-content');
  if (memoToolContentDiv) {
      const buttonsInHeader = memoToolContentDiv.querySelector('.p-4.border-b');
      if(buttonsInHeader) {
         createNewMemoButton = buttonsInHeader.querySelector('button');
      }
  }
  memoSearchInput = document.getElementById('memo-search');
  memoCategoryFilter = document.getElementById('memo-category-filter');
  memoTagFilter = document.getElementById('memo-tag-filter');
  memoCharCountSpan = document.getElementById('memo-char-count');
  memoSaveStatusSpan = document.getElementById('memo-save-status');

  // Critical elements check
  if (!memoListContainer || !memoTitleInput || !memoContentEditor) {
      console.error("ãƒ¡ãƒ¢ãƒ„ãƒ¼ãƒ«ã®é‡è¦ãªè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚åˆæœŸåŒ–ã‚’ä¸­æ­¢ã—ã¾ã™ã€‚");
      return;
  }

  // Load initial data
  loadMemos();
  renderMemoList();
  clearEditor();

  // Add event listeners
  if (memoListContainer) {
      memoListContainer.addEventListener('click', (event) => {
          const listItem = event.target.closest('div[data-memo-id]');
          if (listItem && listItem.dataset.memoId) {
              displayMemo(listItem.dataset.memoId);
          }
      });
  }
  
  if (memoSearchInput) {
      memoSearchInput.addEventListener('input', renderMemoList);
  }
  if (memoCategoryFilter) {
      memoCategoryFilter.addEventListener('change', renderMemoList);
  }
  if (memoTagFilter) {
      memoTagFilter.addEventListener('change', renderMemoList);
  }
  if (memoContentEditor) {
      memoContentEditor.addEventListener('input', () => {
          updateCharCount();
          updateSaveStatus('ç·¨é›†ä¸­...', 0);
      });
  // â˜…â˜…â˜… è¨ˆç®—æ©Ÿèƒ½ã®ãŸã‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ ï¼ˆé‡è¤‡ç™»éŒ²ã‚’é˜²ãï¼‰â˜…â˜…â˜…
     if (memoContentEditor && !memoContentEditor.hasAttribute('data-calc-listener-added')) {
        memoContentEditor.addEventListener('input', handleMemoInput);
        memoContentEditor.setAttribute('data-calc-listener-added', 'true');
  }
}
  // Buttons should already have onclick handlers in HTML
  // but ensure they're connected to our functions
  if (createNewMemoButton && !createNewMemoButton.onclick) {
      createNewMemoButton.onclick = createNewMemo;
  }
  if (manualSaveButton && !manualSaveButton.onclick) {
      manualSaveButton.onclick = saveMemo;
  }
  if (deleteMemoButton && !deleteMemoButton.onclick) {
      deleteMemoButton.onclick = deleteMemo;
  }
  
  console.log("ãƒ¡ãƒ¢ãƒ„ãƒ¼ãƒ«ã®åˆæœŸåŒ–ãŒå®Œäº†ã—ã¾ã—ãŸã€‚");
}

// â˜…â˜…â˜… è¨ˆç®—å‡¦ç†ã‚’è¡Œã†é–¢æ•°ã‚’è¿½åŠ  â˜…â˜…â˜…
function handleMemoInput() {
  if (!memoContentEditor) return; // Ensure editor exists
  const lines = memoContentEditor.innerText.split('\n');
  let changed = false;
  const newLines = lines.map(line => {
    // è¡Œæœ«ãŒ '=' ã§ã€ãã®å‰ã«è¨ˆç®—å¯èƒ½ãªæ–‡å­—ãŒã‚ã‚‹å ´åˆ
    if (line.trim().endsWith('=') && line.trim().length > 1) {
      const expression = line.substring(0, line.lastIndexOf('=')).trim();
      try {
        // eval() ã‚’ä½¿ã£ã¦å¼ã‚’è©•ä¾¡ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ã«æ³¨æ„ï¼‰
        const result = eval(expression);
        // ä¸æ­£ãªå€¤ã§ãªã‘ã‚Œã°çµæœã‚’è¿½è¨˜
        if (result !== undefined && result !== null && !isNaN(result)) {
          changed = true;
          return expression + ' = ' + result;
        }
      } catch (e) {
        // è¨ˆç®—ã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯ä½•ã‚‚ã—ãªã„ï¼ˆã¾ãŸã¯ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºï¼‰
        console.error("Calculation error:", e);
        return line; // å…ƒã®è¡Œã‚’ç¶­æŒ
      }
    }
    return line;
  });

  // å¤‰æ›´ãŒã‚ã£ãŸå ´åˆã®ã¿ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã‚’æ›´æ–°
  if (changed) {
    const selection = window.getSelection();
    const range = selection.rangeCount > 0 ? selection.getRangeAt(0) : null;
    const startOffset = range ? range.startOffset : 0;
    const startContainer = range ? range.startContainer : null;

    memoContentEditor.innerText = newLines.join('\n');

    // ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã®å¾©å…ƒã‚’è©¦ã¿ã‚‹ (ç°¡æ˜“çš„ãªæ–¹æ³•)
    if (startContainer && memoContentEditor.contains(startContainer)) {
        try {
          const newRange = document.createRange();
          newRange.setStart(startContainer, Math.min(startOffset, startContainer.length || 0));
          newRange.collapse(true);
          selection.removeAllRanges();
          selection.addRange(newRange);
        } catch (e) {
            console.error("Error restoring cursor position:", e);
            memoContentEditor.focus(); // Fallback to focusing the editor
        }
    } else {
        memoContentEditor.focus();
    }
  }
}

// --- â–²â–²â–² ãƒ¡ãƒ¢æ©Ÿèƒ½ JavaScript â–²â–²â–² ---


      

      

      </script>

    <script>

</script>
</body>
  </html>