<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>消防設備設置基準 判定ツール</title>
    <script src="https://cdn.tailwindcss.com/"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @font-face {
            font-family: 'Logotype Gothic Condensed';
            src: url('fonts/LogotypeGothicCondensed.otf') format('opentype');
            font-weight: normal;
            font-style: normal;
        }
        /* Google Custom Searchのスタイル */
        .gsc-control-searchbox-only {
            width: 100% !important;
            margin: 0 !important;
            padding: 0 !important;
            display: flex !important;
            flex-direction: row !important;
            background-color: rgb(243 244 246) !important;
        }
        .gsc-search-box {
            width: 100% !important;
            margin: 0 !important;
            padding: 0 !important;
            background-color: #3b3b3b !important;
        }
        .gsc-input-box {
            width: 100% !important;
            margin: 0 !important;
            padding: 0 !important;
            background-color: #FFFFFF !important;
            border: none !important;
            box-shadow: none !important;
        }
        .gsc-input-box .gsc-input {
            width: 100% !important;
            margin: 0 !important;
            padding: 0 8px !important;
            background-color: #FFFFFF !important;
            color: #000000 !important;
            height: 28px !important;
            box-sizing: border-box !important;
        }
        /* 検索ボタンのスタイル */
        button.gsc-search-button,
        button.gsc-search-button-v2 {
            display: block !important;
            background-color: #6B7280 !important;
            border: none !important;
            padding: 0 !important;
            height: 31px !important;
            width: 31px !important;
            min-width: 31px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            border-radius: 50% !important;
            margin-right: 8px !important;
            margin-left: 4px !important;
            box-shadow: none !important;
            position: relative !important;
            overflow: hidden !important;
        }

        /* 検索ボタン内の画像のスタイル */
        button.gsc-search-button-v2 svg {
            width: 13px !important;
            height: 13px !important;
            margin: 0 !important;
            position: absolute !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
        }

        .gsc-search-button-v2:hover {
            background-color: #4B5563 !important;
            border-color: #3B8AC4 !important;
        }
        .gsc-results-wrapper {
            width: 100% !important;
        }
        .gsc-results-wrapper-overlay {
            width: 100% !important;
            left: 0 !important;
            right: 0 !important;
            padding: 30px !important;
            box-sizing: border-box !important;
            top: 180px !important;
            height: calc(100% - 180px) !important;
        }
        /* 追加のスタイル */
        .gsc-control-cse {
            padding: 0 !important;
            margin: 0 !important;
            border: none !important;
            background-color: transparent !important;
        }
        .gsc-control-cse-ja {
            padding: 0 !important;
            margin: 0 !important;
        }
        .gsc-control-wrapper {
            padding: 0 !important;
            margin: 0 !important;
        }
        .gsc-control-cse-ja .gsc-table-result {
            padding: 0 !important;
            margin: 0 !important;
        }
        .gsc-control-cse-ja .gsc-table-result th {
            padding: 0 !important;
            margin: 0 !important;
        }
        .gsc-control-cse-ja .gsc-table-result td {
            padding: 0 !important;
            margin: 0 !important;
        }
        .gsc-modal-background-image {
            background-color: rgba(0, 0, 0, 0.5) !important;
            top: 180px !important;
            height: calc(100% - 180px) !important;
        }
        .gsc-results-close-btn {
            top: 190px !important;
            right: 10px !important;
        }

        /* ナビゲーションバーのスタイル */
        .nav-bar {
            background-color: #00B8A9; /* デフォルトの背景色 */
        }
        .nav-bar a:hover {
            background-color: #7ab5fc; /* ホバー時の背景色 */
        }

        /* アニメーション用のスタイル */
        .fade-enter {
            opacity: 0;
        }

        .fade-enter-active {
            opacity: 1;
            transition: opacity 500ms ease-in-out;
        }

        .fade-exit {
            opacity: 1;
        }

        .fade-exit-active {
            opacity: 0;
            transition: opacity 500ms ease-in-out;
        }

        /* スクロールバーのスタイル */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* スクロールバーによるレイアウトシフトを防ぐ */
        html {
            overflow-y: scroll;
            scrollbar-gutter: stable;
        }

        /* メインコンテンツエリアのスクロール設定 (userpage固有のものは削除検討)*/
        /* main {
            overflow-y: auto;
            scrollbar-gutter: stable;
            scrollbar-width: none; 
        } */
        /* main::-webkit-scrollbar {
            display: none;
        } */

        /* コンタクトリストのスクロール設定 (userpage固有) */
        /* #contact-list {
            overflow-y: auto;
            scrollbar-gutter: stable;
        } */

        /* 広告エリアのスクロール設定 (userpage固有) */
        /* aside {
            overflow-y: auto;
            scrollbar-gutter: stable;
        } */

        /* 既存のスタイル (userpage固有) */
        /* .accordion-content {
            display: none;
            transition: all 0.3s ease;
        }
        
        .accordion-content.active {
            display: block;
        } */

        /* スマートフォン用のスタイル (userpage固有のレイアウト調整は削除検討) */
        @media (max-width: 768px) {
            header {
                margin-bottom: 8px !important;
                padding-bottom: 8px !important;
            }
            nav.nav-bar {
                margin-top: 4px !important; 
                margin-bottom: 8px !important; 
            }
            body {
                margin: 0;
                padding: 0;
                font-size: 12px;
            }
            /* スマホ用3カラムレイアウト調整 */
            #main-layout-container { display: flex !important; flex-direction: row !important; gap: 4px; min-height: calc(100vh - 100px - 60px - 60px); overflow: hidden; align-items: flex-start; }
            #main-layout-container > aside.w-\[150px\] { width: 80px !important; min-width: 80px !important; flex-shrink: 0 !important; height: 100%; overflow-y: auto; padding: 4px; background: #f8f9fa; border-right: 1px solid #e9ecef; }
            #main-layout-container > main.flex-grow { width: calc(100% - 80px - 4px) !important; margin-right: 0 !important; flex-grow: 1 !important; height: 100%; overflow-y: auto; padding: 4px; margin-top: 0 !important; }
            aside.w-\[225px\] { display: none; }
            /* 左サイドバーボタン調整 */
            .accordion-toggle { font-size: 10px; padding: 8px 4px; white-space: normal; text-align: center; width: 100%; }
            /* 下部広告エリア */
            .ad-container { position: fixed; bottom: 0; left: 0; right: 0; width: 100%; padding: 4px; background: #f8f9fa; border-top: 1px solid #e9ecef; z-index: 10; height: 60px; }
            /* 汎用調整 */
            section { padding: 8px 4px; width: 100%; }
            section h2, section h3 { font-size: 14px; margin-bottom: 8px !important; margin-top: 0 !important; }
            input, select, textarea { font-size: 11px; padding: 4px; }
            button { font-size: 11px; padding: 4px 8px; }
        }

        /* タッチデバイス用のスタイル (汎用) */
        @media (hover: none) {
            .tool-buttons button { padding: 10px 15px; }
        }

        .opacity-0 { opacity: 0; }
        .translate-y-4 { transform: translateY(1rem); }
        .transition-all { transition-property: all; }
        .duration-500 { transition-duration: 500ms; }

        /* 関数電卓ボタンのスタイル */
        .calculator-btn { @apply p-2 text-center rounded text-sm font-mono hover:bg-gray-100 transition-colors; }

        /* レスポンシブ対応 (Google検索用) */
        @media (max-width: 768px) {
            .gsc-control-searchbox-only { flex-direction: column !important; }
            .gsc-search-button, .gsc-search-button-v2 { width: 100% !important; margin: 8px 0 !important; }
        }

        /* スマートフォン表示でのヘッダー調整 (汎用的) */
        @media (max-width: 768px) {
            header .flex.flex-col.items-center.mt-4.relative { flex-direction: column; align-items: stretch; position: static; margin-top: 16px; }
            header .w-full.max-w-2xl { max-width: 100%; }
            header .absolute.right-0.flex.gap-2 { position: static; margin-top: 8px; justify-content: flex-end; }
            header .flex.flex-col.items-start { width: 100%; align-items: flex-start; }
            header .flex.flex-col.items-start .flex.gap-4 { width: 100%; margin-top: 4px; justify-content: flex-end; }
        }

        /* test_shoubousetsubi.html 固有のスタイル */
        #result-area ul { list-style: disc; margin-left: 20px; }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; appearance: none; margin: 0; }
        input[type="number"] { -moz-appearance: textfield; appearance: textfield; }

        /* セクション切り替え用スタイル */
        section { width: 100%; }
        /* .tool-content スタイルは削除（hiddenクラスで制御） */

    </style>
</head>
<body class="bg-white text-gray-600 text-sm" style="font-family: 'Logotype Gothic Condensed', sans-serif;">
    <header class="relative border-gray-300 mb-2">
        <div class="relative bg-[#3b3b3b] pt-4 pb-4 px-4">
            <!-- Links Div (Absolute Positioned) -->
            <div class="absolute top-2 right-4">
                <div class="flex gap-4 text-[11px] text-white">
                    <a href="userpage.html" class="hover:underline">USER PAGE</a>
                    <a href="#" onclick="showRegister()" class="hover:underline">新規会員登録</a>
                    <a href="#" onclick="showPublishForm(event)" class="hover:underline">掲載希望はコチラ</a>
                    <a href="#" onclick="showFeedbackForm(event)" class="hover:underline">ご意見・ご要望</a>
                    <a href="#" id="authButton" onclick="showLogin()" class="hover:underline">login</a>
                </div>
            </div>

            <!-- Logo/Desc Div -->
            <div class="flex flex-col items-start gap-2">
                <div class="flex items-end gap-2">
                    <a href="index.html">
                        <img src="image/yaneyukaロゴ3.png" alt="yaneyuka" class="h-12">
                    </a>
                    <p class="text-[9pt] text-white">～建築土木の総合情報サイト～</p>
                </div>
            </div>

            <!-- Search Div -->
            <div class="flex flex-col items-center mt-4 relative">
                <div class="w-full max-w-2xl">
                    <script async src="https://cse.google.com/cse.js?cx=926ccd1b95a9649b8"></script>
                    <div class="gcse-search" data-linktarget="_blank"></div>
                </div>
            </div>
        </div>
        
        <nav class="flex flex-wrap md:flex-nowrap overflow-x-auto whitespace-nowrap text-gray-100 text-sm mb-4" style="background-color: #1dad95;">
            <a href="index.html?page=topix" class="nav-item px-4 py-2 hover:bg-gray-200 transition cursor-pointer md:ml-[110pt]">Toppage</a>
            <a href="index.html?page=event" class="nav-item px-4 py-2 hover:bg-gray-200 transition cursor-pointer">イベント情報</a>
            <a href="index.html?page=new" class="nav-item px-4 py-2 hover:bg-gray-200 transition cursor-pointer">新商品</a>
            <a href="index.html?page=book" class="nav-item px-4 py-2 hover:bg-gray-200 transition cursor-pointer">書籍・ソフト</a>
            <a href="index.html?page=houki" class="nav-item px-4 py-2 hover:bg-gray-200 transition cursor-pointer">法規</a>
            <a href="index.html?page=cad" class="nav-item px-4 py-2 hover:bg-gray-200 transition cursor-pointer">添景・CAD</a>
            <a href="index.html?page=tool" class="nav-item px-4 py-2 hover:bg-gray-200 transition cursor-pointer">ツール</a>
            <a href="index.html?page=company" class="nav-item px-4 py-2 hover:bg-gray-200 transition cursor-pointer">施工会社</a>
            <a href="index.html?page=office" class="nav-item px-4 py-2 hover:bg-gray-200 transition cursor-pointer">設計事務所</a>
            <a href="index.html?page=job" class="nav-item px-4 py-2 hover:bg-gray-200 transition cursor-pointer">求人情報</a>
        </nav>
    </header>

    <!-- ★★★ 3カラムレイアウトコンテナ ★★★ -->
    <div id="main-layout-container" class="flex gap-4 p-4">
        <!-- 左サイドバー：Usertools -->
        <aside class="w-[150px] shrink-0 text-[14px]">
            <h3 class="text-lg font-semibold mb-2 cursor-default">Usertools</h3>
            <div class="space-y-0">
                <div><button class="w-full text-left px-4 py-2 cursor-pointer accordion-toggle text-[13px] text-gray-600" onclick="window.location.href='userpage.html?section=mycalendar'">Myカレンダー</button></div>
                <div><button class="w-full text-left px-4 py-2 cursor-pointer accordion-toggle text-[13px] text-gray-600" onclick="window.location.href='userpage.html?section=myhouki'">My法規</button></div>
                <div><button class="w-full text-left px-4 py-2 cursor-pointer accordion-toggle text-[13px] text-gray-600" onclick="window.location.href='userpage.html?section=todo'">Myタスク</button></div>
                <div><button class="w-full text-left px-4 py-2 cursor-pointer accordion-toggle text-[13px] text-gray-600" onclick="window.location.href='userpage.html?section=teamtodo'">Teamタスク</button></div>
                <div><button class="w-full text-left px-4 py-2 cursor-pointer accordion-toggle text-[13px] text-gray-600" onclick="window.location.href='userpage.html?section=generaltools'">一般ツール</button></div>
                <div><button class="w-full text-left px-4 py-2 cursor-pointer accordion-toggle text-[13px] text-gray-600" onclick="window.location.href='userpage.html?section=designtools'">設計ツール</button></div>
                <div><button class="w-full text-left px-4 py-2 cursor-pointer accordion-toggle text-[13px] text-gray-600" onclick="window.location.href='userpage.html?section=contact'">担当連絡先</button></div>
                <div><button class="w-full text-left px-4 py-2 cursor-pointer accordion-toggle text-[13px] text-gray-600" onclick="window.location.href='userpage.html?section=settings'">設定</button></div>
            </div>
        </aside>

        <!-- 中央カラム：メインコンテンツ -->
        <main class="flex-grow mr-[245px]">
            <div id="content-area" class="transition-opacity duration-500 opacity-100">

                <!-- 消防設備判定ツール -->
                <section id="shoubou-area">
                    <!-- タイトル用のdivを追加し、sectionからパディング等を削除 -->
                    <div class="flex items-center gap-4 mb-4">
                        <h2 class="text-base font-semibold">消防設備設置基準 判定ツール (簡易版)</h2>
                    </div>
                    <!-- コンテンツ本体 (必要なら後でdivで囲む) -->
                    <div class="mb-8 p-4 bg-yellow-100 border border-yellow-300 rounded text-sm text-yellow-800">
                        <strong>注意:</strong> このツールは簡易的な判定を行うものです。詳細な条件や例外規定は考慮されていません。最終的な判断は必ず専門家または所轄の消防署にご確認ください。
                    </div>

                    <div class="flex space-x-8 items-start">
                        <form id="criteria-form" class="space-y-4 w-1/2">
                            <div>
                                <label for="building-type" class="block text-xs font-medium text-gray-700 mb-1">1. 防火対象物の区分 (項別)</label>
                                <select id="building-type" name="building-type" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-xs">
                                    <option value="">選択してください</option>
                                    <optgroup label="特定防火対象物">
                                        <option value="1-i">1項イ（劇場、映画館、演芸場、観覧場）</option>
                                        <option value="1-ro">1項ロ（公会堂、集会場）</option>
                                        <option value="2-i">2項イ（キャバレー、カフェー、ナイトクラブ等）</option>
                                        <option value="2-ro">2項ロ（遊技場、ダンスホール）</option>
                                        <option value="2-ha">2項ハ（性風俗関連特殊営業店舗等）</option>
                                        <option value="2-ni">2項ニ（カラオケボックス等）</option>
                                        <option value="3-i">3項イ（待合、料理店等）</option>
                                        <option value="3-ro">3項ロ（飲食店）</option>
                                        <option value="4">4項（百貨店、マーケット、物品販売店舗、展示場）</option>
                                        <option value="5-i">5項イ（旅館、ホテル、宿泊所等）</option>
                                        <option value="5-ro">5項ロ（共同住宅、寄宿舎、下宿）</option>
                                        <option value="6-i">6項イ（病院、診療所、助産所）</option>
                                        <option value="6-ro">6項ロ（老人短期入所施設、養護老人ホーム、特別養護老人ホーム等）</option>
                                        <option value="6-ha">6項ハ（老人デイサービスセンター、軽費老人ホーム、小規模多機能型居宅介護施設等）</option>
                                        <option value="6-ni">6項ニ（幼稚園、特別支援学校）</option>
                                        <option value="16-i">16項イ（複合用途防火対象物のうち、特定用途部分）</option>
                                        <option value="16-2">16項の2（地下街）</option>
                                        <option value="16-3">16項の3（準地下街）</option>
                                    </optgroup>
                                    <optgroup label="非特定防火対象物">
                                        <option value="7">7項（小学校、中学校、高校、大学等）</option>
                                        <option value="8">8項（図書館、博物館、美術館等）</option>
                                        <option value="9-i">9項イ（公衆浴場のうち、蒸気浴場、熱気浴場等）</option>
                                        <option value="9-ro">9項ロ（公衆浴場（9項イ以外））</option>
                                        <option value="10">10項（車両の停車場、船舶・航空機の発着場）</option>
                                        <option value="11">11項（神社、寺院、教会等）</option>
                                        <option value="12-i">12項イ（工場、作業場）</option>
                                        <option value="12-ro">12項ロ（映画スタジオ、テレビスタジオ）</option>
                                        <option value="13-i">13項イ（自動車車庫、駐車場）</option>
                                        <option value="13-ro">13項ロ（飛行機・回転翼航空機の格納庫）</option>
                                        <option value="14">14項（倉庫）</option>
                                        <option value="15">15項（前各項に該当しない事業場）</option>
                                        <option value="17">17項（文化財）</option>
                                        <option value="18">18項（延長50m以上のアーケード）</option>
                                        <option value="19">19項（市町村長の指定する山林）</option>
                                        <option value="20">20項（総務省令で定める舟車）</option>
                                    </optgroup>
                                    <optgroup label="その他">
                                        <option value="general-housing">一般住宅</option>
                                    </optgroup>
                                </select>
                            </div>

                            <div>
                                <label for="floor-count" class="block text-xs font-medium text-gray-700 mb-1">2. 階数</label>
                                <input type="number" id="floor-count" name="floor-count" min="1" placeholder="例: 3" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-xs">
                            </div>

                            <div>
                                <label for="total-area" class="block text-xs font-medium text-gray-700 mb-1">3. 延床面積 (m²)</label>
                                <input type="number" id="total-area" name="total-area" min="0" placeholder="例: 500" class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-xs">
                            </div>

                            <div class="text-center pt-4">
                                <button type="button" onclick="checkRequirements()" class="bg-blue-600 text-white px-8 py-2 rounded hover:bg-blue-700 transition-colors text-xs">
                                    判定する
                                </button>
                            </div>
                        </form>

                        <div id="result-area" class="hidden w-1/2">
                            <h2 class="text-xs font-bold mb-4 border-b pb-2">判定結果</h2>
                            <div id="result-content" class="space-y-3 text-xs">
                                <!-- 結果がここに表示されます -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- ツールセクション -->
                <section id="tools-area" class="hidden">
                    <div class="flex items-center gap-4"><h2 class="text-base font-semibold">設計支援ツール</h2></div>
                    <div class="mt-2">
                        <div class="flex gap-4 flex-wrap mb-2 tool-buttons">
                            <button onclick="toggleResizeTool()" class="tool-button" data-tool-category="general">画像リサイズ</button>
                            <button onclick="toggleFunctionCalculator()" class="tool-button" data-tool-category="general">関数電卓</button>
                            <button onclick="toggleMemoTool()" class="tool-button" data-tool-category="general">メモ</button>
                            <button onclick="toggleGlassThicknessTool()" class="tool-button" data-tool-category="design">ガラス厚計算</button>
                            <button onclick="toggleRainwaterTool()" class="tool-button" data-tool-category="design">雨水計算</button>
                        </div>
                        <!-- 画像リサイズツール -->
                        <div id="resize-tool-content" class="tool-content hidden" data-tool-category="general">
                            <div class="max-w-md">
                                <div class="p-4">
                                    <h3>画像リサイズ</h3>
                                    <div id="drop-area">
                                        <!-- ドロップエリア -->
                                    </div>
                                    <canvas id="canvas"></canvas>
                                </div>
                            </div>
                        </div>
                        <!-- ガラス厚さ計算ツール -->
                        <div id="glass-thickness-tool-content" class="tool-content hidden" data-tool-category="design">
                            <div class="max-w-md">
                                <div class="p-4">
                                    <h3>ガラス厚さ計算</h3>
                                    <div class="p-4">
                                        <div id="glass-result"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- 雨水計算ツール -->
                        <div id="rainwater-tool-content" class="tool-content hidden" data-tool-category="design">
                            <div class="max-w-md">
                                <div class="p-4">
                                    <h3>雨水計算</h3>
                                    <div class="p-4">
                                        <div id="rainwater-result"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- 関数電卓ツール -->
                        <div id="function-calculator-content" class="tool-content hidden" data-tool-category="general">
                            <div class="flex gap-4">
                                <div class="w-64">
                                    <input id="calculator-display">
                                    <div class="grid">
                                        <!-- 電卓ボタン -->
                                    </div>
                                </div>
                                <div class="flex-1">
                                    <div id="calculator-history"></div>
                                </div>
                            </div>
                        </div>
                        <!-- メモツール -->
                        <div id="memo-tool-content" class="tool-content hidden" data-tool-category="general">
                            <div class="max-w-4xl">
                                <div class="p-4">
                                    <h3>メモ</h3>
                                    <button onclick="handleNewMemo()">新規メモ</button>
                                </div>
                                <div class="p-4">
                                    <div class="flex gap-6">
                                        <div class="w-1/3">
                                            <div id="memo-list"></div>
                                        </div>
                                        <div class="w-2/3">
                                            <div id="memo-content"></div>
                                            <button id="manual-save-button">保存</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <!-- 右サイドバー：広告エリア -->
        <aside class="w-[225px] shrink-0 bg-white px-4 pt-0 pb-4 rounded text-[14px] h-auto md:h-[calc(100vh-220px)] md:sticky md:top-[180px] overflow-y-auto scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-transparent" style="scrollbar-width: thin;">
            <h4 class="text-[12px] font-semibold mb-1">PR</h4>
            <img src="image/asahikasei_cm.png" class="mb-2 rounded w-[clamp(180px,22vw,320px)]" alt="広告1" />
            <img src="image/asahikasei_cm.png" class="mb-2 rounded w-[clamp(180px,22vw,320px)]" alt="広告2" />
            <img src="image/asahikasei_cm.png" class="mb-2 rounded w-[clamp(180px,22vw,320px)]" alt="広告3" />
        </aside>
    </div>

    <!-- 下部広告エリア（スマホ用）-->
    <div class="ad-container md:hidden">
        <img src="image/asahikasei_cm.png" class="rounded w-full h-full object-contain" alt="広告（下部）" />
    </div>

    <script>
        // 消防設備設置基準データ（簡易版）
        // キー: 設備名
        // 値: { name_jp: 日本語名, requirements: [ 判定条件の配列 ] }
        // 判定条件: { type: 項区分(配列), minArea: 最小面積, minFloor: 最小階数, conditionText: 条件テキスト, law: 根拠条文(簡易)}
        const equipmentStandards = {
            shoukaki: {
                name_jp: "消火器",
                requirements: [
                    { type: ['all'], minArea: 150, conditionText: "延べ面積150㎡以上", law: "令第10条" },
                    { type: ['1-i', '1-ro', '2-i', '2-ro', '2-ha', '2-ni', '3-i', '3-ro', '4', '5-i', '6-i', '6-ro', '6-ha', '9-i', '12-ro', '16-i', '16-2', '16-3'], minArea: 0, conditionText: "特定防火対象物（一部除く）は面積に関わらず必要", law: "令第10条" },
                    { type: ['general-housing'], minArea: 0, conditionText: "一般住宅（設置義務は市町村条例による場合がある）", law: "条例等" }
                ]
            },
            okunaiShoukasen: {
                name_jp: "屋内消火栓設備",
                requirements: [
                    { type: ['1-i', '1-ro', '2-i', '2-ro', '2-ha', '2-ni', '3-i', '3-ro', '4', '5-i', '6-i', '6-ro', '6-ha', '9-i', '12-ro', '16-i'], minArea: 700, conditionText: "特定防火対象物(一部除く) 延べ700㎡以上", law: "令第11条" },
                    { type: ['7','8','9-ro','10','11','12-i','13-i','13-ro','14','15','17'], minArea: 1400, conditionText: "非特定防火対象物(一部除く) 延べ1400㎡以上", law: "令第11条" },
                    // 耐火/準耐火による緩和などは未実装
                ]
            },
            sprinkler: {
                name_jp: "スプリンクラー設備",
                requirements: [
                    { type: ['all'], minFloor: 11, conditionText: "11階以上の階", law: "令第12条" }, // 11階以上は原則必要（用途問わず階ごと）
                    { type: ['1-i', '1-ro', '2-i', '2-ro', '2-ha', '2-ni'], minArea: 3000, conditionText: "1項イ・ロ、2項イ・ロ・ハ・ニ 延べ3000㎡以上", law: "令第12条" },
                    { type: ['4', '5-i', '16-i'], minArea: 6000, conditionText: "4項、5項イ、16項イ 延べ6000㎡以上", law: "令第12条" },
                    { type: ['6-i', '6-ro'], minArea: 0, minFloor: 3, conditionText: "6項イ・ロ(病院・福祉施設等) 特定の条件(床面積275㎡以上など)で必要 (詳細条件あり)", law: "令第12条"},
                    { type: ['16-2'], minArea: 1000, conditionText: "地下街 延べ1000㎡以上", law: "令第12条" },
                    // 他多数の条件あり（階数、面積、用途、構造、窓の有無など）
                ]
            },
            jikaHou: {
                name_jp: "自動火災報知設備",
                requirements: [
                    { type: ['1-i', '1-ro', '2-i', '2-ro', '2-ha', '2-ni', '3-i', '3-ro', '4', '5-i', '6-i', '6-ro', '6-ha','9-i','16-i','16-2','16-3'], minArea: 300, conditionText: "特定防火対象物(一部除く) 延べ300㎡以上", law: "令第21条" },
                    { type: ['5-ro', '6-ni','7','8','9-ro','10','11','12-i','12-ro','13-i','13-ro','14','15','17'], minArea: 500, conditionText: "非特定防火対象物(一部除く) 延べ500㎡以上", law: "令第21条" },
                    { type: ['all'], minFloor: 11, conditionText: "11階以上は原則必要", law: "令第21条" },
                     { type: ['1-i', '1-ro', '2-i', '2-ro', '2-ha', '2-ni', '3-i', '3-ro', '4', '5-i', '6-i', '6-ro', '6-ha', '6-ni', '9-i', '16-i'], minArea: 0, conditionText: "特定防火対象物（面積に関わらず必要な場合あり、例：無窓階、指定用途）", law: "令第21条" }, // 簡略化
                    { type: ['general-housing'], minArea: 0, conditionText: "一般住宅（寝室・階段等に設置義務あり）", law: "令第21条の2, 条例" }
                    // 複合用途、無窓階、指定可燃物などの詳細条件は未実装
                ]
            },
            // --- ここから追加 ---
            shoubouYousui: {
                name_jp: "消防用水",
                requirements: [
                    { type: ['all'], minArea: 5000, structure: 'non-fireproof', conditionText: "耐火・準耐火以外 延べ5000㎡以上", law: "令第27条" },
                    { type: ['all'], minArea: 7000, structure: 'fireproof', conditionText: "耐火・準耐火 延べ7000㎡以上", law: "令第27条" }
                    // 水道の状況等による緩和は未実装
                ]
            },
            haienSetsubi: {
                name_jp: "排煙設備",
                requirements: [
                    { type: ['1-i', '1-ro', '2-i', '2-ro', '2-ha', '2-ni', '3-i', '3-ro', '4', '5-i', '6-i', '6-ro', '6-ha', '6-ni', '9-i', '16-i'], minArea: 500, conditionText: "特殊建築物等で延べ500㎡超、または無窓階、3階以上等 (詳細条件多数)", law: "令第28条, 建築基準法" }, // 非常に複雑なため簡略化
                     { type: ['all'], minFloor: 3, minArea: 0, conditionText: "3階以上で延べ500㎡超の建築物 (詳細条件多数)", law: "令第28条, 建築基準法" } // 非常に複雑なため簡略化
                ]
            },
            renketsuSousuikan: {
                name_jp: "連結送水管",
                requirements: [
                    { type: ['all'], minFloor: 7, conditionText: "7階建て以上", law: "令第29条" },
                    { type: ['all'], minFloor: 5, minArea: 6000, conditionText: "5階建て以上 延べ6000㎡以上", law: "令第29条" },
                    { type: ['16-2'], minArea: 1000, conditionText: "地下街 延べ1000㎡以上", law: "令第29条" }
                ]
            },
             renketsuSansui: {
                name_jp: "連結散水設備",
                requirements: [
                    { type: ['16-2', '16-3'], minArea: 700, conditionText: "地下街・準地下街 延べ700㎡以上 (スプリンクラー設置部分除く)", law: "令第29条の2" }
                    // 用途による条件もあり
                ]
            },
            hijouConsent: {
                name_jp: "非常コンセント設備",
                requirements: [
                    { type: ['all'], minFloor: 11, conditionText: "11階建て以上", law: "令第29条の2" },
                     { type: ['16-2'], minArea: 1000, conditionText: "地下街 延べ1000㎡以上", law: "令第29条の2" }
                ]
            },
            musenTsuushinHojo: {
                name_jp: "無線通信補助設備",
                requirements: [
                     { type: ['16-2'], minArea: 1000, conditionText: "地下街 延べ1000㎡以上", law: "令第29条の3" }
                ]
            },
             mizufunmu: {
                name_jp: "水噴霧消火設備",
                requirements: [
                    // 駐車場、指定可燃物貯蔵取扱場所など、特殊なケースが多いため簡易判定は困難
                    { type: ['13-i'], minArea: 500, conditionText: "駐車場 (特定の階・構造で必要)", law: "令第13条" },
                    { type: ['14', '12-i'], conditionText: "指定可燃物貯蔵・取扱施設等", law: "令第14条他"}
                ]
            },
            douryokuPump: {
                name_jp: "動力消防ポンプ設備",
                requirements: [
                     // 屋外消火栓や連結送水管と関連。単独での設置基準は複雑。
                     { type: ['all'], minArea: 0, minFloor: 0, conditionText: "水源の水位が低い場合や高層階への送水等で必要", law: "令第15条他" }
                ]
            },
            packageShouka: {
                 name_jp: "パッケージ型消火設備",
                 requirements: [
                      // 屋内消火栓等の代替や補完。
                     { type: ['all'], minArea: 0, minFloor: 0, conditionText: "屋内消火栓等の代替・補完として設置される場合あり", law: "令第11条他" }
                 ]
             },
             packageJidouShouka: {
                 name_jp: "パッケージ型自動消火設備",
                 requirements: [
                     // スプリンクラー等の代替や補完。小規模特定用途など。
                     { type: ['6-ro','6-ha'], conditionText: "小規模な福祉施設などでスプリンクラー代替として設置される場合あり", law: "令第12条他" }
                 ]
             },
            hijouKeihou: {
                name_jp: "非常警報器具・設備",
                requirements: [
                    { type: ['1-i', '1-ro', '2-i', '2-ro', '2-ha', '2-ni', '3-i', '3-ro', '4', '5-i', '6-i', '6-ro', '6-ha', '9-i', '16-i', '16-2'], capacity: 50, minArea: 0, minFloor: 0, conditionText: "特定防火対象物 収容人員50人以上", law: "令第24条" },
                    { type: ['all'], minFloor: 11, conditionText: "11階以上または地下街で収容人員20人以上", law: "令第24条" },
                    { type: ['5-ro', '6-ni','7','8','9-ro','10','11','12-i','12-ro','13-i','13-ro','14','15'], capacity: 20, minArea: 0, minFloor: 0, conditionText: "非特定防火対象物(一部) 収容人員20人以上（非常ベル等）", law: "令第24条" }
                ]
            },
            yuudouTou: {
                name_jp: "誘導灯・誘導標識",
                requirements: [
                    { type: ['all'], conditionText: "原則として全ての防火対象物に必要（種類・設置場所は詳細規定あり）", law: "令第26条" },
                    { type: ['general-housing'], conditionText: "一般住宅は原則不要", law: "令第26条" }
                ]
            },
            hinanKigu: {
                name_jp: "避難器具",
                requirements: [
                    { type: ['all'], minFloor: 2, conditionText: "2階以上または地下階で、特定の用途・収容人員・構造の場合に必要 (詳細条件多数)", law: "令第25条" },
                    { type: ['5-i', '5-ro', '6-i', '6-ro', '6-ha', '16-i'], minFloor: 2, conditionText: "旅館、共同住宅、病院、福祉施設等は特に設置基準が厳しい", law: "令第25条" }
                ]
            },
            gasMoreKeihou: {
                name_jp: "ガス漏れ火災警報設備",
                requirements: [
                    { type: ['16-2', '16-3'], conditionText: "地下街・準地下街の厨房等", law: "令第21条の3" },
                    { type: ['all'], conditionText: "特定施設（ボイラー室、厨房など）で必要となる場合あり", law: "令第21条の3" } // 用途による詳細条件
                ]
            }
            // --- 追加ここまで ---
        };

        function checkRequirements() {
            console.log("checkRequirements called");
            const buildingType = document.getElementById('building-type').value;
            const floorCount = parseInt(document.getElementById('floor-count').value) || 0;
            const totalArea = parseFloat(document.getElementById('total-area').value) || 0;
            console.log("Inputs:", { buildingType, floorCount, totalArea });
            if (!buildingType || floorCount <= 0 || totalArea <= 0) {
                alert('全ての項目を正しく入力してください。');
                console.log("Validation failed");
                return;
            }
            const resultArea = document.getElementById('result-area');
            const resultContent = document.getElementById('result-content');
            resultContent.innerHTML = '';
            resultContent.className = 'space-y-3 text-xs';
            console.log("Result area cleared and styled");
            let hasRequiredEquipment = false;
            for (const key in equipmentStandards) {
                console.log(`Checking equipment: ${key}`);
                const equipment = equipmentStandards[key];
                let required = false;
                let requirementText = "不要";
                let lawText = "";
                let matchedCondition = "";
                for (const req of equipment.requirements) {
                    const typeMatch = req.type.includes('all') || req.type.includes(buildingType);
                    const areaMatch = !req.minArea || totalArea >= req.minArea;
                    const floorMatch = !req.minFloor || floorCount >= req.minFloor;
                    const capacityMatch = true; // capacity 判定は一旦省略
                    if (typeMatch && areaMatch && floorMatch && capacityMatch) {
                        required = true;
                        requirementText = `〇`;
                        lawText = req.law ? `<span class="text-xs text-gray-600 ml-2">${req.law}</span>` : '';
                        matchedCondition = req.conditionText ? `<div class="text-xs text-gray-600 ml-4">${req.conditionText}</div>` : '';
                        break;
                    } else if (typeMatch && !required) {
                         // 条件に部分的に合致するが不要な場合（より厳しい条件で不要と判断済みでない場合）
                         // 詳細な不要理由表示は今後の課題
                    }
                }
                 if (!required) {
                    const relevantReqs = equipment.requirements.filter(req => req.type.includes(buildingType) || req.type.includes('all'));
                     if (relevantReqs.length > 0) {
                         requirementText = `✕`;
                         matchedCondition = `<div class="text-xs text-gray-600 ml-4">（指定条件に該当せず）</div>`;
                     } else {
                         requirementText = `✕`;
                         matchedCondition = `<div class="text-xs text-gray-600 ml-4">（対象外の用途）</div>`;
                     }
                     lawText = '';
                 } else if (!required && !equipment.requirements.some(req => req.type.includes('all') || req.type.includes(buildingType))) {
                      requirementText = `✕`;
                      matchedCondition = `<div class="text-xs text-gray-600 ml-4">（対象外の用途）</div>`;
                      lawText = '';
                 }

                console.log(`Result for ${key}: required=${required}, text='${requirementText}', condition='${matchedCondition}', law='${lawText}'`);
                const resultItem = document.createElement('div');
                resultItem.innerHTML = `
                    <div>
                        <strong class="font-bold">${equipment.name_jp}:</strong>
                        <span class="font-bold">${requirementText}</span>
                        ${lawText}
                    </div>
                    ${matchedCondition}
                `;
                resultContent.appendChild(resultItem);
                if (required) {
                    hasRequiredEquipment = true;
                }
            }
            console.log("Finished loop, hasRequiredEquipment:", hasRequiredEquipment);
            resultArea.classList.remove('hidden');
            console.log("Result area made visible");
        }

        window.checkRequirements = checkRequirements;

        // 初期表示のために関数を呼び出す（任意）
        // checkRequirements();
    </script>
</body>
</html>